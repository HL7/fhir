<div xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.w3.org/1999/xhtml ../../schema/fhir-xhtml.xsd" xmlns="http://www.w3.org/1999/xhtml">

<a name="mixed-use"> </a>
<h3>Mixing Characteristics and Members</h3>

<p>
If both <code>Group.characteristic</code> and <code>Group.member</code> are present, then the 
members are the individuals who were found who met the characteristic.  It's possible that 
there might be other candidate members who meet the characteristic and aren't (yet) in the list.  
All members SHALL have the listed characteristics.
</p>

<a name="large-resources"> </a>
<h3>Managing large Groups</h3>

<p>
For operations to assist in adding to, removing from, or filtering contents of large Groups, see
<a href="operations-for-large-resources.html">Operations for Large Resources</a>.
</p>


<a name="membership"> </a>
<h3>Membership</h3>
<p>
Membership testing is used to test for <b>active</b> members of a Group.  At a minimum,
servers supporting membership testing on Group resources SHALL be able to correctly
identify active enumerated entities.  Active enumerated entities in a group are entities:
<ul>
  <li>listed in <code>Group.member.entity</code>,</li>
  <li>that do not have <code>Group.member.inactive</code> with a value of <code>true</code>, and</li>
  <li>do not have an expired <code>Group.member.period</code> (e.g., either the element is not present or has a period covering 'now').</li>
</ul>
</p>
<p>
Membership testing MAY also be applied to characteristic-defined Groups.  If supported,
membership testing is based on the characteristic testing of the Group.  Any entity meeting
the required characteristics is considered to be <code>active</code>.
</p>
<p>
Servers SHOULD declare whether they support only the enumerated or characteristic group filters,
via CapabilityStatement.rest.resource.documentation in markdown.   
Servers MAY impose additional membership constraints (e.g. based on modifier extensions).
</p>

<a name="relationships"> </a>
<h3>Relationships inside the group</h3>

<p>Some systems may track detailed family relationship codes (e.g. child, mother, grandfather) within a group 
rather than merely saying "family member".  There are a few options to support conveying such information:
</p>
<ul>
 <li>Instances of the PersonalRelationship resource can be used to indicate relationships between group members. 
   Such relationships can be leveraged independent of the participants' involvement of the group</li>
 <li>More detailed family relationship codes (e.g. from the [Personal Relationship RoleType Valueset](https://terminology.hl7.org/6.0.2/ValueSet-v3-PersonalRelationshipRoleType.html)) 
   MAY be sent as additional Codings in the <code>Group.member.involvement</code> element.  These SHOULD also be accompanied by the 'family-member' code to support systems that might not understand more detailed codes.  If 
   this is done, then the relationship codes are interpreted as being with respect to whichever group member is designated as "head of household"/"primary contact".  If there is no 
   such group member explicitly designated, then the nature of the more detailed personal relationship codes cannot reliably be interpreted.
  </li>
</ul>

<a name="inclusion-exclusion-criteria"> </a>
<h3>Defining Group Inclusion and Exclusion Criteria</h3>
  <p>The Group definition, specifying the criteria for membership in the Group, may be expressed with one or more Group.characteristic elements. Here we describe how the Group StructureDefinition is used to express inclusion and exclusion criteria for group membership.</p>
<h4>Group.membership</h4>
<p>Group.membership requires one of three codes:</p>
<ul>
    <li>'enumerated': Use this code if the Group Resource lists the group members and/or specifies the number of entities in the group. Use of the 'enumerated' code will require use of the Group.type element.</li>
    <li>'definitional': Use this code if the Group Resource provides structured data (i.e. the Group.characteristic values) that is necessary and sufficient to define the qualifications for group membership (the inclusion and exclusion criteria for defining what makes something a member of the group). Use of the 'definitional' code will require use of the Group.type element. If a group is both enumerated and definitional, then use the enumerated code.</li>
    <li>'conceptual': Use this code if the Group Resource is an abstract representation of a group that is neither enumerated (listing or counting actual members) nor definitional (providing complete definition for membership qualifications). A different use of the 'conceptual' code is when the Group is otherwise 'definitional' but the Group.type cannot be used because the actual type value is not included in FHIR types.</li>
</ul>
<h4>Group.combinationMethod</h4>
<p>Group.combinationMethod is used when there are two or more Group.characteristic instances to define how the characteristics are combined.</p>
<ul>
    <li>Use a code 'all-of' to indicate that each of the characteristics must be met. This is functionally equivalent to combining all characteristics with an AND operator.</li>
    <li>Use a code 'any-of' to indicate that at least one of the characteristics must be met. This is functionally equivalent to combining all characteristics with an OR operator.</li>
    <li>Use a code 'at-least' to indicate that at least n of the characteristics must be met. Use Group.combinationThreshold to specify the value of n.</li>
    <li>Use a code 'at-most' to indicate that at most n of the characteristics must be met. Use Group.combinationThreshold to specify the value of n.</li>
    <li>Use a code 'except-subset' to indicate that the characteristics expressed as exclusion criteria are used as exceptions to meeting the characteristics expressed as inclusion criteria. Explaining by example: “Cancer of any kind (except basal cell skin cancer or cancer in situ) unless documented to be disease-free for five years” (<a href="group-example-conceptualcohortdefinition-cancer-except-subset.html">Example of Group for Cancer Except Subset</a>).</li>
</ul>
<h4>Group.characteristic.code</h4>
<p>Each characteristic must have a code value (CodeableConcept datatype) to specify the attribute. For instance:</p>
<ul>
    <li>for a characteristic of "age &gt; 18 years” the attribute is “age” and the attribute of age may be expressed as</li>
</ul>
<p>"code": { "coding": [ { "system": "http://snomed.info/sct", "code": "397669002", "display": "Age" } ] }</p>
<ul>
    <li>for a characteristic of "Body mass index &gt;= 30 kg/m2" the attribute is "Body mass index" and the attribute may be expressed as</li>
</ul>
<p>"code": { "coding": [ { "system": "http://loinc.org", "code": "39156-5", "display": "Body mass index (BMI) [Ratio]" } ] }</p>
<h4>Group.characteristic.value[x]</h4>
<p>Each characteristic must have a value[x] value to specify the value of the attribute that holds for members of the group. There is no [x] in the JSON or XML expression as it is replaced with the data type (CodeableConcept, boolean, Quantity, Range, Reference, uri, or Expression)</p>
<p>For instance:</p>
<ul>
    <li>for a characteristic of "age &gt; 18 years” the value is “&gt; 18 years” and the value may be expressed with a Quantity datatype as</li>
</ul>
<p>"valueQuantity": { "comparator": "&gt;=", "value": 18, "unit": "years",</p>
<p> "system": "http://unitsofmeasure.org", "code": "a" }</p>
<ul>
    <li>for a characteristic of "Body mass index &gt;= 30 kg/m2" the value is "&gt;= 30 kg/m2" and the value may be expressed as</li>
</ul>
<p>"valueQuantity": { "comparator": "&gt;=", "value": 30, "unit": "kg/m2",</p>
<p>"system": "http://unitsofmeasure.org", "code": "kg/m2" }</p>
<h4>Group.characteristic.exclude</h4>
<p>Sometimes group membership is determined by characteristics not possessed. When this is the case, the Group.characteristic.exclude element has a value of true ("exclude": true). For characteristics that are not exclusion criteria, the Group.characteristic.exclude element has a value of false ("exclude": false). The exclude element is required.</p>
<p>For example, an exclusion criterion of HbA1c ≥ 14.0% is expressed as:</p>
<p>{ "description": "HbA1c ≥ 14.0%", "code": {; "coding": [ { "system": "http://loinc.org", "code": "59261-8", "display": "Hemoglobin A1c/Hemoglobin.total in Blood" } ] }, "valueQuantity": { "value": 14, "comparator": "&gt;=", "unit": "%", "system": "http://unitsofmeasure.org", "code": "%" }, "exclude": true }</p>
<h4>Group.characteristic.description</h4>
<p>A short, natural language description of the characteristic (using the markdown datatype) that could be used to communicate the criteria to an end-user. The description element is for convenience so that end users can understand the characteristic and is neither a required part of the characteristic nor part of the structured representation of the characteristic.</p>
<h4>Describing how the characteristic value is determined</h4>
<p>The Group.characteristic.method modifies the Group.characteristic.code and indicates how the value is to be determined, using the CodeableConcept datatype. For example, HbA1C values can be determined by High-Performance Liquid Chromatography or by Capillary electrophoresis.</p>
<p>The method may be expressed as multiple concepts, eg. standing barefoot for Height measurements could be expressed as two separate concepts (standing, barefoot) that express the method.</p>
<p>The Group.characteristic.formula modifies the Group.characteristic.code and indicates how the value is to be determined, using an Expression datatype.</p>
<p>The Group.characteristic.determiner modifies the Group.characteristic.code and indicates who or what determines the value, using a Reference datatype. The determiner value may reference a person (<a href="practitioner.html">Practitioner</a> or <a href="practitionerrole.html">PractitionerRole</a> Resource) or group (<a href="organization.html">Organization</a> Resource) or device. The reference to a device can be either to a specific device using the <a href="device.html">Device</a> Resource, or the <a href="devicemetric.html">DeviceMetric</a> Resource if a specific set of device parameters is needed, or a type of device using the <a href="devicedefinition.html">DeviceDefinition</a> Resource.</p>
<h4>Group.characteristic.offset</h4>
<p>Defines the reference point for comparison when other than 0. As an example, to express a characteristic of a calcium level greater than the normal limit or a hemoglobin level less than 1 g/dL below the reference range, the offset concept would represent "normal limit" or "reference range".</p>
<p>This is a modifier element because it modifies the meaning of the characteristic.value[x].</p>
<h4>Describing when the characteristic value is present</h4>
<p>The Group.characteristic.period describes when the characteristic value is present in calendar time; e.g. the patient had an operation during the month of June.</p>
<p>The Group.characteristic.timing describes when the characteristic value is present with respect to an event; e.g. within a month following patient discharge.</p>
<p>Note: RelativeTime is a recent addition to the Group Resource. RelativeTime is used to express a point in time or an interval of time relative to an event defined in data types other than dateTime.</p>
<p>Example: <a href="group-example-outcomedefinition-hba1c-at-12-months.html">Example of Group for HbA1c at 12 months</a></p>
<p>Example includes timing and offset "At 12 months form inclusion in a clinical trial. Inclusion is defined as enrollment via the SNOMED code.</p>
<p>"timing": [ { "contextCode": { "coding": [ { "system": "http://snomed.info/sct", "code": "709491003", "display": "Enrollment in clinical trial" } ] }, "offsetDuration": { "value": 12, "unit": "months", "system": "http://unitsofmeasure.org", "code": "mo" }, "text": "at 12 months" }</p>
</div>
