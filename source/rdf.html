<!DOCTYPE HTML>

<!--
These elements SHALL always appear in this order. These basic elements shared by all resources come first
in order to support consistent definitions for schema and UML derived code.
-->

[%settitle RDF Representation%]
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
[%file newheader%]
</head>
<body>
[%file newnavbar%]

<%fmtheader rdf%>

<a name="root"></a>
<h2>Resource Description Framework (RDF) Representation </h2>
<table class="colstu"><tr><td id="wg"><a _target="blank" href="[%wg its%]">[%wgt its%]</a> Work Group</td><td id="fmm"><a href="versions.html#maturity">Maturity Level</a>: 3</td><td id="ballot"><a href="versions.html#std-process">Standards Status</a>:<!--!ns!--><a href="versions.html#std-process">Trial Use</a></td></tr></table>

[%normative page infrastructure%]

<div style="background-color: #E6FFFF; border:1px solid black; padding: 5px;">
<table>
<tr>
 <td><a href="http://www.w3.org/2001/sw/wiki/RDF"><img src="https://www.w3.org/Icons/SW/Buttons/sw-rdf-blue-v.svg" width="150" alt="W3C RDF"/></a></td>
 <td>
<p>
This page and the RDF forms are jointly maintained
by the HL7 FHIR project -- especially the
<a href="https://confluence.hl7.org/pages/viewpage.action?pageId=66922543">RDF subgroup</a> of the
<a href="http://www.hl7.org/Special/committees/xml/index.cfm">ITS work group</a> -- and the
<a href="https://www.w3.org/blog/hcls/">W3C Semantic
Web Health Care and Life Sciences Interest Group</a>.
</p>
</td></tr></table>
</div>

      <p> FHIR resources can be represented as an <a
          href="http://www.w3.org/RDF/">RDF graph</a> serialized in the <a
          href="https://www.w3.org/TR/turtle/">Turtle format</a>. The RDF format is
        defined to assist the process of bridging between operational
        data exchange and formal knowledge processing systems. While the
        RDF form offers a fully functional representation of FHIR
        resources, it has different operational characteristics from the
        <a href="json.html">JSON</a> and <a href="xml.html">XML</a>
        representations, and would be used for different reasons.
        Systems focused on operational exchange of data would not
        usually choose to use RDF.<br/>
      </p>
      <p> This page describes:</p>
      <ul>
        <li><a
href="#turtle-template">Turtle

            Template for Resources</a></li>
        <li><a href="#example">FHIR RDF Example</a></li>
        <li><a href="#serialization-conventions">FHIR RDF Serialization
            Conventions</a>
	   <ul>
            <li><a href="#resources">Representing Resources</a></li>
            <li><a href="#caseSensitivity">Case Sensitivity</a></li>
            <li><a href="#nestedNodes">Nested Anonymous Nodes</a></li>
            <li><a href="#propertyNames">Property Names</a></li>
            <li><a href="#rdflist">Representing Repeating Elements -- RDF Lists</a></li>
            <li><a href="#primitive">Representing Primitive Elements</a></li>
            <li><a href="#reference">Representing References</a></li>
            <li><a href="#contained">Representing Inline (Contained) Resources</a></li>
            <li><a href="#representing-concepts">Representing Concepts</a></li>
            <li><a href="#iri-stem">Concept IRIs and IRI Stems</a></li>
            <li><a href="#extension">Non-modifier Extensions</a></li>
            <li><a href="#modifierExtension">Modifier Extensions</a></li>
	   </ul>
	</li>
        <li><a href="#fhir-definitions">RDF Representation of FHIR
            Definitions</a></li>
        <li><a href="#relationship">Relationship between RDF, FHIR, and
            ontologies</a></li>
        <li><a href="#guidance">Usage Guidance</a>
	  <ul>
          <li><a href="#fhir-rdf-with-owl">Using FHIR RDF with OWL</a></li>
          <li><a href="#tutorials">Tutorials</a></li>
	  </ul>
        </li>
        <li><a href="#concept-iri-algorithm">Appendix 1: Algorithm for
            creating a Concept IRI</a><br/>
        </li>
        <li><a href="#registering-iri-stems">Appendix 2: Registering an 
		IRI Stem on the HL7 Terminology Website</a><br/>
        </li>

      </ul>
      <a name="instance"></a>
        <h3><a name="turtle-template"></a>Turtle Template for Resources</h3>
        <p> Each resource page has a set of language templates
          describing the FHIR expression in that language. The Turtle
          representation for a resource is described using this
          format: 
        </p>
        <pre class="spec">
[ a fhir:Observation; 
  fhir:nodeRole fhir:treeRoot;     # if this is the parser root
  # from Resource: id; meta; implicitRules; and language
  # from DomainResource: text; contained; extension; and modifierExtension
  fhir:identifier [ <a href="datatypes.html#Identifier">Identifier</a> ];  # 0..* Unique Id for this particular observation
  fhir:status [ fhir:v "&lt;code&gt;" ]; # R!  registered | preliminary | final | amended +
  fhir:code [ <a href="datatypes.html#CodeableConcept">CodeableConcept</a> ];   # 1..1 R!  Type of observation (code / type)
  fhir:subject [ fhir:reference [ <a href="patient.html#Patient">Patient</a>|<a href="group.html#Group">Group</a>|<a href="device.html#Device">Device</a>|<a href="location.html#Location">Location</a> ... ] ]; # 0..1 Who and/or what this is about
  fhir:encounter [ fhir:reference [ <a href="encounter.html#Encounter">Encounter</a> ] ]; # 0..1 Healthcare event during which this observation is made
  # effective[x]: 0..1 Clinically relevant time/time-period for observation. One of these 4:
    fhir:effectiveDateTime [ fhir:v "&lt;dateTime&gt;" ];
    fhir:effectivePeriod [ <a href="datatypes.html#Period">Period</a> ];
    fhir:effectiveTiming [ <a href="datatypes.html#Timing">Timing</a> ];
    fhir:effectiveInstant [ fhir:v "&lt;instant&gt;" ];
]</pre>
        <p> Using this format: </p>
        <ul>
          <li> To build a valid Turtle instance of a resource, replace
            the contents of the property values with valid content as
            described by the type rules and content description found in
            the property value for each element. </li>
          <li> Nodes are never empty. If an element is present in the
            resource, it SHALL have properties as defined for its type,
            or 1 or more <a
href="extensibility.html">extensions</a>
          </li>
          <li>The <span style="color: brown"><b>R!</b></span> denotes
            that a relationship is mandatory: it must be present (or in
            an array, at least one item must be present).</li>
          <li>Note that this specification produces Turtle that is
            nicely formatted and well laid out, but this is not required
            or expected.</li>
        </ul>

        <h3><a name="example"></a>FHIR RDF Example<br/>
        </h3>
        <p> An example FHIR RDF Observation illustrates the Turtle
          language and the additional conventions used by FHIR RDF: </p>
        <pre class="rdf">PREFIX fhir: &lt;http://hl7.org/fhir/&gt;
PREFIX xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt;
PREFIX owl: &lt;http://www.w3.org/2002/07/owl#&gt;

<span class="xmlcomment">                                  # Obs123 (subject) hasType (predicate) fhir:Observation</span>
&lt;http://example.org/fhir/Observation/Obs123&gt; a fhir:Observation;
  fhir:nodeRole fhir:treeRoot;    <span class="xmlcomment"># (subject) is the serialization root of this document</span>
  fhir:id [ fhir:v "Obs123" ];    <span class="xmlcomment"># (subject) has an id of "Obs123"</span>
  fhir:status [ fhir:v "final" ]; <span class="xmlcomment"># (subject) has an (extensible) status of "final"</span>
  fhir:code [                     <span class="xmlcomment"># (subject) as a code</span>
    <span id="ex-list">fhir:coding (                 <span class="xmlcomment">#  which has codings</span>
      [                           <span class="xmlcomment">#   with a concept IRI, system and code</span>
        a &lt;http://loinc.org/rdf#29463-7&gt; ;
        fhir:system [
          fhir:v "http://loinc.org"^^xsd:anyURI
        ];
        fhir:code [ fhir:v "29463-7" ]
      ]
      [                           <span class="xmlcomment">#  and another with display text</span>
        a &lt;http://loinc.org/rdf#3141-9&gt; ;
        fhir:system [
          fhir:v "http://loinc.org"^^xsd:anyURI
        ];
        fhir:code [ fhir:v "3141-9" ];
        fhir:display [ fhir:v "Body weight Measured" ]
      ]
    )</span>
  ];
  <span id="value">fhir:value [                    <span class="xmlcomment"># the value is an anonymous node</span>
    a fhir:Quantity;              <span class="xmlcomment">#   which has a type (Quantity).</span>
    <span id="v-decimal">fhir:value [ fhir:v "185"^^xsd:decimal ]</span>;
    fhir:unit [ fhir:v "lbs" ];
    fhir:system [
      fhir:v "http://unitsofmeasure.org"^^xsd:anyURI
    ];
    fhir:code [ fhir:v "[lb_av]" ]
  ]</span>.

                                  <span class="xmlcomment"># Metadata to help OWL interpretation</span>
&lt;http://example.org/fhir/Observation/Obs123.ttl&gt; a owl:Ontology;
  owl:imports fhir:fhir.ttl;
  owl:versionIRI &lt;http://example.org/fhir/Observation/Obs123.ttl&gt;.</pre>
        <p> In this example, </p>
        <ul>
          <li>the subject <a href="https://www.rfc-editor.org/rfc/rfc3987">IRI</a> is wrapped with '<code class="rdf">&lt; ... &gt;</code>'.</li>
          <li>the type (<code class="rdf">fhir:Observation</code>) and
            following predicates (e.g. <code class="rdf">fhir:status</code>)
            are prefixed names (like XML namespaced names),</li>
          <li>assertions following a ';' re-use the same subject,</li>
          <li>anonymous nodes are declared with '<code class="rdf">[ ... ]</code>'s,</li>
          <li>and literals with a quoted value and an optional datatype
            preceded by '^^' (e.g. <code class="rdf">"final"</code>).</li>
        </ul>

        <h3><a name="serialization-conventions"></a>FHIR RDF
          Serialization Conventions</h3>
        FHIR RDF imposes additional conventions to simplify recognition
        and manipulation of FHIR RDF graphs.&nbsp; Although RDF graphs
        in general may be serialized in various RDF formats, FHIR RDF
        mandates support specifically for <a
          href="https://www.w3.org/TR/turtle/">Turtle</a>. All FHIR RDF
        documentation is expressed in Turtle.&nbsp;&nbsp; And while the
        standard media type for Turtle is <code>text/turtle</code>, the
        use of Turtle for FHIR RDF uses the specialized media type <code>application/fhir+turtle</code>.<br/>
        <p> FHIR uses <a href="https://shex.io/shex-semantics/">Shape
            Expressions (ShEx)</a> to define and validate FHIR RDF. See
          <a
href="fhir.shex">fhir.shex</a>
          for the complete FHIR RDF schema. Each Resource page includes
          a link for the subset of fhir.shex needed to describe that
          Resource. The media type for ShEx is <code>text/shex.</code></p>
        <a name="resources"></a>
          <h4>Representing Resources</h4>
          <p> Each resource is represented as a set of RDF triples. When
            a resource has a persistent identity (e.g. it can be found
            at a particular URL -- usually a FHIR RESTful server), then
            that URL is its identity. Resources with no persistent
            identity (e.g. bundles from search results) have the
            identity of the root document -- "&lt;&gt;" in Turtle syntax.
            In the above example, the resource is the subject: <code
              class="rdf">&lt;http://example.org/fhir/Observation/Obs123&gt;</code>.
          </p>
          <p> Some resources can contain other resources. Given that the
            relationships can appear in any order in RDF, it cannot be
            assumed that the first encountered element represents the
            resource of interest that is being represented by the set of
            Turtle statements. The focal resource -- where to start when
            parsing -- is the resource with the relationship <code>fhir:nodeRole</code>
            to <code>fhir:treeRoot</code>. If there is more than one
            node labeled as a 'treeRoot' in a set of Turtle statements,
            it cannot be determined how to parse them as a single
            resource. </p>

        <a name="caseSensitivity"></a>
          <h4>Case Sensitivity</h4>
          <p> While RDF predicate names are case-sensitive, FHIR avoids
            confusion by assuring that there are no predicates that
            differ only in case. For example, there will be no <span
              class="rdf">fhir:Code</span> predicate because there is
            already a fhir:code predicate. <br/>
          </p>

        <a name="nestedNodes"></a>
          <h4>Nested Anonymous Nodes</h4>
          <p> Content within a resource is always represented with
            anonymous nodes (a/k/a "blank nodes").&nbsp; Only FHIR
            Resource nodes can be <a href="https://www.rfc-editor.org/rfc/rfc3987">IRIs</a>. For example, this Turtle:
          </p>

	  &nbsp;&nbsp;&nbsp;&nbsp;<span class="rdf">&lt;http://example.org/fhir/Observation/Obs123&gt; fhir:status [ fhir:v "final" ]</span> 

	  <p>asserts that: </p>
          <ul>
            <li><span class="rdf">&lt;http://example.org/fhir/Observation/Obs123&gt;</span> has a <span
                class="rdf">status</span> of some anonymous node.</li>
            <li>That anonymous node has a <span class="rdf">fhir:v</span>
              of <span class="rdf">"final"</span> (the literal
              "final").</li>
          </ul>

        <a name="propertyNames"></a>
          <h4>Property Names</h4>
          <p> A great deal of effort has gone into unifying FHIR
            property names across resources and datatypes. These defined
            properties effectively declare the FHIR RDF namespace with a
            set of polymorphic, reuseable predicates. For example, <span
              class="rdf">fhir:status</span> is spelled the same way
            regardless of whether it appears in an Observation,
            Diagnosis, or any other FHIR Resource. </p>
          <p> In other formats (XML, JSON), FHIR properties with choice
            datatypes, like <span class="spec">value[x]</span>, are
            appended with the datatype, e.g. <span class="json">valueQuantity</span>.
            In RDF, this is written <span class="rdf">fhir:value</span>
            and the object asserts its type explicitly, as in the <a href="#value">above
              example</a>:<br/>
          </p>
          <pre class="rdf">  fhir:value [ a fhir:Quantity; ... ]</pre>

        <a name="rdflist"></a>
          <h4>Representing Repeating Elements -- RDF Lists</h4>
          <p> Elements that can repeat are represented with <a href="https://www.w3.org/TR/turtle/#collections">RDF lists</a>
            (officially called "RDF collections") in order to retain the
            order of their elements.  In the <a href="#ex-list">above
              example</a> of a FHIR Observation, the <code>fhir:code</code> has a <code>fhir:coding</code>
            with two members in an RDF list: </p>
          <pre class="rdf">    fhir:coding <b>(</b>
      [ a &lt;http://loinc.org/rdf#29463-7&gt; ... ]
      [ a &lt;http://loinc.org/rdf#3141-9&gt; ... ]
    <b>)</b></pre>
          <p> Since RDF lists can cause problems for OWL users, a 
	    <a href="https://github.com/w3c/hcls-fhir-rdf/tree/gh-pages/scripts/owl-safe-lists">script</a> can
            convert RDF lists to an alternate representation.
	    See <a href="#fhir-rdf-with-owl">Using FHIR RDF with OWL</a> for more info.</p>

        <a name="primitive"></a>
          <h4>Representing Primitive Elements</h4>
          <p> Primitive elements -- elements with a primitive type -- are
            represented as anonymous nodes, both so that element
            extensions can be attached and so that they can consistently
	    be treated as OWL object properties (versus sometimes being datatype properties).&nbsp; The actual value of the
            primitive type is represented as an RDF Literal using the <span
              class="rdf">fhir:v</span> predicate.&nbsp; fhir:v is the
            only FHIR property that directly holds an RDF literal -- i.e., it
	    is the only OWL datatype property in FHIR RDF -- and
            it always holds an RDF Literal: </p>
          <pre class="rdf">  fhir:v "[value]"^^xsd:type</pre>
          <p> The value has two parts: a literal string that contains
            the value, and, if applicable, one of the following schema
            types:<br/>
          </p>
          <ul>
            <li>boolean</li>
            <li>integer</li>
            <li>decimal</li>
            <li>base64Binary</li>
            <li>dateTime</li>
            <li>date</li>
            <li>gYear</li>
            <li>gYearMonth</li>
            <li>time</li>
          </ul>
          <p> In the <a href="#v-decimal">Observation example above</a>, the
            Quantity has a fhir:value that is an anonymous node with a
            <code class="rdf">fhir:v</code> in it: </p>
          <pre class="rdf">    [ fhir:v "185"^^xsd:decimal ]</pre>
          <p> Note that the correct XSD type for a FHIR <a
              href="datatypes.html#decimal">decimal</a>,
            <a href="datatypes.html#date">date</a>,
            or <a href="datatypes.html#dateTime">dateTime</a>
            must be determined by inspecting the value of the date for
            conformance with one of the union types for that type. In
            the case of FHIR <a
              href="datatypes.html#decimal">decimal</a>,
            which is a union of XSD <a
              href="https://www.w3.org/TR/xmlschema-2/#decimal">decimal</a>
            and <a href="https://www.w3.org/TR/xmlschema-2/#double">double</a>,
            any value with an 'e' or 'E' in it is a double, otherwise it
            is a decimal. For example, the lexical value <span
              class="rdf">"185"</span> is given the datatype <code>xsd:decimal</code>.
          </p>

          <p> The fhir:v property can never be empty. Either the
            relationship is absent, or it is present with at least one
            character of content. XHTML is represented as an escaped
            xsd:string.&nbsp; <br/>
          </p>
        <a name="reference"></a>
          <h4>Representing References</h4>
          <p> A <a href="references.html#Reference">Reference</a>
            element is represented using the same rules as above: </p>
          <pre class="rdf">  fhir:subjectReference [
     fhir:reference [ fhir:v "Patient/example" ];
     fhir:display [ fhir:v "Example Patient" ];
  ];</pre>
          <p> This allows faithful round tripping of the resource
            between the Turtle format and the JSON and XML formats.
            However, it's very useful for an RDF processor if the RDF
            graph links to the target of the reference directly. This
            can be represented using the (optional) fhir:link property:
          </p>
          <pre class="rdf">  fhir:subjectReference [
     <b>fhir:link &lt;http://example.org/fhir/Patient/example&gt; ;</b>
     fhir:reference [ fhir:v "Patient/example" ];
     fhir:display [ fhir:v "Example Patient" ];
  ];</pre>
          <p> The correct value for the fhir:link relationship must be
            determined by resolving the <a href="references.html">rules
              for resolving references</a> for the various reference
            types to a literal URL that refers to the correct content in
            the local RDF context. </p>
          <p> The fhir:link relationship can be added automatically as
            part of generating the resource representation, or it can be
            injected by a post-processor that knows how to convert the
            raw references into RDF-suitable references. </p>

        <a name="contained"></a>
          <h4>Representing Inline (Contained) Resources</h4>
          <p> Inline resources -- when a resource is contained directly
            in another element -- occur in the following places: </p>
          <ul>
            <li><a href="bundle-definitions.html#Bundle.entry.resource">Bundle.entry.resource</a></li>
            <li><a
                href="domainresource-definitions.html#DomainResource.contained">DomainResource.contained</a></li>
            <li><a
                href="parameters-definitions.html#Parameters.parameter.resource">Parameters.parameter.resource</a></li>
          </ul>
          <p> Inline resources are represented as anonymous
            nodes. This is an example for a contained Medication
            resource: </p>
          <pre class="rdf">  fhir:contained ([
     a fhir:Medication;
     # triples for the Medication
  ])</pre>
          <p> Note that DomainResource.contained has a cardinality of
            0..*, so an <a href="#rdflist">RDF List</a> is used to
            order the array. </p>

          <a name="representing-concepts"></a>
          <h4>Representing Concepts</h4>
          <p> The same logic applies to the <a
              href="datatypes.html#Coding">Coding</a> data type. These
            are represented directly in Turtle by serializing their
            properties as specified above: </p>
          <pre class="rdf">fhir:code [
    fhir:coding (
        [
            fhir:system [ fhir:v "http://loinc.org" ];
            fhir:code [ fhir:v "29463-7" ];
            fhir:display [ fhir:v "Body Weight" ]
        ]
        [
            fhir:system [ fhir:v "http://snomed.info/sct" ];
            fhir:code [ fhir:v "27113001" ];
            fhir:display [ fhir:v "Body weight" ]
        ]
    )
];</pre>
          <p> For reasoners using the RDF graph, it's very useful to
            make the implicit concept references in these Codings
            explicit, by specifying a <i>concept <a href="https://www.rfc-editor.org/rfc/rfc3987">IRI</a></i> in an
            (optional) rdf:type assertion, written as <b><code class="rdf" style="font-size: larger">a</code></b> in
            Turtle: </p>
          <pre class="rdf">fhir:code [
    fhir:coding (
        [
            <b>a loinc:29463-7</b>;
            fhir:system [ fhir:v "http://loinc.org" ];
            fhir:code [ fhir:v "29463-7" ];
            fhir:display [ fhir:v "Body Weight" ]
        ]
        [
            <b>a sct:27113001</b>;
            fhir:system [ fhir:v "http://snomed.info/sct" ];
            fhir:code [ fhir:v "27113001" ];
            fhir:display [ fhir:v "Body weight" ]
        ]
    )
];</pre>

        <a name="iri-stem"></a>
          <h4>Concept IRIs and IRI Stems</h4>

          <p> 
          A concept <a href="https://www.rfc-editor.org/rfc/rfc3987">IRI</a> uniquely identifies a concept that would otherwise
          be identified by a &lt;<code>Coding.system, Coding.code</code>&gt; pair.  A concept
          IRI has two parts: an IRI stem and a code.
	  </p>

          <p>
          An <i>IRI stem</i> is the initial substring of the concept IRIs
          that correspond to the codes in a particular vocabulary.
          The concept IRI is formed by concatenating the IRI stem with
          the code (after percent-encoding any reserved characters
          -- see <a href="#concept-iri-algorithm">Appendix 1: Algorithm for Creating a Concept IRI</a>
          for details).  The IRI stem is typically used to define an
          IRI prefix in Turtle and SPARQL, such as <code class="rdf">loinc:</code> or <code class="rdf">sct:</code> in
          the above example.   This approach allows the Compact URI
          <code class="rdf">loinc:29463-7</code> (in Turtle or SPARQL) to be translated into the
          concept IRI <code class="rdf">http://loinc.org/rdf/29463-7</code> by concatenating
          the IRI stem <code class="rdf">http://loinc.org/rdf/</code> with the code
          <code class="rdf">29463-7</code>. This particular IRI stem is defined in the
          <a href="https://loinc.org/kb/users-guide/recommendations-for-best-practices-in-using-and-mapping-to-loinc/#using-a-uri-to-identify-loinc-concepts-as-resources-in-rdf">LOINC User Guide S12.7.2</a>.
          </p>

          <p>
          One might wonder why the <code>Coding.system</code> is not used directly
          as the IRI stem for a given vocabulary.  One reason is that 
          <code>Coding.system</code>s often lack a convenient separator
          character as their final character, such as "/" or "#", which
          could cause problems if they were directly concatenated with codes,
          leading to erroneous concept IRIs such as <code class="rdf">http://loinc.org35217-9</code>.
          But the main reason is that the <code>Coding.system</code> and the IRI stem of some vocabularies
          were chosen independently and differ in unpredictable ways.
          Hence, there is no simple formula for determining the correct
          IRI stem from a <code>Coding.system</code>.
          </p>

          <p>
          To address this problem, and to facilitate ease of use,
          HL7 maintains a mapping from <code>Coding.system</code>s
          to IRI stems: IRI stems can be registered and looked
          up in the HL7 terminology website, based on the desired
          <code>Coding.system</code>.
          </p>

          <p>
          If an IRI stem for a <code>Coding.system</code> is published at
          <a href="https://terminology.hl7.org/">https://terminology.hl7.org/</a>  it SHOULD be used.   An NPM
          package is also available to efficiently automate lookup of
          IRI stems from <code>Coding.system</code>s.
	  To add an IRI stem to that site,
	  see <a href="#registering-iri-stems">Appendix 2: Registering an IRI Stem on the HL7 Terminology Website</a>.
          </p>

        <a name="extension"></a>
          <h4>Non-modifier Extensions</h4>
          <p> A Resource may have any number of non-modifier extensions,
	  represented as an RDF list like this:
          </p>
          <pre class="rdf">&lt;http://example.org/fhir/MedicationRequest/MR321&gt; a fhir:Observation;
  fhir:nodeRole fhir:treeRoot;
  <b>fhir:extension (</b>
    [ fhir:url [ fhir:v "http://example.org/fhir/StructureDefinition/observation-bodyPosition"^^xsd:anyURI ] ;
      fhir:value [
        fhir:coding (
          a sct:33586001;
          fhir:system [ fhir:v "http://snomed.info/sct" ];
          fhir:code [ fhir:v "33586001" ];
          fhir:display [ fhir:v "Sitting position (finding)" ]
        ) ] ]
    [ fhir:url [ fhir:v "http://example.org/fhir/StructureDefinition/observation-delta"^^xsd:anyURI ] ;
      fhir:value [
        fhir:coding (
          a sct:1250004;
          fhir:system [ fhir:v "http://snomed.info/sct" ];
          fhir:code [ fhir:v "1250004" ];
          fhir:display [ fhir:v "Decreased (qualifier value)" ]
        ) ] ]
  <b>)</b>
  ...
</pre>

          <a name="primitiveExtension"></a>
	  <p>A primitive element such as <code>fhir:birthDate</code> can have a list of extensions attached like this:
	  </p>
	  <pre>
...
fhir:birthDate [
  fhir:v "1970-03-30"^^xsd:date ;
  <b>fhir:extension (</b>
    [
      fhir:url [
        fhir:v "http://example.org/fhir/StructureDefinition/text"^^xsd:anyURI
      ] ;
      fhir:value [
        a fhir:string ;
        fhir:v "Easter 1970"
      ]
    ]
  <b>)</b> ;
] ;
	  </pre>

	  <p>See <a href="extensibility.html">Extensibility</a> for additional guidance on FHIR extensibility.
	  </p>

        <a name="modifierExtension"></a>
          <h4>Modifier Extensions</h4>
          <p> <a name="underbar-prefix"></a> FHIR allows <code class="rdf">modifierExtension</code>s
            on <a
              href="domainresource.html#DomainResource">DomainResources</a>,
            <a href="types.html#BackboneElement">BackboneElements</a>
            and <a
              href="types.html#BackboneType">BackboneTypes</a>.
            The type of any DomainResource with any <code class="rdf">modifierExtension</code>
            is prefixed with '_' in RDF.
        The '_' prefix helps prevent FHIR RDF
          processors that do not understand a particular modifier
          extension from blindly processing it as though it still had
          the original semantics.&nbsp; The structure of the
          element is otherwise unchanged.  Note the underscore at the
          beginning of "_MedicationRequest" in the following example:<br/> </p>
          <pre class="rdf">&lt;http://example.org/fhir/MedicationRequest/MR321&gt; a <b>fhir:_MedicationRequest;</b>
  fhir:nodeRole fhir:treeRoot;
  fhir:extension ( ... );           <span class="xmlcomment"># above bodyPosition and delta extensions</span>
  <b>fhir:modifierExtension</b> (
    [
      fhir:url [ fhir:v "http://example.org/fhir/StructureDefinition/anti-prescription"^^xsd:anyURI ] ;
      fhir:value [ a fhir:boolean ; fhir:v true ]
    ]
  )
  ...
</pre>
          <p> BackboneElements and BackboneTypes are object types. Any
            RDF predicate that references a modified BackboneElement or
            BackboneType is prefixed with a '_'.  Note the underscore
	    at the beginning of "_value" in the following example:</p>
          <pre class="rdf">&lt;http://example.org/fhir/Observation/Obs123&gt; a fhir:Observation;
  ...
  fhir:<b>_value</b> [
    a fhir:Quantity;
    fhir:value [ fhir:v "185"^^xsd:decimal ];
    fhir:unit [ fhir:v "lbs" ];
    fhir:system [
      fhir:v "http://unitsofmeasure.org"^^xsd:anyURI
    ];
    fhir:code [ fhir:v "[lb_av]" ];
    <b>fhir:modifierExtension</b> (
      [
        fhir:url [ fhir:v "http://example.org/fhir/StructureDefinition/anti-observation"^^xsd:anyURI ] ;
        fhir:value [ a fhir:boolean ; fhir:v true ]
      ]
    ) ;
  ]</pre>
<p>See <a href="extensibility.html#modifierExtension">Modifier Extensions</a> for
additional requirements around modifier extensions.
</p>
          
          <h3><a name="fhir-definitions"></a>RDF Representation of FHIR
            Definitions</h3>
      <a name="class"></a>
        <p> In addition to the basic representation of FHIR resources in
          Turtle format, a Turtle representation of the FHIR
          infrastructure and definitions is also published, for the
          following purposes: </p>
        <ul>
          <li>Providing the class definitions to support RDF based
            representation of resource instances</li>
          <li>Supporting knowledge-based analysis of the FHIR
            specification itself</li>
          <li>Providing knowledge of use at run-time for converting
            between FHIR and other content models</li>
          <li>Supporting reasoning across the information/terminology
            model boundary</li>
        </ul>
        <p> The RDF definitions are published as a series of Turtle
          files: <a href="rim.ttl">HL7 v3 RIM</a> (Reference
          Information Model) and <a href="fhir.ttl">FHIR</a>.&nbsp; <a
href="downloads.html">ShEx</a>
          schemas that describe FHIR's RDF format are also available.<br/>
        </p>

      <a name="ontologies"></a>
        <h3><a name="relationship"></a>Relationship Between RDF, FHIR,
          and Ontologies</h3> <span
            style="background-color: #ffffe6; border: 1px grey solid; padding-left: 3px; padding-right: 3px;"><b>Informative</b></span>
        <p> This page documents an RDF format that can be used to
          exchange FHIR data, on the basis that RDF is a universal
          information representation. Using RDF enables FHIR data to be
          used with other RDF data and RDF-aware applications to support
          inference, shared semantics across multiple standards and data
          formats, data integration, semantic data validation,
          compliance enforcement, SPARQL queries and other uses.
          Implementers using FHIR in this fashion should be aware of the
          relationship between FHIR's RDF format and other uses of
          ontologies. </p>
        <p> FHIR's RDF format is based on the same abstract information
          model as the <a href="xml.html">XML</a> and <a
            href="json.html">JSON</a> formats and carries the same
          information content. Resources are losslessly round-trippable
          between XML, JSON and RDF formats and data expressed in the
          RDF format corresponds closely to the XML and JSON formats in
          its look and feel, though a few additional FHIR-specific terms
          appear in the RDF format, as explained above:
          <code>fhir:nodeRole</code>, <code>fhir:treeRoot</code> and
          <code>fhir:v</code>. <br/>
        </p>
        <p> In addition to defining the RDF format, this specification provides <a
            href="downloads.html">an associated ontology</a>
          containing formal definitions of the classes and properties that
          appear in the RDF format. Ontologies that were designed
          independently almost always have some impedance mismatch when
          attempting to use them together. Many of the ontologies in the
          medical and life sciences domain are designed to capture facts
          about the world for research, such as the fact that the mitral
          valve is a kind of heart valve. But FHIR was designed to
          support the day-to-day operations of healthcare providers
          exchanging electronic health records (EHRs), and in this
          context, the orientation has historically been different. When
          using FHIR RDF with other ontologies, impedance differences
          are likely to show up in two main ways: </p>
        <ul>
          <li> <b>Records versus facts.</b> FHIR is oriented toward
            recording who did what ("Dr. Jones diagnosed patient x with
            viral pneumonia") rather than stating absolute medical facts
            ("patient x has viral pneumonia"). </li>
          <li> <b>Non-monotonicity.</b> RDF was designed to be
            monotonic, whereas FHIR has a few design aspects that would
            be non-monotonic if they were interpreted directly in RDF.
            (Monotonicity means that new data cannot invalidate previous
            conclusions; non-monotonicity means that previous
            conclusions can be invalidated by new data.) For example, a
            modifier extension indicates that the surrounding element's
            meaning will likely be misunderstood if the modifier
            extension is not understood. </li>
        </ul>
        <p> For both of these reasons, to maintain monotonicity in RDF,
          FHIR RDF should not be directly interpreted as stating facts.
          Transformations are required to remove or isolate
          non-monotonic elements and reconcile the records across time
          and perspective. </p>
        <p> Application developers should also be aware that some FHIR
          data attributes have a major impact on the interpretation of
          the enclosing data element: the meaning of the enclosing
          element cannot be determined in isolation. For example, a
          status of 'entered-in-error' means that the resource was
          created accidentally and should be ignored for most purposes.<br/>
        </p>

      <a name="using"></a>
        <h3><a name="guidance"></a>Usage Guidance</h3> <span
          style="background-color: #ffffe6; border: 1px grey solid; padding-left: 3px; padding-right: 3px;"><b>Informative</b></span>
        <p> Application developers wishing to use FHIR RDF will often
          need to perform the following rough steps, though exact steps
          will depend on your application: </p>
        <ol>
          <li>Convert FHIR XML or FHIR JSON data to/from FHIR RDF. Open
            source implementations that can perform this conversion
            include:
            <ul>
              <li><a href="https://hapifhir.io/">HAPI java reference
                  library</a> (Same code as
                used in the FHIR specification build process)</li>
              <li><a href="http://github.com/grahamegrieve/fhirserver">Delphi
                  reference implementation</a></li>
              <li>Check the <a
href="https://confluence.hl7.org/display/FHIR/Open+Source+Implementations">HL7
                  Open Source FHIR Implementations page,</a> in case new
                implementations have become available</li>
            </ul>
	    The <a href="https://fhircat.github.io/fhir-rdf-playground/">FHIR RDF Playground</a>
	    is also a handy browser-based tool for experimenting with
	    conversion of FHIR JSON to FHIR RDF.   It is not for production use.
          </li>
          <li> <a href="downloads.html">Download</a> the FHIR ontology.
          </li>
          <li> Download other ontologies that you wish to use with your
            application, such as the SNOMED-CT ontology. ( Because of
            license restrictions, the process of obtaining the SNOMED-CT
            ontology is more complex than a simple download. Some <a
              href="http://owl.cs.manchester.ac.uk/research/snomed/">guidance
              is provided here</a>. ) </li>
          <li> Create or obtain a bridge ontology that relates terms in
            the FHIR ontology to terms in your other ontologies. </li>
          <li> Load your FHIR RDF instance data and your ontologies into
            a reasoner and/or a triplestore, and perform SPARQL queries
            and/or reasoning. </li>
          <li> If you are creating FHIR RDF then you might also wish to
            validate it, using <a href="http://shex.io/">ShEx</a>. If so, you can <a
              href="fhir.shex">download the ShEx schema</a> for FHIR RDF
          </li>
        </ol>

        <a name="fhir-rdf-with-owl"></a>
        <h4>Using FHIR RDF with OWL</h4>
        <p>RDF lists use a ladder of rdf:first and rdf:rest properties. 
           This can cause problems in OWL DL, which disallows axioms
           over the rdf: namespace.  To work around this problem, OWL users
           can convert RDF lists in their FHIR data to a different list
	   representation. 
	   A <a href="https://github.com/w3c/hcls-fhir-rdf/tree/gh-pages/scripts/owl-safe-lists">script</a> 
           is available for doing such a conversion.
           </p>

        <a name="tutorials"></a>
        <h4>Tutorials</h4>
        <p> <a
            href="https://www.w3.org/2016/Talks/1205-swat4ls-egp/reasoning">Slides
            by Eric Prud'hommeaux</a> illustrate how
          inference can be used on FHIR RDF data to perform a query for
          FHIR Observations of rheumatoid arthritis, using the <a
            href="https://www.nlm.nih.gov/healthit/snomedct/international.html">SNOMED-CT
            ontology</a>.   <i>Caveat: These slides were based on an earlier
	    version of FHIR, so some specifics may have changed.</i>
        <br/>
        </p>

        <p>
        A <a
href="https://yosemiteproject.org/fhir-rdf-as-a-bridge-to-the-semantic-web-in-healthcare/">webinar
          by Harold Solbrig</a> shows how FHIR RDF data can be used with
        the <a
          href="https://www.nlm.nih.gov/healthit/snomedct/international.html">SNOMED-CT
          ontology</a> to recognize a cancer diagnosis.&nbsp; An <a
href="https://yosemiteproject.org/tutorial-fhir-rdf-as-a-bridge-to-the-semantic-web-in-healthcare/">associated
          tutorial</a> details the steps used.&nbsp; <i>Caveat: This
          webinar and tutorial were based on a previous version of FHIR RDF, 
	  so some specifics may have changed.<br/>
        </i>
        </p>

        <h3><a name="concept-iri-algorithm"></a>Appendix 1: Algorithm for
          Creating a Concept IRI</h3>
        <p>This section defines a standard algorithm for generating a
          Concept IRI from a &lt;<code>Coding.system</code>, <code>Coding.code</code>&gt;
          pair.&nbsp; In many cases it involves merely concatenating the
          associated IRI Stem with the <code>Coding.code</code>.&nbsp;
          But because a <code>Coding.code</code> could contain reserved
          characters that are used to delineate different parts of the
          IRI, percent-encoding of reserved characters is required, as
          defined below.<br/>
          <br/>
          Given:<br/>
        </p>
        <ul>
          <li>a FHIR <code>Coding.system</code>, <i>s</i>, that
            identifies a terminology <i>t</i>; and </li>
          <li>a <code>Coding.code</code>, <i>c</i>, that is defined
            within <i>t</i>;</li>
        </ul>
        <p>a Concept IRI, <i>conceptIRI</i>, corresponding to <i>s</i>
          and <i>c</i> is computed as follows:<br/>
        </p>
        <ol>
          <li>If no IRI Stem is defined for <i>s</i> in the <a
              href="https://terminology.hl7.org/">HL7 Terminology
              website</a>, then <i>conceptIRI</i> is undefined. Halt.</li>
          <li>Let <i>iStem</i> be an IRI Stem that is defined for <i>s</i>
            in the HL7 Terminology website.&nbsp; </li>
          <li>As a special case, if <i>iStem</i> equals<code>
              urn:ietf:rfc:3987</code>, then <i>conceptIRI</i> is <i>c</i>,
            and <i>c</i> MUST be a syntactically valid absolute-IRI as
            defined by <a
              href="https://datatracker.ietf.org/doc/html/rfc3987">RFC
              3987</a>.&nbsp; Halt.&nbsp; (Informative comments: The
            purpose of this special case is to permit <code>System.code</code>s
            that are already IRIs to be used directly as Concept IRIs,
            without any transformation. Note that an absolute-IRI may
            also be a URL or a URN.)</li>
          <li>Let <i>cSafe</i> be the IRI-safe version of <i>c</i>, as
            defined by the algorithm in <a
              href="https://www.w3.org/TR/2012/REC-r2rml-20120927/#from-template">section
              7.3 of R2RML: RDB to RDF Mapping Language (W3C
              Recommendation 27 September 2012)</a>, quoted here for convenience (informative):<br/>
            <blockquote> <i>The <b>IRI-safe version</b> of a string is
                obtained by applying the following transformation to any
                character that is not in the <a
                  href="http://tools.ietf.org/html/rfc3987#section-2.2">iunreserved
                  production</a> in [RFC3987]:</i><i><br/>
              </i>
              <blockquote><i> 1. Convert the character to a sequence of
                  one or more octets using UTF-8 [RFC3629]</i><i><br/>
                </i><i> 2. <a
                    href="http://tools.ietf.org/html/rfc3986#section-2.1">Percent-encode</a>
                  each octet [RFC3986]</i><br/>
              </blockquote>
            </blockquote>
            The iunreserved production defined in <a
              href="https://datatracker.ietf.org/doc/html/rfc3987#section-2.2">RFC
              3987, section 2.2</a> using <a
              href="https://datatracker.ietf.org/doc/html/rfc2234">ABNF</a>
            is also quoted here for convenience (informative):<br/>
            <blockquote> <code>iunreserved&nbsp;&nbsp;&nbsp; = ALPHA /
                DIGIT / "-" / "." / "_" / "~" / ucschar</code><br/>
            </blockquote>
            The ucschar production defined in <a
              href="https://datatracker.ietf.org/doc/html/rfc3987#section-2.2">RFC

              3987, section 2.2</a> is also quoted here
            for convenience (informative).&nbsp; (Informative comment: The ucschar
            production defines international character ranges that are
            valid unicode characters within the intersection of path
            components (ipath), query strings (iquery) and fragment
            identifiers (ifragment).&nbsp; They do not include any
            reserved characters involved in parsing apart the various
            components of an IRI.)<br/>
            <blockquote> <code>ucschar&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                = %xA0-D7FF / %xF900-FDCF / %xFDF0-FFEF</code><code><br/>
              </code><code>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                / %x10000-1FFFD / %x20000-2FFFD / %x30000-3FFFD</code><code><br/>
              </code><code>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                / %x40000-4FFFD / %x50000-5FFFD / %x60000-6FFFD</code><code><br/>
              </code><code>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                / %x70000-7FFFD / %x80000-8FFFD / %x90000-9FFFD</code><code><br/>
              </code><code>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                / %xA0000-AFFFD / %xB0000-BFFFD / %xC0000-CFFFD</code><code><br/>
              </code><code>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                / %xD0000-DFFFD / %xE1000-EFFFD</code><br/>
            </blockquote>
          </li>
          <li> <i>conceptIRI</i> is the result of concatenating <i>iStem</i>
            and <i> cSafe.</i>  Halt.</li>
        </ol>
        <br/>
        Some real and hypothetical examples are shown in the following
        table.<br/>
        <br/>
        <table style="border: 1px solid gray; border-collapse: collapse; ">
          <tbody>
            <tr>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code class="rdf" style="font-size: larger"><b><span>Coding.system</span></b></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code class="rdf" style="font-size: larger"><b><span>Coding.code</span></b></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><b><span>IRI Stem</span></b></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><b><span>Concept IRI</span></b></p>
              </td>
            </tr>
            <tr>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p>ICD 10:<code><span><br/>
                    </span></code><code><span>http://hl7.org/fhir/sid/icd-10</span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code><span>G44.1</span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code><span>http://purl.bioontology.org/ontology/ICD10/</span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code><span>http://purl.bioontology.org/ontology/ICD10/G44.1</span></code><code><span>&nbsp;</span></code></p>
              </td>
            </tr>
            <tr>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p>SNOMED CT:*<code><span><br/>
                    </span></code><code><span>http://snomed.info/sct</span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code><span>128045006</span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code><span>http://snomed.info/id/</span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code><span>http://snomed.info/id/128045006</span></code></p>
              </td>
            </tr>

            <tr>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p>MeSH: <code><span>https://www.nlm.nih.gov/mesh</span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code><span>D000305</span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code><span>https://id.nlm.nih.gov/mesh/ </span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code><span>https://id.nlm.nih.gov/mesh/D000305 </span></code></p>
              </td>
            </tr>
            <tr>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p>LOINC: <code><span>http://loinc.org</span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code><span>35217-9</span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code><span>https://loinc.org/rdf/</span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code><span>https://loinc.org/rdf/35217-9</span></code></p>
              </td>
            </tr>
            <tr>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p>Example coding system that uses a Unicode smiling
                  face character (U+263A) as a code:<code><span><br/>
                    </span></code><code><span>http://example.org/</span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code class="rdf"><span style="font-size: larger"><span style="font-size: larger"></span></span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code><span>http://example.org/</span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code class="rdf">http://example.org/<span style="font-size: larger"><span style="font-size: larger"></span></span></code></p>
              </td>
            </tr>
            <tr>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p>Example coding system that uses a Unicode waving hand
                  character (U+1F44B) from the <a
href="https://www.google.com/url?q=https://en.wikipedia.org/wiki/Miscellaneous_Symbols_and_Pictographs&amp;sa=D&amp;source=editors&amp;ust=1661857750967890&amp;usg=AOvVaw3NF72CBQp0L6mXw4Z2Uolw">Miscellaneous

                    Symbols and Pictographs</a><a
href="https://www.google.com/url?q=https://en.wikipedia.org/wiki/Miscellaneous_Symbols_and_Pictographs&amp;sa=D&amp;source=editors&amp;ust=1661857750968211&amp;usg=AOvVaw0jUA8uygpG7xOCF5gdRbUq">&nbsp;block</a>,
                  combined with the medium-dark skin tone (U+1F3FE):<code><span><br/>
                    </span></code><code><span>http://example.org/</span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code class="rdf"><span style="font-size: larger"></span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code><span>http://example.org/ </span></code></p>
              </td>
              <td colspan="1" rowspan="1" style="border: 1px solid gray; padding: 2px; ">
                <p><code class="rdf">http://example.org/<span style="font-size: larger"></span></code><code><span>&nbsp;</span></code></p>
              </td>
            </tr>
          </tbody>
        </table>
<p>
*As of this writing (5-Sep-2022) it is not clear what IRI stem should be used when writing a SNOMED CT post-coordinated code expression.
</p>

        <a name="registering-iri-stems"></a>
          <h3>Appendix 2: Registering an IRI Stem on the HL7 Terminology Website</h3>

          <p>
          IRI stems have not been standardized for all FHIR
          <code>Coding.system</code>s.  But any that have been
          standardized should be registered in the HL7 terminology
          website by adding appropriate CodeSystem and NamingSystem
          entries, using the system "urn:ietf:rfc:3987" and 
          <a href="https://build.fhir.org/valueset-identifier-type.html">identifier type</a> 
          of "iri-stem". You can see an
          example of this in the HL7 description of the 
          <a href="https://terminology.hl7.org/CodeSystem-v3-loinc.json.html">LOINC CodeSystem</a> 
          and the 
          <a href="https://terminology.hl7.org/NamingSystem-v3-loinc.html">LOINC NamingSystem</a>. 
          Assuming that the <code>Coding.system</code>
          for your desired IRI stem has already been registered, the
          process for registering an IRI stem for it includes:
          </p>
          
          <ol>
          <li>Select the most authoritative, community-supported IRI stem
          available for this Coding.system.  The IRI stem SHOULD be taken
          from an official publication of the organization that publishes
          the terminology (such as the LOINC User Guide mentioned above).
          If no such IRI stem is defined by the organization, and the
          organization fails to define or endorse one even after repeated
          requests, and the organization appears unlikely to define one
          in the foreseeable future, then a community-defined IRI stem
          MAY be registered.  In this case, it should be an IRI stem
          most commonly used by the community as recorded by several
          RDF IRI stem repositories, such as 
          <a href="https://bioregistry.io/">Bioregistry</a>,
          <a href="https://prefix.cc/">prefix.cc</a>, 
          <a href="https://obofoundry.org/">OBO Foundry</a> or Wikidata 
          (by means of <a href="https://www.wikidata.org/wiki/Property:P1921">wdt:P1921</a>).
          </li>

          <li>The IRI stem MUST be in the form of an IRI as defined by the 
          <a href="http://tools.ietf.org/html/rfc3987#section-2.2">IRI
          production in RFC 3987</a>. This means that the IRI stem
          MUST start with a "scheme:" string, such as "http:",
          "https:", "urn:" or any other valid scheme, followed by an
          authority, followed by any number of path parts and an optional
          query and fragment. Examples of valid IRI stems include:
            <ul>
            <li><code>doi:10.1111/</code></li>
            <li><code>urn:loinc.org:</code> &nbsp;&nbsp;&nbsp;&nbsp;<i>&larr; Note the trailing colon (":")</i></li>
            <li><code>http://loinc.org/rdf/</code></li>
            <li><code>http://purl.obolibrary.org/obo/HP_</code>  &nbsp;&nbsp;&nbsp;&nbsp;<i>&larr; Note the trailing underscore ("_")</i></li>
            <li><code>https://example.org/terminologies/?action=search&amp;id=</code></li>
            <li><code>ftp://user@example.org:2222/loinc/</code></li>
            </ul>
          </li>

          <li>
          The IRI stem MUST be intended to be used by concatenating it
          with a FHIR code as described in the 
          <a href="#concept-iri-algorithm">Appendix 1: Algorithm for creating a Concept IRI"</a>.  
          Therefore, care must be taken
          to ensure that the code can be concatenated to the IRI stem
          without altering the IRI stem's meaning, including:
            <ol>
            <li>The IRI stem SHOULD end with a delimiter character (one
            of the <code>gen-delims</code> or <code>sub-delims</code> productions from 
            <a href="https://datatracker.ietf.org/doc/html/rfc3987#section-2.2">section 2.2 of RFC 3987</a>
            or one of the characters "-", ".", "_"
            or "~") . An IRI stem that ends with an alphanumeric
            character is likely to have the meaning of the final term
            altered when the code is concatenated.  For example, an IRI
            stem of "http://example.org" when concatenated with the code
            "39" will result in a concept IRI of "http://example.org39",
            which is probably not the concept IRI intended.
            </li>

            <li>Since FHIR codes are percent-encoded before being
            concatenated with the IRI stem, it is unlikely that it
            will alter the meaning of the IRI stem. However, note
            that the characters `-`, `.`, `_`, `~` will NOT be percent
            encoded. Thus, if the IRI stem is `http://hospital.org`, a
            code of `.attacker.com` could be used to generate a concept
            IRI of `http://hospital.org.attacker.com`, which if resolved
            as a URL could provide information to an unexpected server
            name.
            </li>
            </ol>
         </li>

	 <li>
	   <p>On the HL7 Terminology website (<a href="https://terminology.hl7.org">https://terminology.hl7.org</a>),
	   add the IRI stem to the NamingSystem and CodeSystem records
	   corresponding to the desired Coding.system, by following the
	   <a href="https://confluence.hl7.org/display/VMAH/How+To+Submit+a+UTG+Change+Proposal">process for submitting a UTG change proposal</a>. The IRI stem
	   SHOULD be added to both the NamingSystem and the CodeSystem.
	   Additions, deletions and modifications of an IRI stem to
	   an existing NamingSystem or CodeSystem will generally be
	   considered a minor change under the <a href="https://confluence.hl7.org/display/VOC/Documented+Execution+of+UTG+Versioning">UTG Versioning policy</a>.
	   </p>

	   <p>As of this writing (17-Dec-2022), the change proposal
	   process for doing this included the following steps.  However,
	   since the process may have later changed, you should 
	   <a href="https://confluence.hl7.org/display/VMAH/How+To+Submit+a+UTG+Change+Proposal">verify it</a> 
	   prior to proceeding.  You can also see an example of such
	   a change proposal, including the associated changes in the
	   XML files, in the <a href="https://jira.hl7.org/browse/UP-377">MeSH IRI stem change proposal</a>.
	   </p>

	   <ol>
	     <li>Record the IRI stem in a CodeSystem by adding an identifier with:
	       <ul>
	         <li> system: urn:ietf:rfc:3987</li>
	         <li>type: Coding with system=http://terminology.hl7.org/CodeSystem/v2-0203 and code="IRISTEM"</li>
	         <li>value: <i>[the IRI stem]</i></li>
	         <li>period: <i>[optionally, the period during which this IRI stem was in use]</i></li>
	         <li>assigner:
		   <ul><li>display: <i>[documentation of the provenance of the IRI stem]</i></li></ul>
	         </li>
	       </ul>
	     </li>

	     <li>Record the IRI stem in a NamingSystem by adding a uniqueId with:
	       <ul>
                 <li>type: iri-stem</li>
		 <li>value: <i>[the IRI stem]</i></li>
		 <li>period: <i>[optionally, the period during which this IRI stem was in use]</i></li>
		 <li>comment: <i>[documentation of the provenance of the IRI stem]</i></li>
		 <li>preferred: <i>false [since an IRI stem is unlikely to also be the primary identifier]</i></li>
		 <li>authoritative: <i>[true if this IRI stem is officially recognized by the NamingSystem authority, false if this IRI stem is generally used in the RDF community but is not officially designated as such]</i></li>
		</ul>
	     </li>
	   </ol>
	 </li>

	 <li>If the current process for registering an IRI stem differs from the above steps, please:
	   <ol>
	     <li><a href="https://jira.hl7.org/issues/?jql=text%20~%20%22Registering%20an%20IRI%20Stem%20(RDF%20Subgroup)%22">Search the Jira issue tracker</a> 
	       for an issue titled "Registering an IRI Stem (RDF Subgroup)".
             </li>
	     <li>If no such issue is found, <a href="https://jira.hl7.org/secure/CreateIssue!default.jspa">file an issue</a> 
	        with that title, describing how the above steps should be updated.
	     </li>
            </ol>
	 </li>

         </ol>

[%file newfooter%]
</body>
</html>

