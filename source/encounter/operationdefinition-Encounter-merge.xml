<?xml version="1.0" encoding="UTF-8"?>

<OperationDefinition xmlns="http://hl7.org/fhir" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://hl7.org/fhir ../../publish/OperationDefinition.xsd">
  <id value="Encounter-merge"/>
  <meta>
    <lastUpdated value="2025-08-30T10:01:24.148+02:00"/>
  </meta>
  <extension url="http://hl7.org/fhir/StructureDefinition/structuredefinition-fmm">
    <valueInteger value="0"/>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/structuredefinition-standards-status">
    <valueCode value="trial-use"/>
  </extension>
  <extension url="http://hl7.org/fhir/build/StructureDefinition/example">
    <extension url="list">
      <valueString value="1"/>
    </extension>
    <extension url="response">
      <valueBoolean value="false"/>
    </extension>
    <extension url="content">
      <valueString value="$merge-request.txt"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/build/StructureDefinition/example">
    <extension url="list">
      <valueString value="1"/>
    </extension>
    <extension url="response">
      <valueBoolean value="true"/>
    </extension>
    <extension url="content">
      <valueString value="$merge-response.txt"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/build/StructureDefinition/example">
    <extension url="list">
      <valueString value="1"/>
    </extension>
    <extension url="response">
      <valueBoolean value="true"/>
    </extension>
    <extension url="content">
      <valueString value="$merge-provenance.txt"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/build/StructureDefinition/footer">
    <valueMarkdown value="There must be exactly 1 source encounter, which may be identified by either the source-encounter or source-encounter-identifier parameters. Similarly, there must be exactly 1 target encounter, identified by either the target-encounter or target-encounter-identifier parameters. In both cases, either a reference to the encounter or a list of identifiers that can be used to identify the encounter may be provided, but not both.&#xD;&#xD;The result-encounter.id must be the same as the target encounter reference (if the encounter reference is provided as an input parameter).&#xD;&#xD;If a client needs the server to create a new encounter merged from the 2 encounter resources, the client should create a new encounter record and then call the merge operation to merge each source encounter resource into the newly created encounter resource.&#xD;&#xD;A server may decide to delete the source record, but this is not defined by the standard merge operation, and if this occurs then the target encounter's link property will remain unchanged.&#xD;"/>
  </extension>
  <url value="http://hl7.org/fhir/OperationDefinition/Encounter-merge"/>
  <version value="6.0.0"/>
  <name value="Merge"/>
  <title value="Encounter Merge"/>
  <status value="draft"/>
  <kind value="operation"/>
  <date value="2025-08-30T10:01:24.148+02:00"/>
  <publisher value="HL7 (FHIR Project)"/>
  <contact>
    <telecom>
      <system value="url"/>
      <value value="http://hl7.org/fhir"/>
    </telecom>
    <telecom>
      <system value="email"/>
      <value value="fhir@lists.hl7.org"/>
    </telecom>
  </contact>
  <description value="The merge operation is used to request two encounter resources be merged. One of the two encounter is identified as the source and one as the target. The target is the remaining encounter resource (survivor), the source will be marked as inactive (or in some systems deleted).&#xD;&#xD;The source-encounter resource will be updated to add a new link reference to the target-encounter resource (link-type=replaced-by in the record-linkage extension), and also update the status to inactive (unless the resource was deleted)&#xD;&#xD;The target-encounter resource will be updated to add a new link reference to the source-encounter resource (link-type=replaces in the record-linkage extension) - and must be included in the result-encounter parameter if used (if the source encounter is deleted, then this link is not required)."/>
  <jurisdiction>
    <coding>
      <system value="http://unstats.un.org/unsd/methods/m49/m49.htm"/>
      <code value="001"/>
      <display value="World"/>
    </coding>
  </jurisdiction>
  <affectsState value="true"/>
  <code value="merge"/>
  <comment value="There must be exactly 1 source encounter, which may be identified by either the source-encounter or source-encounter-identifier parameters. Similarly, there must be exactly 1 target encounter, identified by either the target-encounter or target-encounter-identifier parameters. In both cases, either a reference to the encounter or a list of identifiers that can be used to identify the encounter may be provided, but not both.&#xD;&#xD;The result-encounter.id must be the same as the target encounter reference (if the encounter reference is provided as an input parameter).&#xD;&#xD;If a client needs the server to create a new encounter merged from the 2 encounter resources, the client should create a new encounter record and then call the merge operation to merge each source encounter resource into the newly created encounter resource.&#xD;&#xD;A server may decide to delete the source record, but this is not defined by the standard merge operation, and if this occurs then the target encounter's link property will remain unchanged."/>
  <resource value="Encounter"/>
  <system value="false"/>
  <type value="true"/>
  <instance value="false"/>
  <parameter>
    <name value="source-encounter"/>
    <use value="in"/>
    <min value="0"/>
    <max value="1"/>
    <documentation value="A direct resource reference to the **source** encounter resource (this may include an identifier)."/>
    <type value="Reference"/>
    <targetProfile value="http://hl7.org/fhir/StructureDefinition/Encounter"/>
  </parameter>
  <parameter>
    <name value="source-encounter-identifier"/>
    <use value="in"/>
    <min value="0"/>
    <max value="*"/>
    <documentation value="When source-encounter-identifiers are provided, the server is expected to perform an internal lookup to identify the **source** encounter. The server SHALL reject the request if the provided identifiers do not resolve to a single encounter record. This resolution MAY occur asynchronously, for example, as part of a review by a user."/>
    <type value="Identifier"/>
  </parameter>
  <parameter>
    <name value="target-encounter"/>
    <use value="in"/>
    <min value="0"/>
    <max value="1"/>
    <documentation value="A direct resource reference to the **target** encounter resource.&#xD;&#xD;This is the surviving encounter resource, the target for the merge."/>
    <type value="Reference"/>
    <targetProfile value="http://hl7.org/fhir/StructureDefinition/Encounter"/>
  </parameter>
  <parameter>
    <name value="target-encounter-identifier"/>
    <use value="in"/>
    <min value="0"/>
    <max value="*"/>
    <documentation value="When target-encounter-identifiers are provided, the server is expected to perform an internal lookup to identify the target encounter record. The server SHALL reject the request if the provided identifiers do not resolve to a single encounter record. This resolution MAY occur asynchronously, for example, as part of a review by a user."/>
    <type value="Identifier"/>
  </parameter>
  <parameter>
    <name value="result-encounter"/>
    <use value="in"/>
    <min value="0"/>
    <max value="1"/>
    <documentation value="The details of the Encounter resource that is expected to be updated to complete with and must have the same encounter.id and provided identifiers included.&#xD;&#xD;This resource MUST have the record-linkage extension with a link=replaces referencing the source encounter resource.&#xD;&#xD;It will be used to perform an update on the target encounter resource.&#xD;&#xD;In the absence of this parameter the servers should copy all identifiers from the source encounter into the target encounter, and include the record-linkage extension (as shown in the example below).&#xD;&#xD;This is often used when properties from the source encounter are desired to be included in the target resource.&#xD;&#xD;The receiving system may also apply other internal business rules onto the merge which may make the resource different from what is provided here."/>
    <type value="Encounter"/>
  </parameter>
  <parameter>
    <name value="preview"/>
    <use value="in"/>
    <min value="0"/>
    <max value="1"/>
    <documentation value="If this is set to true then the merge will not be actually performed; an OperationOutcome will be returned in the Parameters response that will indicate that no merge has occurred and may include other diagnostic info if desired, such as the scale of the merge.&#xD;&#xD;e.g. Issue.details.text &quot;Preview only Encounter merge - no issues detected&quot;&#xD;&#xD;e.g. Issue.diagnostics &quot;Merge would update: 10 years of content or 120 resources&quot;&#xD;&#xD;The resulting target encounter resource will also be returned in the result."/>
    <type value="boolean"/>
  </parameter>
  <parameter>
    <name value="return"/>
    <use value="out"/>
    <min value="1"/>
    <max value="1"/>
    <documentation value="The status of the response will be one of:&#xD;&#xD;* 200 OK - If the merge request doesn't expect any issues (although warning may be present) for a preview, or was completed without issues if not a preview&#xD;* 202 Accepted - The merge request has been accepted and does not expect any issues and will continue processing the merge in the background, and you can monitor the Task for completion&#xD;* 400 Bad Request - There are errors in the input parameters that need to corrected&#xD;* 422 Unprocessable Entity - Business rules prevent this merge from completing&#xD;&#xD;The Parameters resource will include:&#xD;&#xD;* The Input parameters to the operation&#xD;* An OperationOutcome containing errors, warnings, and information messages&#xD;* The resulting merged Encounter resource (or an encounter reference if the encounter is not committed)&#xD;* Optionally a Task resource to track any additional processing that was required.&#xD;&#xD;Note: as this is the only out parameter, it is a resource, and it has the name 'return', the result of this operation is returned directly as a resource"/>
    <type value="Parameters"/>
  </parameter>
</OperationDefinition>