<!DOCTYPE HTML>
[%settitle Terminology Service%]
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
[%file newheader%]
</head>
<body>
[%file newnavbar%]

<%txheader service%>

<h2>Terminology Service</h2>
<table class="colsn"><tr><td id="wg">Responsible Owner: <a _target="blank" href="[%wg vocab%]">[%wgt vocab%]</a> Work Group</td><td id="ballot"><a href="versions.html#std-process">Standards Status</a>:<!--!ns!--><a href="versions.html#std-process">Normative</a></td></tr></table>
<p>
This specification includes support for the provision of a terminology service - that is, a
service that lets healthcare applications make use of codes and value sets without having to become
experts in the fine details of code system, value set and concept map resources, and the underlying
code systems and terminological principles.
</p>
<a name="conformance"></a>
<h3>Conformance</h3>
A server that supports the mandatory functionality described in the following subsections can be described as a "FHIR Terminology Service".
<a name="restfulapi"></a>
<h4>RESTful API</h4>
<p>
A FHIR terminology service SHALL support:
</p>
<ul>
  <li>the <a href="xml.html">XML</a> and <a href="json.html">JSON</a> FHIR formats.</li>
  <li>the <a href="http.html#read">READ</a> and <a href="http.html#search">SEARCH</a> interactions for <code>CodeSystem</code>, <code>ValueSet</code> and <code>ConceptMap</code></li>
  <li>the following elements as search parameters for <code>CodeSystem</code>, <code>ValueSet</code> and <code>ConceptMap</code>
    <ul>
      <li><code>url</code></li>
      <li><code>version</code></li>
      <li><code>name</code></li>
      <li><code>title</code></li>
      <li><code>status</code></li>
    </ul>
  </li>
  <li>the <a href="http.html#capabilities">capabilities interaction</a> with an absent <code>mode</code> parameter or a <code>mode</code> parameter with a value of <code>full</code> returning a <a href="capabilitystatement.html">CapabilityStatement</a> resource which includes the following elements (plus the other requirements for a conformant CapabilityStatement resource instance):
  <ul>
    <li><code>url</code></li>
    <li><code>version</code></li>
    <li><code>name</code></li>
    <li><code>title</code></li>
    <li><code>status</code></li>
    <li><code>date</code></li>
    <li><code>description</code></li>
    <li><code>kind</code> with a fixed value of <code>instance</code></li>
    <li><code>fhirVersion</code></li>
  </ul>
  </li>
  <li>the <a href="http.html#capabilities">capabilities interaction</a> with a <code>mode</code> parameter with a value of <code>terminology</code> returning a <a href="terminologycapabilities.html">TerminologyCapabilities</a> resource which includes the following elements:
    <ul>
      <li><code>url</code></li>
      <li><code>name</code></li>
      <li><code>title</code></li>
      <li><code>status</code></li>
      <li><code>date</code></li>
      <li><code>kind</code> with a fixed value of <code>instance</code></li>
      <li>A <code>codeSystem</code> data element containing each of the following sub elements for each code system supported for terminology services:
        <ul>
          <li><code>codeSystem.uri</code></li>
          <li><code>codeSystem.version</code> (for code systems with a version)</li>
          <li><code>codeSystem.version.code</code> (for each version)</li>    
          <li><code>codeSystem.content</code></li>    
        </ul>
      </li>
    </ul>
    </li>  
</ul>
<a name="operations"></a>
<h4>Terminology Service Operations</h4>
A FHIR Terminology Service SHALL support the following operations with the associated level and required input parameters:
<table class="grid">
  <tr>
    <td><b>Operation</b></td>
    <td><b>System Level</b></td>
    <td><b>Type Level</b></td>
    <td><b>Instance Level</b></td>
    <td><b>Required input parameters</b></td>
  </tr>
  <tr>
    <td><a href="codesystem-operation-lookup.html">CodeSystem-lookup</a></td>
    <td>N/A</td>
    <td>Yes</td>
    <td>No</td>
    <td>
      <ul>
        <li><code>code</code></li>
        <li><code>system</code></li>   
        <li><code>version</code></li>   
      </ul>
    </td>
  </tr>
  <tr>
    <td><a href="codesystem-operation-validate-code.html">CodeSystem-validate-code</a></td>
    <td>N/A</td>
    <td>Yes</td>
    <td>No</td>
    <td>
      <ul>
        <li><code>code</code></li>
        <li><code>system</code></li>   
        <li><code>version</code></li>   
        <li><code>display</code></li>   
      </ul>
    </td>
  </tr>
  <tr>
    <td><a href="codesystem-operation-subsumes.html">CodeSystem-subsumes</a></td>
    <td>N/A</td>
    <td>Yes</td>
    <td>No</td>
    <td>
      <ul>
        <li><code>codeA</code></li>
        <li><code>codeB</code></li>   
        <li><code>system</code></li>   
        <li><code>version</code></li>   
      </ul>
    </td>
  </tr>
  <tr>
    <td><a href="valueset-operation-expand.html">ValueSet-expand</a></td>
    <td>N/A</td>
    <td>Yes</td>
    <td>Yes</td>
    <td>
      <ul>
        <li><code>url</code></li>
        <li><code>filter</code></li>
        <li><code>offset</code></li>   
        <li><code>count</code></li>   
      </ul>
    </td>
  </tr>
  <tr>
    <td><a href="valueset-operation-validate-code.html">ValueSet-validate-code</a></td>
    <td>N/A</td>
    <td>Yes</td>
    <td>Yes</td>
    <td>
      <ul>
        <li><code>url</code></li>
        <li><code>code</code></li>
        <li><code>system</code></li>   
        <li><code>systemVersion</code></li>   
        <li><code>display</code></li>   
      </ul>
    </td>
  </tr>
  <tr>
    <td><a href="conceptmap-operation-translate.html">ConceptMap-translate</a></td>
    <td>N/A</td>
    <td>Yes</td>
    <td>Yes</td>
    <td>
      <ul>
        <li><code>url</code></li>
        <li><code>sourceCode</code></li>
        <li><code>system</code></li>   
        <li><code>targetCode</code></li>   
        <li><code>targetSystem</code></li>   
      </ul>
    </td>
  </tr>
</table>
[%impl-note%]
Implementers may choose to follow and optionally implement the additional operations being developed as part of the HL7 Terminology Infrastructure Work Group FHIR Implementation Guide.
[%end-note%]
<a name="examples"></a>
<h4>CapabilityStatement and TerminologyCapabilities examples</h4>
<ul>
  <li><a href="capabilitystatement-terminology-server.html">FHIR Terminology Service Capability Statement</a></li>
  <li><a href="terminologycapabilities-terminology-server.html">FHIR Terminology Service Terminology Capabilities</a>. Note that in this example the code systems referenced in TerminologyCapabilities.codeSystem data elements are examples and support for these should not be considered a mandatory requirement for a FHIR Terminology Service.</li>
</ul>
<a name="security"></a>
<h3>Security</h3>
<p>
Generally, SSL SHOULD be used for all production health care data exchange.
Even though terminology servers do not generally handle patient information directly,
observers may still be able to infer information about patients by observing
the codes and concepts used in terminology service operations, so
encryption is still recommended.
</p>
<p>
A terminology server may choose not to authenticate the clients/users in any fashion,
but might need to do so in order to limit or account for usage, or enforce agreement to licensing terms.
For a value set maintenance server that allows terminologies to be edited,
some form of <a href="security.html">authorization and/or authentication would be appropriate</a>.
This specification does not require any particular approach to security.
</p>
<a name="concepts"></a>
<h3>Basic Concepts</h3>
<p>
A FHIR terminology service is simply a set of functions built on the definitions
provided by a collection of <a href="codesystem.html">CodeSystem</a>,  <a href="valueset.html">ValueSet</a>  and
<a href="conceptmap.html">ConceptMap</a> resources, with additional inherently known terminologies providing support.
</p>
<p>
The terminology service builds on the basic principles for using terminologies
in FHIR. Implementers should be familiar with:
</p>
<ul>
 <li><a href="terminologies.html">Using codes in FHIR</a></li>
 <li>The <a href="codesystem.html">CodeSystem</a> resource</li>
 <li>The <a href="valueset.html">ValueSet</a> resource</li>
 <li>The <a href="conceptmap.html">ConceptMap</a> resource</li>
</ul>
<p>
In addition, implementers should be familiar with the <a href="operations.html">operations
framework</a>. Further useful information about terminologies may be found in:
</p>
<ul>
 <li>Underlying Principles: <a href="http://www.hl7.org/documentcenter/public/standards/V3/core_principles/infrastructure/coreprinciples/v3modelcoreprinciples.html">HL7 v3 Core Principles</a></li>
 <li>SNOMED CT <a href="http://ihtsdo.org/fileadmin/user_upload/doc/">technical documentation</a>. Note: "namespace" is used differently here from the way it is used by IHTSDO (see <a href="terminologies.html">discussion here</a>)</li>
</ul>

<a name="externals"></a>
<h4>External Code Systems</h4>
<p>
In order to be used with a value set, code systems and their content must be defined somewhere. They can be defined explicitly
using the <a href="codesystem.html">code system resource</a>, or they can be defined elsewhere, and then used in a value set
by referencing the correct system url. HL7 Terminology defines a <a href="https://terminology.hl7.org/external_terminologies_csti.html">set of
technical identifiers</a> for commonly encountered code systems, and defines how some work with FHIR (e.g.
<a href="https://terminology.hl7.org/SNOMEDCT.html">SNOMED CT</a>, <a href="https://terminology.hl7.org/LOINC.html">LOINC</a>, and <a href="https://terminology.hl7.org/RxNorm.html">RxNorm</a>).
These code systems are often large and have many internally defined properties that are part of their
formal definitions. The CodeSystem resource is not an appropriate way to distribute the contents of
these code systems; the standard FHIR code system resource simply represents the properties of
the code system. Instead, these terminologies provide their own distribution formats, and it is assumed that the
content of these code systems are externally known to the terminology server.
</p>
<p>
Most useful terminology servers will make one or more of these external code systems available for use
within the value sets that they manage. The list of additional terminologies that a terminology server supports
beyond those defined in its value sets is published to clients by referencing code system resources in
the server's <a href="capabilitystatement.html">Capability Statement</a>.
</p>
<pre class="json">
{
 "resourceType" : "CapabilityStatement",
 "extension" : [
   {
     "url" : "http://hl7.org/fhir/StructureDefinition/capabilitystatement-supported-system",
     "valueUri" : "http://loinc.org"
   }]
}
</pre>
<p>
This extension is added to the root <a href="capabilitystatement.html">Capability Statement</a>.
</p>

<a name="impl1"></a>
<h4>Implementation Note</h4>
<p>When a terminology server exposes an external code system, it makes a set of services available
internally that serve the operational interfaces below (starting in <a href="#expand">Value Set Expansion</a>). The internal server depends on the following
logical information for a terminology:
</p>
<ul>
  <li> its URL (namespace, and how versioning works)</li>
  <li> what codes are valid  </li>
  <li> what properties can be used to select codes </li>
  <li> what implicit value sets exist </li>
</ul>
<p>
HL7 Terminology defines these things for common terminologies (including
<a href="https://terminology.hl7.org/SNOMEDCT.html">SNOMED CT</a>, <a href="https://terminology.hl7.org/LOINC.html">LOINC</a>, and <a href="https://terminology.hl7.org/RxNorm.html">RxNorm</a>),
  and the FHIR specification itself provides the <a href="codesystem.html">CodeSystem</a> infrastructure for supporting typical relatively simple small code systems.
</p>
[%impl-note%]
<i>Implementers interested in working with existing published terminologies for
which the CodeSystem infrastructure is not suitable should discuss their needs with HL7 to get the
list above extended.</i>
[%end-note%]

<p>
Note: A terminology service may choose to expose additional external code system specific
related functionality such as summation, or structured search, but these services are
outside the scope of the FHIR terminology service.
</p>

<a name="maint"></a>
<h4>Terminology Maintenance</h4>
<p>
The terminology service uses the code systems and value set resources defined on the system - both
the implicit ones associated with the external code systems and those explicitly
available at the /CodeSystem and /ValueSet endpoints - to serve the operational interface defined below (starting in <a href="#expand">Value Set Expansion</a>).
As code systems and value sets are created, updated or deleted, the outcomes of the operational
services change. A terminology server should validate incoming resources and ensure integrity
of the terminology services. Typically, servers provide a test and production
environment, but there is no explicit notion of this in the interface itself.
</p>

<a name="expand"></a>
<h3>Value Set Expansion</h3>
<p>
A value set describes a set of rules for what codes or concepts are considered to be in the value set.
These rules might be simple (e.g. a direct list of codes from a specified version of a code system), or
they might be quite complex (e.g. all codes with a particular property from an unspecified version of
a code system).
</p>
<p>
A FHIR-enabled application can simply ask a terminology server to figure out all the details and return a list
of the current codes in the value set. This is known as <a href="valueset-operation-expand.html">"expanding" the valueset</a>.
As a summary, the client passes the server the following information:
</p>
<ul>
 <li> the value set (either by its URL on the RESTful interface, by its logical identifier <a href="valueset-definitions.html#ValueSet.url">(ValueSet.url)</a>, or directly as a parameter to the call)</li>
 <li> (Optionally) a text filter to use to restrict the codes that are returned (e.g. user input text). It is left to server discretion to choose how to apply the text filter</li>
 <li> (Optionally) a date at which the expansion should be evaluated (usually, this is the current date/time, but there are circumstances where that is not appropriate)</li>
 <li> (Optionally) which page to retrieve - asking the server to break the expansion into a set of chunks</li>
 <li> (Optionally) other parameters that supply additional information about how to perform the expansion</li>
</ul>

<p>
The server returns a value set that contains the current list of codes that meet the filter criteria (or an
<a href="operationoutcome.html">OperationOutcome</a> with an error if the expansion fails).
Note that some value sets expand to many thousands of codes, or even an infinite number,
and for these, the server SHOULD return an <a href="valueset-issue-type.html#too-costly">error code
<i>too-costly</i></a>. In these cases, the client can try again with a more specific text filter
to reduce the number of codes returned - this may result in a valid expansion.
</p>
<p>
For further information, consult the <a href="valueset-operation-expand.html">definition of the operation</a>.
</p>
<p>
The <a href="valueset-operation-expand.html">$expand</a> operation has support for paging - for a client to retrieve a big expansion
in a set of partial views, in order to present the most optimal user experience.
The client specifies both an offset and a count - how many codes per page, and where in the sequence
to start. The return expansion specifies the number of concepts in the expansion, and the offset
at which this partial view starts. Note that all expansions SHOULD include the total code count,
but the offset element SHALL only exist when paging is being used. Expansions that are hierarchical
trees of concepts are not subject to paging and the server simply returns the entire expansion.
</p>
<p>
Some example uses for the expansion operation:
</p>
<ul>
 <li> get a list of codes to display in a User interface (e.g. a drop-down interface)</li>
 <li> a variation on this is to offer the user a text box to type in. As the user types, call the expand operation to provide the user with a list of matching codes/concepts (like a browser search) </li>
 <li> fetch a list of codes to use when generating software programming instructions</li>
 <li> get a list of codes so that software can check whether a code is valid or not in a specific context</li>
</ul>


<div class="example">
<p><b>Examples</b></p>
<p>
Expanding a value set that is already registered on the server as "23", with a text filter of "abdo":
</p>
<pre class="http">
GET [base]/ValueSet/23/$expand?filter=abdo
</pre>
<p>
Expanding a value set that is specified by the client (using JSON):
</p>
<pre class="http">
POST [base]/ValueSet/$expand
[other headers]

{
  "resourceType" : "Parameters",
  "parameter" : [
     {
     "name" : "valueSet",
     "resource" : {
       "resourceType" : "ValueSet",
     [value set details]
     }
   }
  ]
}
</pre>
<p>
The server responds with a value set (this example in XML):
</p>
<pre class="http">
HTTP/1.1 200 OK
[other headers]

&lt;ValueSet xmlns=&quot;http://hl7.org/fhir&quot;&gt;
  &lt;!-- the server SHOULD populate the id with a newly created UUID
    so clients can easily track a particular expansion  --&gt;
  &lt;id value=&quot;43770626-f685-4ba8-8d66-fb63e674c467&quot;/&gt;
  &lt;!-- no need for meta, though it is allowed for security labels, profiles --&gt;

  &lt;!-- other value set details --&gt;
  &lt;expansion&gt;
    &lt;!-- when expanded --&gt;
    &lt;timestamp value=&quot;20141203T08:50:00+11:00&quot;/&gt;
  &lt;contains&gt;
    &lt;!-- expansion contents --&gt;
  &lt;/contains&gt;
  &lt;/expansion&gt;
&lt;/ValueSet&gt;
</pre>
</div>

<a name="lookup"></a>
<h3>Concept Lookup / Decomposition</h3>
<p>
A system can ask a terminology server to return a set of information about a particular system/code
combination using <a href="codesystem-operation-lookup.html">the lookup operation</a>. The server returns information for both display and processing
purposes. The client passes the server the following information:
</p>
<ul>
 <li> the code value (either a code, or a Coding datatype)</li>
 <li> (Optionally) the id or the url of the code system in which the code is being checked</li>
 <li> (Optionally) a date at which the code information should be returned (usually, this is the current date/time, but there are circumstances where that is not appropriate)</li>
 <li> (Optionally) a set of properties to return about the code</li>
</ul>
<p>
The server returns some or all of the following information:
</p>
<ul>
 <li> a human description of the system</li>
 <li> a recommended display for the code </li>
 <li> properties of the code (e.g. status) </li>
 <li> other designations for the code (a value, optionally with language and/or a use code)</li>
 <li> relationships between this code and other codes (parent/child properties, etc.)</li>
 <li> Component properties of the specified code (e.g. to support reasoning) (e.g. decomposition)</li>
</ul>
<p>
The recommended display for the code is a text representation of the code that the
terminology server recommends as the default choice to show to the user, though a
client may choose out of the other designations if it has reason to.
</p>
<p>
If the client does not ask for any particular properties to be returned, it is at the discretion
of the server to decide which properties to return (though note that the "version" property is always
returned if the code system has a version).
</p>


<div class="example">
<p><b>Examples</b></p>
<p>
Looking up a code in a code system:
</p>
<pre class="http">
GET [base]/CodeSystem/loinc/$lookup?code=1963-8
</pre>
<p>
Note that the logical id "loinc" is not a reliable identifier across systems; each server assigns
logical ids to code system resources however it sees fit. A more reliable query is this:
</p>
<pre class="http">
GET [base]/CodeSystem/$lookup?system=http://loinc.org&amp;code=1963-8&amp;property=code&amp;property=display&amp;property=designations
</pre>
<p>
Lookup the code system using a Coding (this example in XML):
</p>
<pre class="http">
POST [base]/CodeSystem/$lookup
[other headers]

&lt;Parameters xmlns=&quot;http://hl7.org/fhir&quot;&gt;
  &lt;parameter&gt;
    &lt;name value=&quot;coding&quot;/&gt;
    &lt;valueCoding&gt;
      &lt;system value=&quot;http://loinc.org&quot;/&gt;
      &lt;code value=&quot;1963-8&quot;/&gt;
    &lt;/valueCoding&gt;
  &lt;/parameter&gt;
&lt;/Parameters&gt;
</pre>
<p>
The server responds with a set of information (JSON this time):
</p>
<pre class="http">
HTTP/1.1 200 OK
[other headers]

{
  "resourceType" : "Parameters",
  "parameter" : [
    {
    "name" : "name",
    "valueString" : "LOINC"
  },
  {
    "name" : "version",
    "valueString" : "2.56"
  },
  {
    "name" : "display",
    "valueString" : "Bicarbonate [Moles/volume] in Serum or Plasma"
  },
  {
    "name" : "abstract",
    "valueString" : "false"
  }
  ]
}
</pre>
</div>

<a name="standard-props"></a>
<h4>Standard $lookup Properties</h4>
<p>
  The following property names are defined in response to the $lookup operation from all code systems: 
</p>
<table class="grid">
 <tr>
  <td><b>Name</b></td>
  <td><b>Usage</b></td>
  <td><b>Source</b></td>
 </tr>
 <tr>
  <td>name</td>
  <td>The name of the code system</td>
  <td>system</td>
 </tr>
 <tr>
  <td>version</td>
  <td>The version of the code system used for the look up operation</td>
  <td>system</td>
 </tr>
 <tr>
  <td>display</td>
  <td>The recommended display for the concept, if one is known</td>
  <td>designation</td>
 </tr>
 <tr>
  <td>designation</td>
  <td>Other designations for the concept</td>
  <td>designation</td>
 </tr>
 <tr>
  <td>lang.X</td>
  <td>Designations in language X (where X is an IETF Language code, see <a href="https://www.rfc-editor.org/rfc/rfc5646.html">BCP-47)</a></td>
  <td>designation</td>
 </tr>
</table>
<p>
In addition, any property codes defined by <a href="codesystem.html#defined-props">this specification</a>
or by the CodeSystem (<a href="codesystem-definitions.html#CodeSystem.property">CodeSystem.property.code</a>) 
can be returned (and see the definitions for <a href="https://terminology.hl7.org/SNOMEDCT.html">SNOMED CT</a>, 
<a href="https://terminology.hl7.org/LOINC.html">LOINC</a>, and <a href="https://terminology.hl7.org/RxNorm.html">RxNorm</a> in HL7 Terminology).
</p>

<a name="validation"></a>
<h3>Value Set Validation</h3>
<p>
One way to determine whether a code is in a value set is to expand the value set
(as described above), and then look at the returned codes to see if the code is in the expansion.
However, this is not an efficient way to test whether a code is valid, and for some value sets
(e.g. with infinite number of members), it cannot work. Instead, a FHIR terminology server
provides <a href="valueset-operation-validate-code.html">a "validate-code" operation</a>. The client passes the server the following information:
</p>
<ul>
 <li> the value set (either by its URL on the RESTful interface, by its logical identifier <a href="valueset-definitions.html#ValueSet.url">(ValueSet.url)</a>, or directly as a parameter to the call)</li>
 <li> the code value (either a code + system, a Coding datatype, or a CodeableConcept)</li>
 <li> (Optionally) a date at which the expansion should be evaluated (usually, and by default, this is the current date/time, but there are circumstances where that is not appropriate)</li>
</ul>
<p>
The server returns a true/false indicating whether the code/concept is valid, and a list
of errors and warnings associated with it. The server should also return an appropriate
display for the concept for use in a UI context.
</p>
<p>
Note that if the server is passed a CodeableConcept, the server is able to check
whether any of the codes are valid against the value set, and also check whether
multiple codings are allowed and/or the codings provided are consistent with each other.
</p>
<p>
Every code system has an implicit value set that is "all the concepts defined
in the code system" (CodeSystem.valueSet). For some code systems, these value set URIs are defined
in advance (e.g. for <a href="http://loinc.org">LOINC</a>, it is <code>http://loinc.org/vs</code>).
However, for some code systems, they are not known. Clients can refer to these implicit
value sets by providing the URI for the code system itself.
</p>

<div class="example">
<p><b>Examples</b></p>
<p>
Simple validation of a code/system against a known value set:
</p>
<pre class="http">
GET [base]/ValueSet/23/$validate-code?system=http://loinc.org&amp;code=1963-8&amp;display=test
</pre>
<p>
Validate a CodeableConcept against a client specified value set (this example in JSON):
</p>
<pre class="http">
POST [base]/ValueSet/$validate-code
[other headers]

{
  "ResourceType" : "Parameters",
  "parameter" : [
    {
    "name" : "coding",
    "valueCodeableConcept" : {
      "coding" : {
        "system" : "http://loinc.org",
          "code" : "1963-8",
      "display" : "test"
      }
    }
  },
  {
    "name" : "valueSet",
    "resource": {
      "resourceType" : "ValueSet",
    [etc.]
    }
  }
  ]
}
</pre>
<p>
The server responds with validation information (JSON this time):
</p>
<pre class="http">
HTTP/1.1 200 OK
[other headers]

{
  "resourceType" : "Parameters",
  "parameter" : [
    {
    "name" : "result",
    "valueBoolean" : false
  },
  {
    "name" : "message",
    "valueString" : "The display \"test\" is incorrect"
  },
  {
    "name" : "display",
    "valueString" : "Bicarbonate [Moles/volume] in Serum or Plasma"
  }
  ]
}
</pre>
</div>

<a name="subsumes"></a>
<h3>Subsumption testing</h3>
<p>
To test the subsumption relationship between <i>code/Coding A</i> and <i>code/Coding B</i>, perform a $subsumes operation.
Subsumption testing is based on <a href="codesystem.html#subsumption">the CodeSystem definition of subsumption</a>.
The client passes the server the following information:
</p>
<ul>
 <li> the system that identifies the code system in which subsumption testing is to be performed (either by invoking the operation on the code system directly, or referring to it by its canonical URL)</li>
 <li> Concepts A and B - either as codes, or Codings</li>
 <li> (Optionally) the version of the code system to use (mostly, this should not matter)</li>
</ul>
<p>
If the client passes Codings, it is allowed to use code system values that are different from the code system in which subsumption testing is to be performed.  In this case, the server SHALL return an error unless the relationships between the various code systems is well defined.
</p>
<p>
If the concepts can be compared, then the server returns an outcome code:
</p>
<table class="none">
 <tr><td>equivalent</td><td>Concepts A and B are equivalent</td></tr>
 <tr><td>subsumes</td><td>Concept A subsumes Concept B</td></tr>
 <tr><td>subsumed-by</td><td>Concept A is subsumed by Concept B</td></tr>
 <tr><td>not-subsumed</td><td>Concepts A and B are not related by any subsumption relationship</td></tr>
</table>

<div class="example">
<p><b>Examples</b></p>
<p>
Test whether a SNOMED CT Concept 'Disorder of liver' (235856003) subsumes 'Viral hepatitis' (3738000):
</p>
<pre class="http">
GET [base]/CodeSystem/$subsumes?system=http://snomed.info/sct&amp;codeA=235856003&amp;codeB=3738000
</pre>
<p>
Or using Codings:
</p>
<pre class="http">

POST [base]/CodeSystem/$subsumes
[other headers]

&lt;Parameters xmlns=&quot;http://hl7.org/fhir&quot;&gt;
  &lt;!-- Subsumption testing - use SNOMED CT rules --&gt;
  &lt;parameter&gt;
    &lt;name value=&quot;system&quot;/&gt;
    &lt;valueUri value=&quot;http://snomed.info/sct&quot;/&gt;
  &lt;/parameter&gt;
  &lt;!-- Australian distribution --&gt;
  &lt;parameter&gt;
    &lt;name value=&quot;version&quot;/&gt;
    &lt;valueString value=&quot;http://snomed.info/sct/32506021000036107/version/20160430&quot;/&gt;
  &lt;/parameter&gt;
  &lt;parameter&gt;
    &lt;name value=&quot;codingA&quot;/&gt;
    &lt;valueCoding&gt;
      &lt;system value=&quot;http://snomed.info/sct&quot;/&gt;
      &lt;code value=&quot;235856003&quot;/&gt;
    &lt;/valueCoding&gt;
  &lt;/parameter&gt;
  &lt;parameter&gt;
    &lt;name value=&quot;codingB&quot;/&gt;
    &lt;valueCoding&gt;
      &lt;system value=&quot;http://snomed.info/sct&quot;/&gt;
      &lt;code value=&quot;3738000&quot;/&gt;
    &lt;/valueCoding&gt;
  &lt;/parameter&gt;
&lt;/Parameters&gt;
</pre>
<p>
Server response:
</p>
<pre class="http">
HTTP/1.1 200 OK
[other headers]

{
  "resourceType" : "Parameters",
  "parameter" : [
    {
    "name" : "outcome",
    "valueCode" : "subsumes"
  },
  ]
}
</pre>
</div>

<a name="batch"></a>
<h3>Batch Validation</h3>

<p>
It is also possible to validate a set of concepts against their relevant value
sets by using the <code>$validate-code</code> operation in a <a href="http.html#batch">Batch</a>
interaction.
</p>

<div class="example">
<p><b>Example</b></p>
<p>
A request to validate 2 concepts from a <a href="http://www.hl7.org/implement/standards/product_brief.cfm?product_id=7">CDA</a> document, with OIDs for value set identifiers:
</p>
<pre class="http">
POST [base]
[other headers]

{
  "ResourceType": "Bundle",
  "type": "batch",
  "entry": [{
    "request": {
      "method": "Get",
      "url": "ValueSet/$validate-code?system=http://loinc.org&amp;code=2324-4&amp;uri=urn:oid:1.2.3.4.6"
    }
  },
  {
    "request": {
      "method": "GET",
      "url": "ValueSet/$validate-code?system=http://snomed.info/sct&amp;codes=22298006&amp;uri=urn:oid:1.2.3.4.7"
    }
  }]
}
</pre>

<p>
The server responds with a series of validation outcomes (JSON this time):
</p>
<pre class="http">
HTTP/1.1 200 OK
[other headers]

{
  "ResourceType": "Bundle",
  "type": "batch-response",
  "entry": [{
    "resource": {
      "resourceType": "Parameters",
      "parameter": [{
        "name": "result",
        "valueBoolean": false
      },
      {
        "name": "message",
        "valueString": "'2324-4' is not a valid LOINC code"
      }]
    }
  },
  {
    "resource": {
      "resourceType": "Parameters",
      "parameter": [{
        "name": "result",
        "valueBoolean": false
      },
      {
        "name": "message",
        "valueString": "The concept is not in the specified value set (\"Organisms\")"
      },
      {
        "name": "display",
        "valueString": "Myocardial infarction"
      }]
    }]
  }
</pre>

</div>


<a name="translate"></a>
<h3>Translations</h3>
<p>
A client can ask a server to translate a concept from one value set to another. Typically, this
is used to translate between code systems (e.g. from LOINC to SNOMED CT, or from a <a href="https://www.hl7.org/implement/standards/product_brief.cfm?product_id=186">HL7 V3</a> code to
a <a href="http://www.hl7.org/implement/standards/product_brief.cfm?product_id=185">HL7 V2</a> code). The client calls <a href="conceptmap-operation-translate.html">the translate operation</a> and passes the following parameters:
</p>
<ul>
  <li>a code + system, Coding, or CodeableConcept</li>
  <li>a Concept Map to use for the translation</li>
  <li>the value set for the context of the source </li>
  <li>the value set for the destination</li>
</ul>
<p>
The client passes either a concept map, or the value sets for the source and destination context.
If there is no concept map, then the server may determine the appropriate map to use from
context provided in the value sets.
If there is no particular context, the appropriate value sets would be the value sets for the
entire coding system at question (e.g. from http://snomed.info/sct to http://loinc.org/vs).
The server performs the translation as it is able based on the concept maps that it knows about.
If no single mapping can be determined, then the
server returns an error. Some servers may require a concept map to use for the translation.
</p>

<div class="example">
<p><b>Example</b></p>
<p>
Translate from FHIR Composition status to <a href="https://www.hl7.org/implement/standards/product_brief.cfm?product_id=186">HL7 v3</a> Act Status (based on
<a href="cm-composition-status-v3.html">this defined concept map</a>):
</p>
<pre class="http">
GET [base]/ConceptMap/$translate?system=http://hl7.org/fhir/composition-status
  &amp;code=preliminary&amp;source=http://hl7.org/fhir/ValueSet/composition-status
  &amp;target=http://terminology.hl7.org/ValueSet/v3-ActStatus
</pre>
<p>
The server responds with validation information:
</p>
<pre class="http">
HTTP/1.1 200 OK
[other headers]

{
  "resourceType" : "Parameters",
  "parameter" : [
    {
    "name" : "result",
    "valueBoolean" : true
    },
    {
      "name" : "outcome",
      "valueCoding" : {
        "system" : "http://terminology.hl7.org/CodeSystem/v3-ActStatus",
        "code" : "active",
      }
    }
  ]
}
</pre>
</div>


<a name="batch2"></a>
<h3>Batch Translation</h3>

<p>
It is also possible to translate a set of concepts against their relevant value
sets by using the <code>$translate</code> operation in a <a href="http.html#batch">Batch</a>
interaction.
</p>

<div class="example">
<p><b>Example</b></p>
<p>
A request to translate 2 concepts from a <a href="http://www.hl7.org/implement/standards/product_brief.cfm?product_id=7">CDA</a> document, with OIDs for value set identifiers:
</p>
<pre class="http">
POST [base]
[other headers]

{
  "ResourceType": "Bundle",
  "type": "batch",
  "entry": [{
    "resource": {
      "ResourceType": "Parameters",
      "parameter": [{
        "name": "concept",
        "valueCodeableConcept": {
          "system": "http://loinc.org",
          "code": "2324-4"
        }
      },
      {
        "name": "target",
        "valueUri": "urn:oid:1.2.3.4.6"
      }]
    },
    "request": {
      "method": "POST",
      "url": "ConceptMap/$translate"
    }
  },
  {
    "resource": {
      "ResourceType": "Parameters",
      "parameter": [{
        "name": "concept",
        "valueCodeableConcept": {
          "system": "http://snomed.info/sct",
          "code": "22298006"
        }
      },
      {
        "name": "target",
        "valueUri": "urn:oid:1.2.3.4.7"
      }]
    },
    {
      "request": {
        "method": "POST",
        "url": "ConceptMap/$translate"
      }
    }]
  }
</pre>
<p>
The server responds with a series of translation outcomes:
</p>
<pre class="http">
HTTP/1.1 200 OK
[other headers]

{
  "ResourceType": "Bundle",
  "type": "batch-response",
  "entry": [{
    "resource": {
      "resourceType": "Parameters",
      "parameter": [{
        "name": "result",
        "valueBoolean": false
      },
      {
        "name": "message",
        "valueString": "'2324-4' is not a valid LOINC code"
      }]
    }
  },
  {
    "resource": {
      "resourceType": "Parameters",
      "parameter": [{
        "name": "result",
        "valueBoolean": true
      },
      {
        "name": "outcome",
        "valueCodeableConcept": {
          "coding": {
            "system": "http://example.com/codesystems/example",
            "code": "xxxx"
          }
        }
      }]
    }
  }]
}
</pre>

</div>

[%file newfooter%]


</body>
</html>
