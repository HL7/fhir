<?xml version="1.0" encoding="UTF-8"?>
<ExampleScenario xmlns="http://hl7.org/fhir" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://hl7.org/fhir ../../schema/fhir-single.xsd">
  <id value="example"/>
  <title value="KDN5 Chemotherapy protocol lookup, instanciation and execution"/>
  <status value="draft"/>
  <description value="This scenario demonstrates the chemotherapy......."/>
  <purpose value="Blah blah"/>
  <!-- First define actors-->
  <actor>
    <key value="MD"/>
    <type value="person"/>
    <title value="Physician"/>
    <description value="The Physician"/>
  </actor>
  <actor>
    <key value="CAT"/>
    <type value="system"/>
    <title value="Catalog system"/>
    <description value="The system that holds the catalogs"/>
  </actor>
  <actor>
    <key value="CPOE"/>
    <type value="system"/>
    <title value="CPOE"/>
    <description value="The system where the order entry takes place"/>
  </actor>
  <!-- Then define the resource instances -->
  <instance>
    <key value="iherx001"/>
    <structureType>
      <system value="http://hl7.org/fhir/fhir-types"/>
      <code value="MedicationRequest"/>
    </structureType>
    <title value="Initial Prescription"/>
    <description value="The initial prescription which describes &quot;medication X, 3 times per day&quot; - the exact scheduling is not   in the initial prescription (it is left for the care teams to decide on the schedule)."/>
  </instance>
  <instance>
    <key value="iherx001.001"/>
    <structureType>
      <system value="http://hl7.org/fhir/fhir-types"/>
      <code value="MedicationRequest"/>
    </structureType>
    <title value="Request for day 1, morning"/>
    <description value="The administration request for day 1, morning"/>
  </instance>
  <instance>
    <key value="iherx001.002"/>
    <structureType>
      <system value="http://hl7.org/fhir/fhir-types"/>
      <code value="MedicationRequest"/>
    </structureType>
    <title value="Request for day 1, lunch"/>
    <description value="The administration request for day 1, lunch"/>
  </instance>
  <instance>
    <key value="iherx001.003"/>
    <structureType>
      <system value="http://hl7.org/fhir/fhir-types"/>
      <code value="MedicationRequest"/>
    </structureType>
    <title value="Request for day 1, evening"/>
    <description value="The administration request for day 1, evening"/>
  </instance>
  <instance>
    <key value="iherx001.004"/>
    <structureType>
      <system value="http://hl7.org/fhir/fhir-types"/>
      <code value="MedicationRequest"/>
    </structureType>
    <title value="Request for day 2, morning"/>
    <description value="The administration request for day 2, morning"/>
  </instance>
  <instance>
    <key value="iherx001.005"/>
    <structureType>
      <system value="http://hl7.org/fhir/fhir-types"/>
      <code value="MedicationRequest"/>
    </structureType>
    <title value="Request for day 2, lunch"/>
    <description value="The administration request for day 2, lunch"/>
  </instance>
  <instance>
    <key value="iherx001.006"/>
    <structureType>
      <system value="http://hl7.org/fhir/fhir-types"/>
      <code value="MedicationRequest"/>
    </structureType>
    <title value="Request for day 2, evening"/>
    <description value="The administration request for day 2, evening"/>
  </instance>
  <instance>
    <key value="iheadm001a"/>
    <structureType>
      <system value="http://hl7.org/fhir/fhir-types"/>
      <code value="MedicationAdministration"/>
    </structureType>
    <title value="Morning meds - taken"/>
    <description value="Administration report for day 1, morning: Taken"/>
  </instance>
  <instance>
    <key value="iheadm001b"/>
    <structureType>
      <system value="http://hl7.org/fhir/fhir-types"/>
      <code value="MedicationAdministration"/>
    </structureType>
    <title value="Morning meds - not taken"/>
    <description value="Administration report for day 1, morning: NOT Taken"/>
  </instance>
  <instance>
    <key value="iherx001bundle"/>
    <structureType>
      <system value="http://hl7.org/fhir/fhir-types"/>
      <code value="MedicationRequest"/>
    </structureType>
    <title value="Bundle of Medication Requests"/>
    <description value="All the medication Requests for Day 1"/>
    <containedInstance>
      <instanceReference value="iherx001.001"/>
    </containedInstance>
    <containedInstance>
      <instanceReference value="iherx001.002"/>
    </containedInstance>
    <containedInstance>
      <instanceReference value="iherx001.003"/>
    </containedInstance>
    <containedInstance>
      <instanceReference value="iherx001.004"/>
    </containedInstance>
    <containedInstance>
      <instanceReference value="iherx001.005"/>
    </containedInstance>
    <containedInstance>
      <instanceReference value="iherx001.006"/>
    </containedInstance>
  </instance>
  <instance>
    <key value="iheadm002"/>
    <structureType>
      <system value="http://hl7.org/fhir/fhir-types"/>
      <code value="MedicationAdministration"/>
    </structureType>
    <title value="Lunch meds - taken"/>
    <description value="Administration report for day 1, lunch: Taken"/>
    <version>
      <key value="iheadm002v1"/>
      <description value="Medication just taken"/>
    </version>
    <version>
      <key value="iheadm002v2"/>
      <description value="Medication rejected"/>
    </version>
  </instance>
  <!-- QUESTION: How to define search actions?-->
  <instance>
    <key value="iherxqry"/>
    <structureType>
      <system value="http://hl7.org/fhir/fhir-types"/>
      <code value="SearchParameter"/>
    </structureType>
    <title value="Search query1"/>
    <description value="The search administration request for day 1, morning"/>
  </instance>
  <process>
    <title value="Mobile Medication Administration"/>
    <description value="Mobile Medication Administration"/>
    <preConditions value="Medication administration requests are in the EHR / MAR, scheduled for each individual intake."/>
    <postConditions value="Medication administration Reports are submitted, EHR is updated."/>
    <step>
      <number value="1"/>
      <operation>
        <title value="1. Get today's schedule"/>
        <initiator value="Nurse"/>
        <receiver value="MAP"/>
      </operation>
    </step>
    <step>
      <number value="2"/>
      <operation>
        <title value="2.Query for medication administration orders,\n- For today's shifts\n- For today's patients"/>
        <initiator value="MAP"/>
        <receiver value="OP"/>
        <request>
          <instanceReference value="iherxqry"/>
        </request>
        <response>
          <instanceReference value="iherx001bundle"/>
        </response>
      </operation>
      <pause value="true"/>
    </step>
    <step>
      <number value="4"/>
      <operation>
        <title value="Notify (alert)"/>
        <initiator value="MAP"/>
        <receiver value="Nurse"/>
      </operation>
    </step>
    <step>
      <number value="5"/>
      <operation>
        <title value="Read orders"/>
        <initiator value="Nurse"/>
        <receiver value="MAP"/>
      </operation>
      <pause value="true"/>
    </step>
    <step>
      <number value="5"/>
      <operation>
        <title value="Ask if patient took meds"/>
        <initiator value="Nurse"/>
        <receiver value="Nurse"/>
      </operation>
    </step>
    <step>
      <alternative>
        <title value="Patient took drugs"/>
        <description value="Invoke if patient took medications"/>
        <step>
          <number value="1a"/>
          <operation>
            <title value="Register Meds taken"/>
            <initiator value="Nurse"/>
            <receiver value="MAP"/>
            <initiatorActive value="true"/>
          </operation>
        </step>
      </alternative>
      <alternative>
        <title value="No drugs"/>
        <description value="Invoke if patient did not take medications"/>
        <step>
          <number value="1b"/>
          <operation>
            <title value="Register Meds NOT taken"/>
            <initiator value="Nurse"/>
            <receiver value="MAP"/>
            <initiatorActive value="true"/>
          </operation>
        </step>
      </alternative>
      <alternative>
        <title value="Unclear"/>
        <description value="It is not known if the patient took medicaitons or not"/>
      </alternative>
      <pause value="true"/>
    </step>
    <step>
      <number value="6"/>
      <operation>
        <title value="Administer drug"/>
        <initiator value="Nurse"/>
        <receiver value="Nurse"/>
      </operation>
    </step>
    <step>
      <number value="7"/>
      <operation>
        <title value="Register administration"/>
        <initiator value="Nurse"/>
        <receiver value="MAP"/>
        <initiatorActive value="true"/>
      </operation>
      <pause value="true"/>
    </step>
    <step>
      <process>
        <title value="P2. Update administration reports"/>
        <step>
          <number value="8"/>
          <operation>
            <title value="Nurse updates administration report"/>
            <initiator value="Nurse"/>
            <receiver value="MAP"/>
            <initiatorActive value="true"/>
            <request>
              <instanceReference value="iheadm002"/>
            </request>
          </operation>
        </step>
      </process>
      <pause value="true"/>
    </step>
    <step>
      <process>
        <title value="P3. Upload administration reports"/>
        <description value="The nurse's system uploads the administration results to the server"/>
        <step>
          <number value="9"/>
          <operation>
            <title value="Refresh"/>
            <initiator value="MAP"/>
            <receiver value="MAC"/>
            <request>
              <instanceReference value="iheadm001"/>
            </request>
          </operation>
        </step>
      </process>
    </step>
  </process>
</ExampleScenario>
