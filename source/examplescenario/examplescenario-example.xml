<?xml version="1.0" encoding="UTF-8"?>
<ExampleScenario xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://hl7.org/fhir ../../schema/fhir-single.xsd">
  <id value="example"/>
  <status value="draft"/>
  <purpose value="Purpose: this serves to enable remote performing of medication administration, by using remote / mobile devices to a) Get the planned medication administrations and b) Record the performing of these administrations without a permanent connection to the EHR."/>
  <!-- First define actors-->
  <actor>
    <key value="Nurse"/>
    <type value="person"/>
    <title value="Nurse"/>
    <description value="The Nurse"/>
  </actor>
  <actor>
    <key value="MAP"/>
    <type value="entity"/>
    <title value="Nurse's Tablet"/>
    <description value="The entity that receives the Administration Requests to show the nurse to perform them"/>
  </actor>
  <actor>
    <key value="OP"/>
    <type value="entity"/>
    <title value="MAR / Scheduler"/>
    <description value="The Medication Administration Order Placer"/>
  </actor>
  <actor>
    <key value="MAC"/>
    <type value="entity"/>
    <title value="MAR / EHR"/>
    <description value="The entity that receives the Medication Administration reports"/>
  </actor>
  <!-- Then define the resource instances -->
  <instance>
    <key value="iherx001"/>
    <type>
      <system value="http://hl7.org/fhir/resource-types"/>
      <code value="MedicationRequest"/>
    </type>
    <title value="Initial Prescription"/>
    <description value="The initial prescription which describes &quot;medication X, 3 times per day&quot; - the exact scheduling is not   in the initial prescription (it is left for the care teams to decide on the schedule)."/>
  </instance>
  <instance>
    <key value="iherx001.001"/>
    <type>
      <system value="http://hl7.org/fhir/resource-types"/>
      <code value="MedicationRequest"/>
    </type>
    <title value="Request for day 1, morning"/>
    <description value="The administration request for day 1, morning"/>
  </instance>
  <instance>
    <key value="iherx001.002"/>
    <type>
      <system value="http://hl7.org/fhir/resource-types"/>
      <code value="MedicationRequest"/>
    </type>
    <title value="Request for day 1, lunch"/>
    <description value="The administration request for day 1, lunch"/>
  </instance>
  <instance>
    <key value="iherx001.003"/>
    <type>
      <system value="http://hl7.org/fhir/resource-types"/>
      <code value="MedicationRequest"/>
    </type>
    <title value="Request for day 1, evening"/>
    <description value="The administration request for day 1, evening"/>
  </instance>
  <instance>
    <key value="iherx001.004"/>
    <type>
      <system value="http://hl7.org/fhir/resource-types"/>
      <code value="MedicationRequest"/>
    </type>
    <title value="Request for day 2, morning"/>
    <description value="The administration request for day 2, morning"/>
  </instance>
  <instance>
    <key value="iherx001.005"/>
    <type>
      <system value="http://hl7.org/fhir/resource-types"/>
      <code value="MedicationRequest"/>
    </type>
    <title value="Request for day 2, lunch"/>
    <description value="The administration request for day 2, lunch"/>
  </instance>
  <instance>
    <key value="iherx001.006"/>
    <type>
      <system value="http://hl7.org/fhir/resource-types"/>
      <code value="MedicationRequest"/>
    </type>
    <title value="Request for day 2, evening"/>
    <description value="The administration request for day 2, evening"/>
  </instance>
  <instance>
    <key value="iheadm001a"/>
    <type>
      <system value="http://hl7.org/fhir/resource-types"/>
      <code value="MedicationAdministration"/>
    </type>
    <title value="Morning meds - taken"/>
    <description value="Administration report for day 1, morning: Taken"/>
  </instance>
  <instance>
    <key value="iheadm001b"/>
    <type>
      <system value="http://hl7.org/fhir/resource-types"/>
      <code value="MedicationAdministration"/>
    </type>
    <title value="Morning meds - not taken"/>
    <description value="Administration report for day 1, morning: NOT Taken"/>
  </instance>
  <instance>
    <key value="iherx001bundle"/>
    <type>
      <system value="http://hl7.org/fhir/resource-types"/>
      <code value="MedicationRequest"/>
    </type>
    <title value="Bundle of Medication Requests"/>
    <description value="All the medication Requests for Day 1"/>
    <containedInstance>
      <key value="iherx001.001"/>
    </containedInstance>
    <containedInstance>
      <key value="iherx001.002"/>
    </containedInstance>
    <containedInstance>
      <key value="iherx001.003"/>
    </containedInstance>
    <containedInstance>
      <key value="iherx001.004"/>
    </containedInstance>
    <containedInstance>
      <key value="iherx001.005"/>
    </containedInstance>
    <containedInstance>
      <key value="iherx001.006"/>
    </containedInstance>
  </instance>
  <instance>
    <key value="iheadm002"/>
    <type>
      <system value="http://hl7.org/fhir/resource-types"/>
      <code value="MedicationAdministration"/>
    </type>
    <title value="Lunch meds - taken"/>
    <description value="Administration report for day 1, lunch: Taken"/>
    <version>
      <key value="iheadm002v1"/>
      <description value="Medication just taken"/>
    </version>
    <version>
      <key value="iheadm002v2"/>
      <description value="Medication rejected"/>
    </version>
  </instance>
  <!-- QUESTION: How to define search actions?-->
  <instance>
    <key value="iherxqry"/>
    <type>
      <system value="http://hl7.org/fhir/resource-types"/>
      <code value="SearchParameter"/>
    </type>
    <title value="Search query1"/>
    <description value="The search administration request for day 1, morning"/>
  </instance>
  <process>
    <title value="Mobile Medication Administration"/>
    <description value="This scenario demonstrates the process of getting the relevant medication instructions for a patient visit and reporting the results of administration. The scenario is as follows: After the prescription is issued, the institution schedules each individual administration event in the Medication Administration Record (MAR). When preparing for a visit, the nurse queries the MAR for the scheduled administrations, obtaining a bundle of records. The nurse then performs the care activities and registers the results in the device. Upon synchronization of the device and the institution, the results of administration are uploaded to the EHR, thus updating the MAR."/>
    <preConditions value="Medication administration requests are in the EHR / MAR, scheduled for each individual intake."/>
    <postConditions value="Medication administration Reports are submitted, EHR is updated."/>
    <step>
      <operation>
        <number value="1"/>
        <title value="1. Get today's schedule"/>
        <initiator value="Nurse"/>
        <receiver value="MAP"/>
      </operation>
    </step>
    <step>
      <process>
        <title value="P1. Query Administration Requests"/>
        <description value="Query for medication administration orders,\n- For today's shifts\n- For today's patients"/>
        <step>
          <operation>
            <number value="2"/>
            <title value="2.Query for medication administration orders,\n- For today's shifts\n- For today's patients"/>
            <initiator value="MAP"/>
            <receiver value="OP"/>
            <request>
              <key value="iherxqry"/>
            </request>
            <response>
              <key value="iherx001bundle"/>
            </response>
          </operation>
        </step>
      </process>
    </step>
    <step>
      <pause value="true"/>
    </step>
    <step>
      <operation>
        <number value="4"/>
        <title value="Notify (alert)"/>
        <initiator value="MAP"/>
        <receiver value="Nurse"/>
      </operation>
    </step>
    <step>
      <operation>
        <number value="5"/>
        <title value="Read orders"/>
        <initiator value="Nurse"/>
        <receiver value="MAP"/>
      </operation>
    </step>
    <step>
      <pause value="true"/>
    </step>
    <step>
      <operation>
        <number value="5"/>
        <title value="Ask if patient took meds"/>
        <initiator value="Nurse"/>
        <receiver value="Nurse"/>
      </operation>
    </step>
    <step>
      <alternative>
        <title value="Patient took drugs"/>
        <description value="Invoke if patient took medications"/>
        <step>
          <process>
            <title value="Register Meds taken"/>
            <step>
              <operation>
                <number value="1a"/>
                <title value="Register Meds taken"/>
                <initiator value="Nurse"/>
                <receiver value="MAP"/>
                <initiatorActive value="true"/>
              </operation>
            </step>
          </process>
        </step>
      </alternative>
      <alternative>
        <title value="No drugs"/>
        <description value="No, patient did not take drugs"/>
        <step>
          <process>
            <title value="Register Meds NOT taken"/>
            <step>
              <operation>
                <number value="1b"/>
                <title value="Register Meds NOT taken"/>
                <initiator value="Nurse"/>
                <receiver value="MAP"/>
                <initiatorActive value="true"/>
              </operation>
            </step>
          </process>
        </step>
      </alternative>
      <alternative>
        <title value="Not clear"/>
        <description value="Unknown whether patient took medications or not"/>
        <step>
          <pause value="true"/>
        </step>
      </alternative>
    </step>
    <step>
      <pause value="true"/>
    </step>
    <step>
      <operation>
        <number value="6"/>
        <title value="Administer drug"/>
        <initiator value="Nurse"/>
        <receiver value="Nurse"/>
      </operation>
    </step>
    <step>
      <operation>
        <number value="7"/>
        <title value="Register administration"/>
        <initiator value="Nurse"/>
        <receiver value="MAP"/>
        <initiatorActive value="true"/>
      </operation>
    </step>
    <step>
      <pause value="true"/>
    </step>
    <step>
      <process>
        <title value="P2. Update administration reports"/>
        <step>
          <operation>
            <number value="8"/>
            <title value="Nurse updates administration report"/>
            <initiator value="Nurse"/>
            <receiver value="MAP"/>
            <initiatorActive value="true"/>
            <request>
              <key value="iheadm002"/>
            </request>
          </operation>
        </step>
      </process>
    </step>
    <step>
      <pause value="true"/>
    </step>
    <step>
      <process>
        <title value="P3. Upload administration reports"/>
        <description value="The nurse's system uploads the administration results to the server"/>
        <step>
          <operation>
            <number value="9"/>
            <title value="Refresh"/>
            <initiator value="MAP"/>
            <receiver value="MAC"/>
            <request>
              <key value="iheadm001"/>
            </request>
          </operation>
        </step>
      </process>
    </step>
  </process>
</ExampleScenario>
