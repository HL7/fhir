<!DOCTYPE HTML>

[%settitle Search (RESTful API) %]
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
[%file newheader%]
</head>
<body>
[%file newnavbar%]



<a name="base"></a>
<h2>Search</h2>
<table class="colsn"><tr><td id="wg"><a _target="blank" href="[%wg fhir%]">[%wgt fhir%]</a> Work Group</td><td id="fmm"><a href="versions.html#maturity">Maturity Level</a>: Normative</td><td id="ballot"><a href="versions.html#std-process">Standards Status</a>:<!--!ns!--><a href="versions.html#std-process">Normative</a></td></tr></table>
[%normative page infrastructure%]

<p>
Searching for resources is fundamental to the mechanics of FHIR.
Search operations traverse through an existing set of resources filtering by
parameters supplied to the search operation. The text below describes
the FHIR search framework, starting with simple cases moving to the more complex.
Implementers need only implement the amount of
complexity that they require for their implementations.
</p>

<a name="Summary"></a>
<h3>Summary Table</h3>

<table class="grid">
<tr><td><b>Search Parameter Types</b></td><td><b>Parameters for all resources</b></td><td><b>Search result parameters</b></td></tr>
<tr>
<td>
<%codetoc http://hl7.org/fhir/search-param-type%>
</td>
<td>
<a href="#id"><code>_id</code></a><br/>
<a href="#lastUpdated"><code>_lastUpdated</code></a><br/>
<a href="#tag"><code>_tag</code></a><br/>
<a href="#profile"><code>_profile</code></a><br/>
<a href="#security"><code>_security</code></a><br/>
<a href="#text"><code>_text</code></a><br/>
<a href="#content"><code>_content</code></a><br/>
<a href="#list"><code>_list</code></a><br/>
<a href="#has"><code>_has</code></a><br/>
<a href="#_type"><code>_type</code></a><br/>
</td>
<td>
<a href="#sort"><code>_sort</code></a><br/>
<a href="#count"><code>_count</code></a><br/>
<a href="#include"><code>_include</code></a><br/>
<a href="#revinclude"><code>_revinclude</code></a><br/>
<a href="#summary"><code>_summary</code></a><br/>
<a href="#total"><code>_total</code></a><br/>
<a href="#elements"><code>_elements</code></a><br/>
<a href="#contained"><code>_contained</code></a><br/>
<a href="#containedType"><code>_containedType</code></a><br/>
</td>
</tr>
</table>
<p>
In addition, there is a special search parameters <a href="#query"><code>_query</code></a> and <a href="#filter"><code>_filter</code></a> that allow for an alternative method of searching,
and the parameters <code>_format</code> and <code>_pretty</code> <a href="http.html#parameters">defined for all interactions</a>.
</p>
<p>
Also, there is a single page that lists <a href="searchparameter-registry.html">all the search parameters</a>.
Note that search parameter names are case sensitive, though this specification never defines different
parameters with names that differ only in case. Clients SHOULD use correct case, and servers SHALL
not define additional parameters with different meanings with names that only differ in case.
</p>
<p>
There are <a href="safety.html#search">several safety issues</a> associated with the implementation of searching that implementers should always keep in mind.
</p>

<a name="Introduction"></a>
<h3>Introduction</h3>
<p>
In the simplest case, a search is executed by performing a <code>GET</code> operation
in the RESTful framework:
</p>
<pre>
 GET [base]/[type]?name=value&amp;...{&amp;_format=[mime-type]}}
</pre>
<p>
For this RESTful search (see <a href="http.html#search">definition in RESTful API</a>), the parameters are a series
of name=[value] pairs encoded in the URL or as an
application/x-www-form-urlencoded submission for a POST:
</p>
<pre>
 POST  [base]/[type]/_search{?[parameters]{&amp;_format=[mime-type]}}
</pre>
<p>
The server determines which of the set of resources it serves meet
the specific criteria, and returns the results in the HTTP response
as a <a href="bundle.html">bundle</a> which includes the resources
that are the results of the search. Note that the <code>_format</code>
parameter works for search <a href="http.html#mime-type">like for other interactions</a>.
</p>
<p>
<a href="http.html#search">Search operations</a> are executed in one of three defined contexts that control which set of resources are being searched:
</p>
<ul>
 <li>A specified resource type: <code>GET [base]/[type]?parameter(s)</code></li>
 <li>A specified <a href="compartmentdefinition.html">compartment</a>, perhaps with a specified resource type in that compartment: <code>GET [base]/Patient/[id]/[type]?parameter(s)</code></li>
 <li>All resource types: <code>GET [base]?parameter(s)</code> (parameters common to all types). If the _type parameter is included, all other
   search parameters SHALL be common to all provided types.  If _type is not included, all parameters SHALL be common to all resource types.</li>
</ul>
<p>
Search operations can also be implemented in <a href="messaging.html#search">the messaging framework</a>.
</p>
<p>
In the absence of any search filters, e.g. <code>GET [base]/Patient</code> or <code>POST [base]/Patient/_search</code> with empty body, server SHOULD return
all records. NOTE: Sever MAY impose expectations prohibiting queries without or with insufficient parameters.
</p>
<p>
Order of operations is not driven by order in the URL - with the exception of sort. First all filters are applied,
then the result set is sorted, then paging is applied, and includes/revincludes are returned for each page.
</p>
<p>
The server determines which of their resources meet the criteria
contained in the search parameters as described below. However,
the server has the prerogative to return additional search results
if it believes them to be relevant. Note: There is a
special search for the most relevant context in which the
search set is indeterminate: <a href="patient.html#match">Patient MPI Search</a>.
</p>
<p>
Search using <code>GET</code> may include sensitive information in the search parameters.  Therefore,
secure communications and endpoint management are recommended, see <a href="security.html#http">Security Communications</a>
</p>
<p>
The response to any search operation is always a list of resources in a Bundle.
An alternative approach is to <a href="graphql.html">use GraphQL</a>.
</p>

<a name="errors"></a>
<h3>Handling Errors</h3>
<p>
If a server is unable to execute a search request, it may return an error.
A HTTP status code of <code>403</code> signifies that the server refused to perform the search,
while other <code>4xx</code> and <code>5xx</code> codes signify that some sort of error has occurred. When
the search fails, a server SHOULD return an <a href="operationoutcome.html">OperationOutcome</a>
detailing the cause of the failure. Note: An empty search result is not a failure.
</p>
<p>
In some cases, parameters may cause an error, or might not be able to match anything. For instance:
</p>
<ul>
 <li>A parameter may refer to a non-existent resource e.g. <code>GET [base]/Observation?subject=101</code>, where "101" does not exist</li>
 <li>A parameter may refer to a non-existent resource e.g. <code>GET [base]/Observation?patient.identifier=http://example.com/fhir/identifier/mrn|123456</code>, where there is no patient for MRN 123456</li>
 <li>A parameter may refer to an unknown code e.g. <code>GET [base]/Observation?code=loinc|1234-1</code>, where the LOINC code "1234-1" is not known to the server</li>
 <li>A parameter may refer to a time that is out of scope e.g. <code>GET [base]/Condition?onset=le1995</code>, where the system only has data going back to 2001</li>
 <li>A parameter may use an illegal or unacceptable modifier e.g. <code>GET [base]/Condition?onset:text=1995</code>, where the modifier cannot be processed by the server</li>
 <li>A data time parameter may have incorrect format e.g. <code>GET [base]/Condition?onset=23%20May%202009</code></li>
 <li>A parameter may be unknown or unsupported (see below)</li>
</ul>
<p>
Note: Empty parameters are not an error - they are just ignored by the server.
</p>
<p>
Where the content of the parameter is syntactically incorrect, servers SHOULD return an error.
However, where the issue is a logical condition (e.g. unknown subject or code), the server
SHOULD process the search, including processing the parameter - with the result of returning
an empty search set, since the parameter cannot be satisfied.
</p>
<p>
In such cases, the search process MAY include an <a href="operationoutcome.html">OperationOutcome</a>
in the search set that contains additional hints and warnings about the search process.
This is included in the search results as an entry with <a href="bundle-definitions.html#Bundle.entry.search.mode">search mode</a> = <a href="valueset-search-entry-mode.html"><code>outcome</code></a>.
Clients can use this information to improve future searches. If, for example, a client
performed the following search:
</p>
<pre>
GET [base]/Observation?patient.identifier=http://example.com/fhir/identifier/mrn|123456
</pre>
<p>
and there is no patient for MRN 123456, the server would return <a href="bundle-search-warning.html">a bundle with a warning</a>.
</p>

<p><b>Unknown and unsupported parameters</b></p>

<p>
Servers may receive parameters from the client that they do not recognize, or may
receive parameters they recognize but do not support (either in general, or for
a specific search). In general, servers SHOULD ignore unknown or unsupported parameters
for the following reasons:
</p>
<ul>
 <li>Various HTTP stacks and proxies may add parameters that aren't under the control of the client</li>
 <li>The client can determine what parameters the server used by examining the self link in the return (see <a href="#conformance">below</a>)</li>
</ul>
<p>
Clients can specify how the server should behave, by using the prefer header
</p>
<ul>
 <li>Prefer: handling=strict: Client requests that the server return an error for any unknown or unsupported parameter</li>
 <li>Prefer: handling=lenient: Client requests that the server ignore any unknown or unsupported parameter</li>
</ul>
<p>
Servers SHOULD honor the client's request, but are not required to do so.
</p>

<a name="standard"></a>
<h3>Standard Parameters</h3>

<a name="all"></a>
<h4>Parameters for all resources</h4>
<p>
The following parameters apply <a href="resource.html#search">to all resources</a>: [%allparams%]. In addition, the search
parameter <a href="#text"><code>_text</code></a> and <a href="#filter"><code>_filter</code></a>, (documented below) also applies to all resources (as do the search result parameters).
</p>
<a name="id"></a>
<p>
The search parameter <code>_id</code> refers to the logical id of the resource, and can be used when the search context specifies a resource type:
</p>
<pre>
 GET [base]/Patient?_id=23
</pre>
<p>
This search finds the patient resource with the given id (there can only be one
resource for a given id). Functionally, this is equivalent to a <a href="http.html#read">simple
read operation</a>:
</p>
<pre>
 GET [base]/Patient/23
</pre>
<p>
However, the search with parameter <code>_id</code> returns a bundle with the requested resource, instead of just the
resource itself. Additional parameters can be added which may provide
additional functionality on top of this base read equivalence (e.g. <a href="#include"><code>_include</code></a>).
Note that although the _id parameter has a type of token, because servers SHALL use exact match with it, there is
no system for the _id parameter. Note that matches on <code>_id</code>
are always case sensitive.
</p>
<a name="lastUpdated"></a>
<p>
The search parameter <code>_lastUpdated</code> can be used to select resources based
on the last time they were changed:
</p>
<pre>
 GET [base]/Observation?_lastUpdated=gt2010-10-01
</pre>
<p>
This search finds any observations changed since 1-Oct 2010. When
this search parameter is used, applications should consider
synchronization approaches (<a href="http.html#history">RESTful history</a>
or the <a href="subscriptions.html">Subscription framework</a>).
</p>
<a name="tag"></a>
<a name="tags"></a>
<a name="profile"></a>
<a name="security"></a>

<p>
The search parameters <a href="resource.html#simple-tags">_tag</a>, <a href="resource.html#profile-tags">_profile</a> and <a href="resource.html#security-labels">_security</a> parameters search
on the equivalent elements in the <a href="resource.html#meta"><code>meta</code> element</a>.
For example,
</p>
<pre>
 GET [base]/Condition?_tag=http://acme.org/codes|needs-review
</pre>
<p>
searches for all Condition resources with the tag:
</p>
<pre class="json">
{
  "system" : "http://acme.org/codes",
  "code" : "needs-review"
}
</pre>
<p>
In the same manner:
</p>
<pre>
 GET [base]/DiagnosticReport?_profile=http://hl7.org/fhir/StructureDefinition/lipid
 GET [base]/DiagnosticReport?_profile=StructureDefinition/lipid
</pre>
<p>
restricts the search to only DiagnosticReport resources that are tagged as conforming to a particular profile.
The second reference is relative and refers a local profile on the same server.
</p>
<p>
<a href="resource.html#simple-tags">_tag</a>, and <a href="resource.html#security-labels">_security</a> parameters are token types (see <a href="#token">below</a>),
and <a href="resource.html#profile-tags">_profile</a> is a <a href="#uri">uri</a> search parameter.
</p>


<a name="parameters"></a>
<h4>Parameters for each resource</h4>
<p>
In addition to the <code>_id</code> parameter which exists for all resources, each
FHIR resource type defines its own set of search parameters with
their names, types, and meanings. These search parameters are on the
same page as the resource definitions, and are also published as part
of the standard Capability statement (<a href="capabilitystatement-base.xml.html">XML</a> or <a href="capabilitystatement-base.json.html">JSON</a>).
</p>
<p>
In general, the defined search parameters correspond to a
single element in the resource, but this is not required, and some
search parameters refer to the same type of element in multiple
places, or refer to derived values.
</p>
<p>
Some search parameters defined by resources are associated
with more than one path in a resource. This means that the search
parameter matches if any of the paths contain matching content.  If a
path matches, the whole resource is returned in the
search results. The client may have to examine the resource to determine
which path contains the match.
</p>
<p>
Servers are not required to implement any of the standard search parameters
(except for the <code>_id</code> parameter described above).  Servers may also define their own
 parameters.
</p>

<a name="ptypes"></a>
<h4>Search Parameter Types</h4>
<p>Each search parameter is defined by a type that specifies how the search parameter
behaves. These are the defined parameter types:
</p>
<%linkcodelist http://hl7.org/fhir/search-param-type%>
<p>
The search parameters can also append "modifiers" that control
their behavior. The kinds of modifiers that available is dependent on the type
of parameter being modified.
</p>

<a name="modifiers" > </a>
<h4>Modifiers</h4>
<p>Parameters are defined per resource.  Parameter names may specify a modifier as a suffix.
The modifiers are separated from the parameter name by a colon. Modifiers are:</p>
<ul>
 <li>For all parameters (except combination): <code>:missing</code>; e.g. gender:missing=true (or false).
  Searching for <code>gender:missing=true</code> will return all the resources that don't have a value for the gender parameter (which usually
  equates to not having the relevant element in the resource). Searching for <code>gender:missing=false</code>
  will return all the resources that have a value for the <code>gender</code> parameter.
  For simple data type elements, :missing=true will match on all elements where either the underlying element is omitted or where the element is present with extensions but no @value is specified
  </li>
 <li>For string: <code>:exact</code> returns results that match the entire supplied parameter, including casing and combining characters.
    Note that the handling of (extended) <a href="http://unicode.org/reports/tr29/#Grapheme_Cluster_Boundaries">grapheme clusters</a> is within
		the discretion of the server, i.e. the server decides if a string search parameter matches on canonically equivalent characters, or matches on
		the actual used Unicode code points, or <code>:contains</code> (case insensitive and combining character-insensitive, search text matched anywhere in the string), instead of the default behavior (case insensitive and accent-insensitive, partial matches at the start of the string).</li>
 <li>For token: <code>:text</code> (the match does a partial searches on the text portion of a CodeableConcept or the display portion of a Coding), instead of the default search which uses codes. Other defined modifiers are <code>:in</code>, <code>:below</code>, <code>:above</code> and <code>:not-in</code> which are described below.</li>
 <li>For reference: <code>:[type]</code> where [type] is the name of a type of resource, :identifier, and, for some parameters, :above and :below</li>
 <li>For uri: <code>:below</code>, <code>:above</code> indicate that instead of an exact match, either the search term left-matches the value, or vice-versa.</li>
</ul>
<p>
Server SHALL reject any search request that contains is suffixed by a modifier that the
server does <b>not</b> support for that parameter. For example, if the server supports
the <code>name</code> search parameter, but not the <code>:exact</code> modifier on the name, it should reject a
search with the parameter <code>name:exact=Bill</code>, using an HTTP <code>400</code> error with
an <a href="operationoutcome.html">OperationOutcome</a> with a <a href="operationoutcome-example-searchfail.html">clear error message</a>.

</p>

<a name="prefix"></a>
<h4>Prefixes</h4>
<p>
For the ordered parameter types of <a href="#number">number</a>, <a href="#date">date</a>, and <a href="#quantity">quantity</a>,
a prefix to the parameter value may be used to control the nature of the matching. To avoid URL escaping and visual confusion,
the following prefixes are used:
</p>
<table class="grid">
 <tr>
	<td><code>eq</code></td>
	<td>the value for the parameter in the resource is equal to the provided value</td>
	<td>the range of the search value fully contains the range of the target value</td>
 </tr>
 <tr>
	<td><code>ne</code></td>
	<td>the value for the parameter in the resource is not equal to the provided value</td>
  <td>the range of the search value does not fully contain the range of the target value</td>
 </tr>
 <tr>
	<td><code>gt</code></td>
	<td>the value for the parameter in the resource is greater than the provided value</td>
  <td>the range above the search value intersects (i.e. overlaps) with the range of the target value</td>
 </tr>
 <tr>
	<td><code>lt</code></td>
	<td>the value for the parameter in the resource is less than the provided value</td>
  <td>the range below the search value intersects (i.e. overlaps) with the range of the target value</td>
 </tr>
 <tr>
	<td><code>ge</code></td>
	<td>the value for the parameter in the resource is greater or equal to the provided value</td>
  <td>the range above the search value intersects (i.e. overlaps) with the range of the target value, or the range of the search value fully contains the range of the target value</td>
 </tr>
 <tr>
	<td><code>le</code></td>
	<td>the value for the parameter in the resource is less or equal to the provided value</td>
  <td>the range below the search value intersects (i.e. overlaps) with the range of the target value or the range of the search value fully contains the range of the target value</td>
 </tr>
 <tr>
	<td><code>sa</code></td>
	<td>the value for the parameter in the resource starts after the provided value</td>
  <td>the range of the search value does not overlap with the range of the target value, and the range above the search value contains the range of the target value</td>
 </tr>
 <tr>
	<td><code>eb</code></td>
	<td>the value for the parameter in the resource ends before the provided value</td>
  <td>the range of the search value does not overlap with the range of the target value, and the range below the search value contains the range of the target value</td>
 </tr>
 <tr>
	<td><code>ap</code></td>
	<td>the value for the parameter in the resource is approximately the same to the provided value.<br/>
	Note that the recommended value for the approximation is 10% of the stated value (or for a date, 10% of the gap between now and the date), but systems may choose other values where appropriate</td>
  <td>the range of the search value overlaps with the range of the target value</td>
 </tr>
</table>
<p>
If no prefix is present, the prefix <code>eq</code> is assumed. Note that the way search parameters operate
is not the same as the way the operations on two numbers work in a mathematical sense. <code>sa</code> (<code>starts-after</code>) and
<code>eb</code> (<code>ends-before</code>) are not used with integer values but are used for decimals.
</p>
<p>
For each prefix above, two interpretations are provided - the simple intent of the prefix and the
interpretation of the parameter when applied to ranges. The range interpretation is provided
for decimals and dates.  Searches are always performed on values that are implicitly
or explicitly a range. For instance, the number 2.0 has an implicit range of
1.95 to 2.05, and the date 2015-08-12 has an implicit range of all the time during that day.
If the target value is a <a href="datatypes.html#range">Range</a>, a <a href="datatypes.html#period">Period</a>,
or a <a href="datatypes.html#timing">Timing</a>, then the target is explicitly a range. Three ranges
are identified:
</p>
<table class="grid">
 <tr>
	<td>range of the value</td>
	<td>The limits implied by the precision of the value</td>
  <td>The number 2.0 has a range of 1.95 to 2.05<br/>
      The date 2015-08-12 has a range from 00:00 to 00:00 exclusive</td>
 </tr>
 <tr>
	<td>range below the value</td>
	<td>Up to the specified value</td>
  <td>The range below 2.0 includes any value less or equal to &lt;2.00000000000000000000<br/>
      The range before 2015-08-12T05:23:45 includes any time up to 2015-08-12T05:23:45.000000000000000</td>
 </tr>
 <tr>
	<td>range above the value</td>
	<td>The specified value and up</td>
  <td>The range above 2.0 includes any value greater or equal to &lt;2.00000000000000000000<br/>
      The range after 2015-08-12T05:23:45 includes any time after 2015-08-12T05:23:45.000000000000000</td>
 </tr>
</table>
<p>
The proper use of these ranges is discussed further below.
</p>

<a name="number"></a>
<h4>number</h4>
<p>
Searching on a simple numerical value in a resource. Examples:
</p>
<table class="grid">
 <tr><td><code>[parameter]=100</code></td><td>Values that equal 100, to 3 significant figures precision, so this is actually searching for values in the range [99.5 ... 100.5)</td></tr>
 <tr><td><code>[parameter]=100.00</code></td><td>Values that equal 100, to 5 significant figures precision, so this is actually searching for values in the range [99.995 ... 100.005)</td></tr>
 <tr><td><code>[parameter]=1e2</code></td><td>Values that equal 100, to 1 significant figures precision, so this is actually searching for values in the range [95 ... 105)</td></tr>
 <tr><td><code>[parameter]=lt100</code></td><td>Values that are less than exactly 100</td></tr>
 <tr><td><code>[parameter]=le100</code></td><td>Values that are less or equal to exactly 100</td></tr>
 <tr><td><code>[parameter]=gt100</code></td><td>Values that are greater than exactly 100</td></tr>
 <tr><td><code>[parameter]=ge100</code></td><td>Values that are greater or equal to exactly 100</td></tr>
 <tr><td><code>[parameter]=ne100</code></td><td>Values that are not equal to 100 (actually, in the range 99.5 to 100.5)</td></tr>
</table>
<p>
Notes about searching on Numbers:
</p>
<ul>
 <li>When a number search is used against a resource element that stores a simple integer (e.g.
 <a href="immunizationrecommendation-definitions.html#ImmunizationRecommendation.recommendation.doseNumber_x_">ImmunizationRecommendation.recommendation.doseNumber</a>), and the search parameter
    is not expressed using the exponential forms, and does not include any non-zero digits after a decimal point,
    the significance issues cancel out and searching is based on exact matches.  Note that if there are non-zero digits after a decimal point,
    there cannot be any matches</li>
 <li>When a comparison prefix in the set <code>gt, lt, ge, le, sa &amp; eb</code> is provided, the
     implicit precision of the number is ignored, and they are treated as if they have arbitrarily high precision</li>
 <li>The way search parameters operate in resources is not the same as whether two numbers are equal to each other in a mathematical sense</li>
 <li>Searching on decimals involves an implicit range.  The number of significant digits of the implicit range is the number of digits specified in
     the search parameter value, excluding leading zeros. So 100 and 1.00e2 both have the same number of significant digits - three</li>
</ul>

<p>
Here are some example searches:
</p>
<table>
 <tr><td width="50%"><b>Search</b></td><td><b>Description</b></td></tr>
 <tr><td><pre> GET [base]/RiskAssessment?probability=gt0.8</pre></td><td>Search for all the Risk Assessments with probability great than 0.8 (could also be <code>probability=gt8e-1</code> using exponential form)</td></tr>
 <tr><td><pre> GET [base]/ImmunizationRecommendation?dose-number=2</pre></td><td>Search for any immunization recommendation recommending a second dose</td></tr>
</table>


<a name="date"></a>
<h4>date</h4>
<p>
A date parameter searches on a date/time or period. As is usual for date/time related functionality, while the
concepts are relatively straight-forward, there are a number of subtleties involved in ensuring consistent behavior.
</p>
<p>
The date parameter format is <code>yyyy-mm-ddThh:mm:ss[Z|(+|-)hh:mm]</code> (the standard XML format).
</p>
<p>
Technically, this is any of the <a href="datatypes.html#date">date</a>, <a href="datatypes.html#dateTime">dateTime</a>,
and <a href="datatypes.html#instant">instant</a> data types; e.g. Any degree of precision can be provided, but it SHALL
be populated from the left (e.g. can't specify a month without a year), except that the minutes SHALL be present if
an hour is present, and you SHOULD provide a time zone if the time part is present. Note: Time can consist of hours and minutes with no seconds, unlike the XML Schema dateTime type. Some user agents may escape the <code>:</code>
characters in the URL, and servers SHALL handle this correctly.
</p>
<p>
Date parameters may be used with the following data types:
</p>
<table class="grid">
 <tr><td><a href="datatypes.html#date">date</a></td><td>The range of the value is the day, month, or year as specified</td></tr>
 <tr><td><a href="datatypes.html#dateTime">dateTime</a></td><td>The range of the value as defined above; e.g. For example, the
   date 2013-01-10 specifies all the time from 00:00 on 10-Jan 2013 to immediately before 00:00 on 11-Jan 2013</td></tr>
 <tr><td><a href="datatypes.html#instant">instant</a></td><td>An instant is considered a fixed point in time with an interval smaller than the precision of the system, i.e. an interval with an effective width of 0</td></tr>
 <tr><td><a href="datatypes.html#Period">Period</a></td><td>Explicit, though the upper or lower bound might not actually be specified in resources.</td></tr>
 <tr><td><a href="datatypes.html#Timing">Timing</a></td><td>the specified scheduling details are ignored and only the outer limits matter. For instance, a schedule that specifies every second day between
   31-Jan 2013 and 24-Mar 2013 includes 1-Feb 2013, even though that is on an odd day that is not specified by the period. This is
   to keep the server load processing queries reasonable.</td></tr>
</table>
<p>
Implicitly, a missing lower boundary is "less than" any actual date.  A missing upper boundary is "greater than" any actual date.
Date searches can be controlled through the use of prefixes as described in the following table:
</p>
<table class="grid">
 <tr>
   <td><code>[parameter]=eq2013-01-14</code></td>
   <td>
    <ul>
     <li style="list-style-image: url('assets/images/tick2.gif')">2013-01-14T00:00 matches (obviously)</li>
     <li style="list-style-image: url('assets/images/tick2.gif')">2013-01-14T10:00 matches</li>
     <li style="list-style-image: url('assets/images/cross.png')">2013-01-15T00:00 does not match - it's not in the range</li>
    </ul>
   </td>
 </tr>
 <tr>
   <td><code>[parameter]=ne2013-01-14</code></td>
   <td>
    <ul>
     <li style="list-style-image: url('assets/images/tick2.gif')">2013-01-15T00:00 matches - it's not in the range</li>
     <li style="list-style-image: url('assets/images/cross.png')">2013-01-14T00:00 does not match - it's in the range</li>
     <li style="list-style-image: url('assets/images/cross.png')">2013-01-14T10:00 does not match - it's in the range</li>
    </ul>
   </td>
 </tr>
 <tr>
   <td><code>[parameter]=lt2013-01-14T10:00</code></td>
   <td>
    <ul>
     <li style="list-style-image: url('assets/images/tick2.gif')">2013-01-14 matches, because it includes the part of 14-Jan 2013 before 10am</li>
    </ul>
   </td>
 </tr>
 <tr>
   <td><code>[parameter]=gt2013-01-14T10:00</code></td>
   <td>
    <ul>
     <li style="list-style-image: url('assets/images/tick2.gif')">2013-01-14 matches, because it includes the part of 14-Jan 2013 after 10am</li>
    </ul>
   </td>
 </tr>
 <tr>
   <td><code>[parameter]=ge2013-03-14</code></td>
   <td>
    <ul>
     <li style="list-style-image: url('assets/images/tick2.gif')">"from 21-Jan 2013 onwards" is included because that period may include times after 14-Mar 2013</li>
    </ul>
   </td>
 </tr>
 <tr>
   <td><code>[parameter]=le2013-03-14</code></td>
   <td>
    <ul>
     <li style="list-style-image: url('assets/images/tick2.gif')">"from 21-Jan 2013 onwards" is included because that period may include times before 14-Mar 2013</li>
    </ul>
   </td>
  </tr>
 <tr>
   <td><code>[parameter]=sa2013-03-14</code></td>
   <td>
    <ul>
     <li style="list-style-image: url('assets/images/tick2.gif')">"from 15-Mar 2013 onwards" is included because that period starts after 14-Mar 2013</li>
     <li style="list-style-image: url('assets/images/cross.png')">"from 21-Jan 2013 onwards" is not included because that period starts before 14-Mar 2013</li>
     <li style="list-style-image: url('assets/images/cross.png')">"before and including 21-Jan 2013" is not included because that period starts (and ends) before 14-Mar 2013</li>
    </ul>
   </td>
  </tr>
 <tr>
   <td><code>[parameter]=eb2013-03-14</code></td>
   <td>
    <ul>
     <li style="list-style-image: url('assets/images/cross.png')">"from 15-Mar 2013 onwards" is not included because that period starts after 14-Mar 2013</li>
     <li style="list-style-image: url('assets/images/cross.png')">"from 21-Jan 2013 onwards" is not included because that period starts before 14-Mar 2013, but does not end before it</li>
     <li style="list-style-image: url('assets/images/tick2.gif')">"before and including 21-Jan 2013" is included because that period ends before 14-Mar 2013</li>
    </ul>
   </td>
  </tr>
 <tr>
   <td><code>[parameter]=ap2013-03-14</code></td>
   <td>
    <ul>
     <li style="list-style-image: url('assets/images/tick.gif')">14-Mar 2013 is included - as it exactly matches</li>
     <li style="list-style-image: url('assets/images/cross.png')">21-Jan 2013 is not included because that is near 14-Mar 2013</li>
     <li style="list-style-image: url('assets/images/cross.png')">15-Jun 2015 is not included - as it is not near 14-Mar 2013. Note that the exact value here is at the discretion of the system</li>
    </ul>
   </td>
  </tr>
</table>
<p>
Other notes:
</p>
<ul>
 <li>When the date parameter is not fully specified, matches against it are based on the behavior of intervals, where:
	<ul>
		<li>Dates with only the year specified are equivalent to an interval that starts at the first instant of January 1st to the last instant of December 31st, e.g. 2000 is equivalent to an interval of [2000-01-01T00:00, 2000-12-31T23:59].</li>
		<li>Dates with the year and month are equivalent to an interval that starts at the first instant of the first day of the month and ends on the last instant of the last day of the month, e.g. 2000-04 is equivalent to an interval of [2000-04-01T00:00, 2000-04-30T23:59].</li>
	</ul>
 </li>
 <li>Where possible, the system should correct for time zones when performing queries. Dates do not have time zones, and time zones
   should not be considered. Where both search parameters and resource element date times do not have time zones, the servers local
   time zone should be assumed.
 </li>
</ul>
<p>
To search for all the procedures in a patient compartment that occurred over a 2-year period:
</p>
<pre>
 GET [base]/Patient/23/Procedure?date=ge2010-01-01&amp;date=le2011-12-31
</pre>
[%dragons-start%]
<p>
Managing time zones and offsets and their impact on search is a very difficult area. The FHIR
implementation community is still investigating and debating the best way to handle time zones.
Implementation guides may make additional rules in this regard.
</p>
<p>
Future versions of this specification may impose rules around the use of time zones with dates.
Implementers and authors of implementation guides should be aware of ongoing work in this area.
</p>
<p>
Implementer feedback is welcome <a href="http://hl7.org/fhir-issues">on the issue tracker</a> or <a href="https://chat.fhir.org/#narrow/stream/4-implementers">chat.fhir.org</a>.
</p>
[%dragons-end%]

<a name="string"></a>
<h4>string</h4>
<p>
For a simple string search, a string parameter serves as the input for a search against
sequences of characters. This search is insensitive to casing and included combining characters, like accents or other diacritical marks.
Punctuation and non-significant whitespace (e.g. repeated space characters, tab vs space) should also be ignored.
By default, a field matches a string query if the value of the field equals or starts with the supplied parameter value, after both have
been normalized by case and combining characters. Therefore, the default string search only operates on the base characters of the string parameter.
The <code>:contains</code> modifier returns results that include the supplied parameter value anywhere within the field
being searched. The <code>:exact</code> modifier returns results that match
the entire supplied parameter, including casing and accents.
</p>
<p>
Examples:
</p>
<table class="grid">
 <tr><td><code>[base]/Patient?given=eve</code></td><td>Any patients with a name containing a given part with "eve" at the start of the name. This would include patients with the given name "Eve", "Evelyn".</td></tr>
 <tr><td><code>[base]/Patient?given:contains=eve</code></td><td>Any patients with a name with a given part containing "eve" at any position. This would include patients with the given name "Eve", "Evelyn", and also "Severine".</td></tr>
 <tr><td><code>[base]/Patient?given:exact=Eve</code></td><td>Any patients with a name with a given part that is exactly "Eve". Note: This would not include patients with the given name "eve" or "EVE".</td></tr>
</table>
<p>
An additional modifier <code>:text</code>
can be used to specify a search with advanced text handling (see <a href="#text">below</a>)
though only a few servers are expected to offer this facility.
</p>
<p>
When a string search parameter refers to the types <a href="datatypes.html#HumanName">HumanName</a> and <a href="datatypes.html#Address">Address</a>,
the search covers the elements of type string, and does not cover elements such as <code>use</code> and <code>period</code>.
For robust search, servers should search the parts of a family name independently.
E.g. searching either "Carreno" or "Quinones" should match a family name of "Carreno Quinones".
HL7 affiliates may make more specific recommendations about how search should work
in their specific culture.
</p>
<p>
It is at the discretion of the server whether to pre-process names, addresses,
and contact details to remove separator characters prior to matching in order
to ensure more consistent behavior. For example, a server might remove all
spaces and <code>-</code> characters from phone numbers. What is most appropriate varies
depending on culture and context.
A server may also use a free-text style searches on this property to achieve the best results.<br/>
When searching whole names and addresses (not parts), servers may also use flexible match
or a free-text style searches on names to achieve the best results.
</p>

<!--
A server defined search (link to search page) that may consider matching any of the string fields in the HumanName, including family, give, prefix, suffix, suffix, and/or text
 -->
<a name="uri"></a>
<h4>uri</h4>
<p>
The uri parameter refers to an element that contains a URI (<a href="https://tools.ietf.org/html/rfc3986">RFC 3986</a>).
By default, matches are precise (e.g. case, accent, and escape) sensitive, and the entire URI must match.
The modifier <code>:above</code> or <code>:below</code> can be used to indicate
that partial matching is used. For example:
</p>
<pre>
 GET [base]/ValueSet?url=http://acme.org/fhir/ValueSet/123
 GET [base]/ValueSet?url:below=http://acme.org/fhir/
 GET [base]/ValueSet?url:above=http://acme.org/fhir/ValueSet/123/_history/5
 GET [base]/ValueSet?url=urn:oid:1.2.3.4.5
</pre>
<ul>
 <li>The first line is a request to find any value set with the exact url "http://acme.org/fhir/ValueSet/123"</li>
 <li>The second line performs a search that will return any value sets that have a URL that starts with "http://acme.org/fhir/"</li>
 <li>The third line shows the converse - search for any value set above a given specific URL. This will match on any value set with the specified URL, but also on http://acme.org/ValueSet/123.
    Note that there are not many use cases where :above is useful as compared to the <code>:below</code> search</li>
 <li>The fourth line shows an example of searching by an OID. Note that the :above and :below modifiers only apply to URLs, and not URNS such as OIDs</li>
</ul>
<p>
The search type <code>uri</code> is used with elements of type <a href="datatypes.html#uri">uri</a> and <a href="datatypes.html#url">url</a>.
The type <a href="#reference">reference</a> is used for the types <a href="references.html#Reference">Reference</a> and
<a href="datatypes.html#canonical">canonical</a>. Note that for <code>uri</code> parameters that refer to
the <a href="references.html#canonical">Canonical URLs</a> of the conformance and knowledge resources (e.g.
<a href="structuredefinition.html">StructureDefinition</a>, <a href="valueset.html">ValueSet</a>,
<a href="plandefinition.html">PlanDefinition</a> etc), servers SHOULD support searching by
canonical references, and SHOULD support automatically detecting a <code>|[version]</code> portion as part of the
search parameter, and interpreting that portion as a search on the version.
</p>

<a name="token"></a>
<h4>token</h4>
<p>
A token type is a parameter that provides a close to exact match search on a string of characters, potentially
scoped by a URI. It is mostly used against a code or identifier data type where the value may have a
URI that scopes its meaning, where the search is performed against the  pair from a Coding or an
Identifier. Tokens are also used against other fields where exact matches are required - uris,
booleans, and <a href="datatypes.html#ContactPoint">ContactPoints</a>. In these cases, the URI portion is not used.
</p>
<p>
For tokens, matches are literal (e.g. not based on <a href="codesystem.html#subsumption">subsumption</a> or other code system features).
Match is case sensitive unless the underlying semantics for the context indicate that the token should be interpreted case-insensitively
(see, e.g. <a href="codesystem-definitions.html#CodeSystem.caseSensitive">CodeSystem.caseSensitive</a>). Note that matches on <code>_id</code>
are always case sensitive. If the underlying data type is <code><a href="datatypes.html#string">string</a></code>
then the search is not case sensitive.
</p>
<p>
<b>Note</b>: There are many challenging issues around case sensitivity and token searches. Some
code systems are case sensitive (e.g. UCUM) while others are known not to be. For many code
systems, it's ambiguous. Other kinds of values are also ambiguous. When in doubt, servers
SHOULD treat tokens in a case-insensitive manner, on the grounds that including undesired
data has less safety implications than excluding desired behavior. Clients SHOULD always
use the correct case when possible, and allow for the server to perform case-insensitive
matching.
</p>
<p>
To use subsumption-based logic, use the modifiers below, or list
all the codes in the hierarchy. The syntax for the value is one of the following:
</p>
<ul>
 <li><b><code>[parameter]=[code]</code></b>: the value of <code>[code]</code> matches a Coding.code or Identifier.value irrespective of the value of the system property</li>
 <li><b><code>[parameter]=[system]|[code]</code></b>: the value of <code>[code]</code> matches a Coding.code or Identifier.value, and the value of <code>[system]</code> matches the system property of the Identifier or Coding</li>
 <li><b><code>[parameter]=|[code]</code></b>: the value of <code>[code]</code> matches a Coding.code or Identifier.value, and the Coding/Identifier has no system property</li>
 <li><b><code>[parameter]=[system]|</code></b>: any element where the value of <code>[system]</code> matches the system property of the Identifier or Coding</li>
</ul>
<p>
Notes:
</p>
<ul>
 <li>The namespace URI and code both must be <a href="#escaping">escaped</a> correctly.
If a system is not applicable (e.g. an element of type <a href="datatypes.html#uri">uri</a>,
then just the form [parameter]=[code] is used.</li>
 <li>For token parameters on elements of type <a href="datatypes.html#ContactPoint">ContactPoint</a>, <a href="datatypes.html#uri">uri</a>,
 or <a href="datatypes.html#boolean">boolean</a>, the presence of the pipe symbol SHALL NOT be used - only the <code>[parameter]=[code]</code> form is allowed</li>
 <li></li>
</ul>
<p>
Token search parameters are used for the following data types:
</p>
<table class="lines">
 <tr>
  <td><b>Data Type</b></td>
  <td><b>URI</b></td>
  <td><b>Code</b></td>
  <td><b>Comments</b></td>
 </tr>
 <tr>
  <td><a href="datatypes.html#Coding">Coding</a></td>
  <td>Coding.system</td>
  <td>Coding.code</td>
  <td></td>
 </tr>
 <tr>
  <td><a href="datatypes.html#CodeableConcept">CodeableConcept</a></td>
  <td>CodeableConcept.coding.system</td>
  <td>CodeableConcept.coding.code</td>
  <td>Matches against any coding in the CodeableConcept</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#Identifier">Identifier</a></td>
  <td>Identifier.system</td>
  <td>Identifier.value</td>
  <td>Clients can search by <code>type</code> not <code>system</code> using the :of-type modifier, see below. To search on a CDA <code>II.root</code> - which
	    may appear in either <code>Identifier.system</code> or <code>Identifier.value</code>, use the syntax <code>identifier=|[root],[root]</code></td>
 </tr>
 <tr>
  <td><a href="datatypes.html#ContactPoint">ContactPoint</a></td>
  <td></td>
  <td>ContactPoint.value</td>
  <td>At the discretion of the server, token searches on ContactPoint may use special handling, such as ignoring punctuation, performing partial searches etc.</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#code">code</a></td>
  <td>(implicit)</td>
  <td>code</td>
  <td>the system is defined in the value set (though it's not usually needed)</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#boolean">boolean</a></td>
  <td></td>
  <td>boolean</td>
  <td>The implicit system for boolean values is <a href="valueset-special-values.html">http://hl7.org/fhir/special-values</a> but this is never actually used</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#id">id</a></td>
  <td></td>
  <td>id</td>
  <td></td>
 </tr>
 <tr>
  <td><a href="datatypes.html#uri">uri</a></td>
  <td></td>
  <td>uri</td>
  <td></td>
 </tr>
 <tr>
  <td><a href="datatypes.html#string">string</a></td>
  <td>n/a</td>
  <td>string</td>
  <td>Token is sometimes used for string to indicate that exact matching is the correct default search strategy</td>
 </tr>
</table>
<p>
Note: The use of token search parameters for boolean fields: the boolean values "true" and "false" are also represented
as formal codes in the <a href="valueset-special-values.html">Special Values</a> code system, which is useful when boolean values
need to be represented in a <a href="datatypes.html#coding">Coding</a> data type. The namespace for these codes is
http://hl7.org/fhir/special-values, though there is usually no reason to use this, as a simple true or false is sufficient.
</p>

<p><b>Modifiers:</b></p>
<table class="lines">
 <tr> <td><b>Modifier</b></td> <td><b>Use</b></td> </tr>
 <tr> <td><code>:text</code></td> <td>The search parameter is processed as a string that searches text associated with the code/value - either <i>CodeableConcept.text</i>, <i>Coding.display</i>, or <i>Identifier.type.text</i>. In this case, the search functions as a <a href="#string">normal string search</a></td> </tr>
 <tr> <td><code>:not</code></td> <td>Reverse the code matching described in the paragraph above: return all resources that do not have a matching item. Note that this includes resources that have no value for the parameter - e.g. ?gender:not=male includes all patients that do not have gender = male, including patients that do not have a gender at all</td> </tr>
 <tr> <td><code>:above</code><a name="subsumption"></a></td> <td>The search parameter is a concept with the form <code>[system]|[code]</code>, and the search parameter tests whether the coding in a resource <a href="codesystem.html#subsumption">subsumes</a> the specified search code.  For example, the search concept has an is-a relationship with the coding in the resource, and this includes the coding itself.</td> </tr>
 <tr> <td><code>:below</code></td> <td>the search parameter is a concept with the form <code>[system]|[code]</code>, and the search parameter tests whether the coding in a resource is subsumed by the specified search code. For example, the coding in the resource has an is-a relationship with the search concept, and this includes the coding itself.</td> </tr>
 <tr> <td><code>:in</code></td> <td>The search parameter is a URI (relative or absolute) that identifies a value set, and the search parameter tests whether the coding is in the specified <a href="valueset.html">value set</a>. The reference may be literal (to an address where the value set can be found) or logical (a reference to ValueSet.url). If the server can treat the reference as a literal URL, it does, else it tries to match known logical ValueSet.url values.</td> </tr>
 <tr> <td><code>:not-in</code></td> <td>The search parameter is a URI (relative or absolute) that identifies a value set, and the search parameter tests whether the coding is not in the specified value set.</td> </tr>
 <tr> <td><code>:of-type</code></td> <td>The search parameter has the format system|code|value, where the system and code refer to a <code>Identifier.type.coding.system</code> and <code>.code</code>, and match
    if any of the type codes match. All 3 parts must be present</td> </tr>
</table>
<p>
Most servers will only process value sets that are already known/registered/supported internally.
However, servers can elect to accept any valid reference to a value set.
Servers may elect to consider concept mappings when testing for subsumption relationships.
</p>

<p>
Example searches:
</p>
<table>
 <tr><td width="50%"><b>Search</b></td><td><b>Description</b></td></tr>
 <tr><td><pre> GET [base]/Patient?identifier=http://acme.org/patient|2345</pre></td><td>Search for all the patients with an identifier with key = "2345" in the system "http://acme.org/patient"</td></tr>
 <tr><td><pre> GET [base]/Patient?gender=male</pre></td><td>Search for any patient with a gender that has the code "male"</td></tr>
 <tr><td><pre> GET [base]/Patient?gender:not=male</pre></td><td>Search for any patient with a gender that does not have the code "male", including those that do not have a code for gender at all.</td></tr>
 <tr><td><pre> GET [base]/Composition?section=48765-2</pre></td><td>Search for any Composition that contains an Allergies and adverse reaction section</td></tr>
 <tr><td><pre> GET [base]/Composition?section:not=48765-2</pre></td><td>Search for any Composition that does not contain an Allergies and adverse reaction section. Note that this search does not return "any document that has a section
    that is not an Allergies and adverse reaction section" (e.g. in the presence of multiple possible matches, the <i>negation</i> applies to the set, not each individual entry)</td></tr>
 <tr><td><pre> GET [base]/Patient?active=true</pre></td><td>Search for any patients that are active</td></tr>
 <tr><td><pre> GET [base]/Condition?code=http://acme.org/conditions/codes|ha125</pre></td><td>Search for any condition with a code "ha125" in the code system "http://acme.org/conditions/codes"</td></tr>
 <tr><td><pre> GET [base]/Condition?code=ha125</pre></td><td>Search for any condition with a code "ha125". Note that there is not often any useful overlap in literal symbols between code systems, so the previous example is generally preferred </td></tr>
 <tr><td><pre> GET [base]/Condition?code:text=headache</pre></td><td>Search for any Condition with a code that has a text "headache" associated with it (either in the text, or a display)</td></tr>
 <tr><td><pre> GET [base]/Condition?code:in=http%3A%2F%2Fsnomed.info%2Fsct%3Ffhir_vs%3Disa%2F126851005</pre></td><td>Search for any condition in the SNOMED CT value set "http://snomed.info/sct?fhir_vs=isa/126851005" that includes all descendants of "Neoplasm of liver"</td></tr>
 <tr><td><pre> GET [base]/Condition?code:below=126851005</pre></td><td>Search for any condition that is subsumed by the SNOMED CT Code "Neoplasm of liver". Note: This is the same outcome as the previous search</td></tr>
 <tr><td><pre> GET [base]/Condition?code:in=http://acme.org/fhir/ValueSet/cardiac-conditions</pre></td><td>Search for any condition that is in the institutions list of cardiac conditions</td></tr>
 <tr><td><pre> GET [base]/Patient?identifier:otype=http://terminology.hl7.org/CodeSystem/v2-0203|MR|446053</pre></td><td>Search for the Medical Record Number 446053 - this is useful where the system id for the MRN is not known</td></tr>
</table>

<a name="mimetype"></a>
<h5>Searching Mime Types</h5>
<p>
The <code>:below</code> modifier is also very useful with searching mime types, such as for <a href="documentreference.html">DocumentReference.contenttype</a>
which refers to <a href="datatypes.html#Attachment">Attachment.contentType</a>. A simple search such as:
</p>
<pre>
GET [base]/DocumentReference?contenttype=text/xml
</pre>
<p>
will miss documents with a mime type such as <code>text/xml; charset=UTF-8</code>. This
search will find all text/xml documents:
</p>
<pre>
GET [base]/DocumentReference?contenttype:below=text/xml
</pre>
<p>
For ease of processing on the server, servers are only required to support <code>:below</code> on the
base part of the mime type; servers are not required to sort between different parameters and do
formal subsumption logic.
</p>

<a name="quantity"></a>
<h4>quantity</h4>
<p>
A quantity parameter searches on the <a href="datatypes.html#Quantity">Quantity</a> data type.
The syntax for the value follows the form:
</p>
<ul>
 <li><b>[parameter]=[prefix][number]|[system]|[code]</b> matches a quantity with the given unit</li>
</ul>
<p>
The prefix is optional, and is as described <a href="#prefix">above</a>, both regarding how
precision and comparator/range operators are interpreted. Like a number parameter, the
number part of the search value can be a decimal in exponential format. The <code>system</code> and <code>code</code>
follow the same pattern as <a href="#token">token parameters</a> are also optional. Example searches:
</p>

<table>
 <tr><td width="50%"><b>Search</b></td><td><b>Description</b></td></tr>
 <tr><td><pre> GET [base]/Observation?value-quantity=5.4|http://unitsofmeasure.org|mg</pre></td><td>Search for all the observations with a value of 5.4(+/-0.05) mg where mg is understood as a UCUM unit (<code>system</code>/<code>code</code>)</td></tr>
 <tr><td><pre> GET [base]/Observation?value-quantity=5.40e-3|http://unitsofmeasure.org|g</pre></td><td>Search for all the observations with a value of 0.0054(+/-0.000005) g where g is understood as a UCUM unit (<code>system</code>/<code>code</code>)</td></tr>
 <tr><td><pre> GET [base]/Observation?value-quantity=5.4||mg</pre></td><td>Search for all the observations with a value of 5.4(+/-0.05) mg where the unit - either the code (<code>code</code>) or the stated human unit (<code>unit</code>) are "mg"</td></tr>
 <tr><td><pre> GET [base]/Observation?value-quantity=5.4</pre></td><td>Search for all the observations with a value of 5.4(+/-0.05) irrespective of the unit</td></tr>
 <tr><td><pre> GET [base]/Observation?value-quantity=le5.4|http://unitsofmeasure.org|mg</pre></td><td>Search for all the observations where the value of is less than 5.4 mg exactly where mg is understood as a UCUM unit</td></tr>
 <tr><td><pre> GET [base]/Observation?value-quantity=ap5.4|http://unitsofmeasure.org|mg</pre></td><td>Search for all the observations where the value of is about 5.4 mg where mg is understood as a UCUM unit (typically, within 10% of the value - see above)</td></tr>
</table>
<p>
Specifying a system and a code for the search implies that the search is based on a particular code system - usually <a href="http://unitsofmeasure.org">UCUM</a>, and
that a precise (and potentially canonical) match is desired. In this case, it is inappropriate to search on the human display for the unit, which can be
is uncontrolled and may unpredictable.
</p>

<p>
The search processor may choose to perform a search based on <a href="datatypes.html#quantity">canonical units</a>
(e.g. any value where the units can be converted to a value in mg in the case above). For example, an observation
may have a value of <code>23 mm/hr</code>. This is equal to <code>0.23 m/hr</code>. The search processer can
choose to normalise all the values to a canonical unit such as <code>6.4e-6 m/sec</code>, and convert
search terms to the same units (m/sec). Such conversions can be performed based on the semantics defined
in <a href="http://unitsofmeasure.org">UCUM</a>
</p>

<a name="reference"></a>
<h4>reference</h4>
<p>
A reference parameter refers to <a href="references.html">references between resources</a>.  For example, find all
Conditions where the subject reference is a particular patient, where the patient is selected by name or identifier.
The interpretation of a <i>reference</i> parameter is either:
</p>
<ul>
 <li><b><code>[parameter]=[id]</code></b> the logical [id] of a resource using a local reference (i.e. a relative reference)</li>
 <li><b><code>[parameter]=[type]/[id]</code></b> the logical [id] of a resource of a specified type using a local reference (i.e. a relative reference),
   for when the reference can point to different types of resources (e.g. <a href="observation-definitions.html#Observation.subject">Observation.subject</a>)</li>
 <li><b><code>[parameter]=[url]</code></b> where the [url] is an absolute URL - a reference to a resource by its absolute location, or by its canonical URL</li>
</ul>
<p>
Note: A relative reference resolving to the same value as a specified absolute URL, or vice versa, qualifies as a match.
For example, if the search parameter value is Patient/123, then this will find references like this:
</p>
<pre>
 &lt;patient&gt;
   &lt;reference value=&quot;Patient/123&quot;/&gt;
 &lt;/patient&gt;
</pre>
<p>
If the server base address is http://example.org/fhir, then the full URL for that reference is
http://example.org/fhir/Patient/123, which means that the search term also matches patient
references like this:
</p>
<pre>
 &lt;patient&gt;
   &lt;reference value=&quot;http://example.org/fhir/Patient/123&quot;/&gt;
 &lt;/patient&gt;
</pre>
<p>
In addition, searching for <code>reference=http://example.org/fhir/Patient/123</code> will also
match both references.
</p>
<p>
Some references may point to more than one type of resource; e.g. subject: Reference(Patient|Group|Device|..).
In these cases, multiple resources may have the same logical identifier. Servers SHOULD reject a search where
the logical id refers to more than one matching resource across different types.
In order to allow the client to perform a search in these situations the type is specified explicitly:
</p>
<pre>
 GET [base]/Observation?subject=Patient/23
</pre>
<p>
This searches for any observations where the subject refers to the patient resource with the
logical identifier "23". A modifier is also defined to allow the client to be explicit
about the intended type:
</p>
<pre>
 GET [base]/Observation?subject:Patient=23
</pre>
<p>
This has the same effect as the previous search. The modifier becomes useful when used with chaining
as explained in the next section. Note: The <code>[type]</code> modifier can't be used with a reference to a resource found on another server,
since the server would not usually know what type that resource has.  However, since these are absolute references,
there can be no ambiguity about the type.
</p>
<p>
In some cases, search parameters are defined with an implicitly limited scope. For example,
<a href="observation.html"><code>Observation</code></a> has an element <code>subject</code>, which is
a reference to one of a number of types. This has a matching search parameter <code>subject</code>,
which refers to any of the possible types. In addition to this, there is another search parameter
<code>patient</code>, which also refers to <code>Observation.subject</code>, but is limited to
only include references of type <a href="patient.html"><code>Patient</code></a>. When using
the patient search parameter, there is no need to specify ":Patient" as a modifier, or "Patient/"
in the search value, as this must always be true.
</p>
<p>
References are also allowed to have an <code>identifier</code>. The modifier :identifier
allows for searching by the identifier rather than the literal reference:
</p>
<pre>
 GET [base]/Observation?subject:identifier=http://acme.org/fhir/identifier/mrn|123456
</pre>
<p>
This is a search for all observations that reference a patient by a particular patient MRN.
When the :identifier modifier is used, the search value works as a <a href="#token">token search</a>.
The :identifier modifier is not supported on canonical elements since they do not have an identifier
separate from the reference itself.
</p>
<p>
Chaining is not supported when using the :identifier modifier, nor are chaining, includes
or reverse includes supported for reference elements that do not have a <code>reference</code>
element.
</p>
<p>
The reference search parameter is mostly used for resource elements of type <code>Reference</code> or <code>canonical</code>.
However, it is also be used to search resource elements of type Resource - i.e. where
one resource is directly nested within another - see the <a href="bundle.html#search">Bundle
search parameters</a> 'message' and 'composition' as an example of this.
</p>

<a name="versions"></a>
<h4>References and Versions</h4>

<p>
Elements of type <a href="references.html#Reference">Reference</a> may contain a <a href="references.html#versions">versioned</a> reference:
</p>
<div class="xml">
<pre>
  &nbsp;&lt;evidence&gt;
   &nbsp;&nbsp;&nbsp;&lt;reference value=&quot;Observation/123/_history/234234&quot;/&gt;
 &nbsp;&lt;/evidence&gt;
</pre>
</div>
<p>
When searching on versioned references, the following rules apply:
</p>
<ul>
 <li>If a resource has a reference that is versioned, and chaining is performed, the criteria should ideally be evaluated against the version referenced, but most systems will not be capable of this because search is only defined to function against the current version of a resource</li>
 <li>Where a search does not act on the referenced version, search results SHOULD contain a OperationOutcome with a warning that indicates the discrepancy</li>
 <li>If a resource has a reference that is versioned and _include is performed, the specified version SHOULD be provided.</li>
</ul>

<p>
Elements of type <a href="references.html#canonical">canonical</a> may contain a <a href="references.html#versions">version specific</a> reference,
but this version is different in both meaning and format to version specific references that might be found in a <a href="references.html#Reference">Reference</a>:
</p>
<pre>
  &nbsp;&lt;valueSet value=&quot;http://hl7.org/fhir/ValueSet/example|3.0&quot;/&gt;
</pre>
<p>
This version is a reference to the business version of the resource.
</p>
<p>
For canonical references, servers SHOULD support searching by Canonical URLs, and SHOULD support
automatically detecting a |[version] portion as part of the search parameter and
interpreting that portion as a search on the business version of the target resource.
The modifier <code>:below</code> is used with canonical references, to control
whether the version is considered in the search. The search:
</p>
<pre>
GET {base]/Observation?definition:below=http:http://acme.com/some-profile
</pre>
<p>
matches all of these element values:
</p>
<ul>
<li>http://acme.com/some-profile|1.0</li>
<li>http://acme.com/some-profile|1.1</li>
<li>http://acme.com/some-profile|2.0</li>
</ul>
<p>
The search:
</p>
<pre>
GET {base]/Observation?definition:below=http:http://acme.com/some-profile|1
</pre>
<p>
matches the first two element values. For further information about searching, 
see <a href="references.html#canonical-matching">Choosing the right Canonical Reference</a>.
</p>

<a name="recursive"></a>
<h4>Searching Hierarchies</h4>
<p>
Some references are <a href="references.html#circular">circular</a> - that is, the reference
points to another resource of the same type. When the reference establishes a strict hierarchy,
the modifiers :above and :below may be used to search transitively through the hierarchy:
</p>
<pre>
GET [base]/Procedure?location:below=42
</pre>
<p>
This search returns no only all procedures that occurred at location with id 42, but also any procedures
that occurred in locations that are part of location with id 42.
</p>
<pre>
GET [base]/MedicationAdministration?encounter:above=21
</pre>
<p>
Returns all medication administrations that happened during encounter with id 21 or during any "parent"
encounter of that encounter.
</p>
<p>
Servers indicate that :above/:below is supported on a search parameter by defining them as
<a href="searchparameter-definitions.html#SearchParameter.modifier">Modifiers</a> on the
Search Parameter definition.
</p>


<a name="chaining"></a>
<h4>Chained parameters</h4>
<p>
In order to save a client from performing a series of search operations,
reference parameters may be "chained" by appending them with
a period (<code>.</code>) followed by the name of a search parameter defined for the target
resource. This can be done recursively, following a logical path
through a graph of related resources, separated by <code>.</code>.
For instance, given that
the resource <a href="diagnosticreport.html">DiagnosticReport</a>
has a search parameter named <i>subject</i>, which is usually a
reference to a <a href="patient.html">Patient</a> resource, and
the Patient resource includes a parameter <i>name</i> which
searches on patient name, then the search
</p>
<pre>
 GET [base]/DiagnosticReport?subject.name=peter
</pre>
<p>
is a request to return all the lab reports that have a subject whose name includes "peter". Because
the Diagnostic Report subject can be one of a set of different resources, it's necessary to limit
the search to a particular type:
</p>
<pre>
 GET [base]/DiagnosticReport?subject:Patient.name=peter
</pre>
<p>
This request returns all the lab reports that have a subject which is a patient, whose name includes "peter".
</p>
<p>
Note that chained parameters are applied independently to the target resource. For example,
</p>
<pre>
GET Patient?general-practitioner.name=Joe&amp;general-practitioner.address-state=MN
</pre>
<p>
may return Patients cared for by Joe from CA and Jane from MN: no one practitioner need satisfy both conditions.
E.g. the chains are evaluated separately. For use cases where the joins must be evaluated in groups,
there are either <a href="#composite">Composite</a> search parameters, or the <a href="#filter">_filter</a>
parameter.
</p>
<p>
Advanced Search Note:
Where a chained parameter searches a resource reference that may have more than one
type of resource as its target, the parameter chain may end up referring
to search parameters with the same name on more than one kind of resource at once.
Servers SHOULD reject a search where the logical id refers to more than one matching
resource across different types.  For example, the client has to specify the type explicitly
using the syntax in the second example above.
</p>

<a name="has"></a>
<h4>Reverse Chaining</h4>

<p>
The _has parameter provides limited support for reverse chaining - that is, selecting
resources based on the properties of resources that refer to them (instead of chaining,
above, where resources can be selected based on the properties of resources that they
refer to). Here is an example of the _has parameter:
</p>
<pre>
GET [base]/Patient?_has:Observation:patient:code=1234-5
</pre>
<p>
This requests the server to return Patient resources, where the patient resource is
referred to by at least one Observation where the observation has a code of 1234, and
where the Observation refers to the patient resource in the patient search parameter.
</p>
<p>
"Or" searches are allowed (e.g. GET [base]/Patient?_has:Observation:patient:code=123,456), and multiple _has
parameters are allowed (e.g. GET [base]/Patient?_has:Observation:patient:code=123&amp;_has:Observation:patient:code=456).
Note that each _has parameter is processed independently of other _has parameters.
</p>
<p>
The _has parameter can be chained, like this:
</p>
<pre>
GET [base]/Patient?_has:Observation:patient:_has:AuditEvent:entity:user=MyUserId
</pre>
<p>
Fetch all the patients that have an Observation where the observation has an audit event from a specific user.
</p>


<a name="composite"></a>
<a name="combining"></a>
<h4>Composite Search Parameters</h4>
<p>
Composite search parameters support joining single values with a <code>$</code>. For example, the result
of the search operation is the intersection of the resources that match the criteria specified by each
individual search parameter. If a parameter repeats, such as <code>/Patient?language=FR&amp;language=NL</code>, then
this matches a patient who speaks both languages. This is known as an AND search parameter, since the
server is expected to respond only with results which match both values.
</p>
<p>
If, instead, the search is to find patients that speak either
language, then this is a single parameter with multiple values, separated by a <code>,</code>.
For example, <code>/Patient?language=FR,NL</code>. This is known as an OR search parameter,
since the server is expected to respond with results which match either value. Every search parameter
may be used with comma-separated values in this fashion; this includes the use of search parameters
with modifiers, such as `?code:text=this,that.
</p>
<p>
AND parameters and OR parameters may also be combined, for example:
<code>/Patient?language=FR,NL&amp;language=EN</code> would refer to any patient who speaks
English, as well as either French or Dutch.
</p>
<p>
This approach allows for simple combinations of and/or values, but doesn't allow a search based on
a pair of values, such as all observations with a sodium value >150 mmol/L (particularly
as the end criteria of a chained search), or searching on Group.characteristic where you need
find a combination of key/value, not an intersection of separate matches on key and value.
Another example is spatial coordinates when doing geographical searches.
</p>
<p>
To allow these searches, a resource may also specify <i>composite</i> parameters
that take sequences of single values that match other defined parameters as an
argument. The matching parameter of each component in such a sequence
is documented in the definition of the parameter. These sequences are formed by
joining the single values with a <code>$</code>.  Note: This sequence is a single
value and itself can be composed into a set of values, so that, for example,
multiple matching characteristic-value parameters can be specified as
<code>GET [base]/Group?characteristic-value=gender$mixed,owner$Eve</code>.
</p>
<p>
Note: Modifiers are not used on composite parameters.
<!--
Future note: use \p and \m in search values? if we add a double = to parameter value for text, that would get rid
of <code>:exact</code>.
Won't try to get rid of type modifier - that's the real use for modifiers because it has to be in a chaining line.
Other modifier is <code>:text</code> on token - use "~"? or ""?
-->
</p>

<p>
Examples of using composite parameters:
</p>

<table>
 <tr><td width="50%"><b>Search</b></td><td><b>Description</b></td></tr>
 <tr><td><pre> GET [base]/DiagnosticReport?result.code-value-quantity=http://loinc.org|2823-3$gt5.4|http://unitsofmeasure.org|mmol/L</pre></td><td>Search for all diagnostic reports that contain on observation with a potassium value of >5.4 mmol/L (UCUM)</td></tr>
 <tr><td><pre> GET [base]/Observation?component-code-value-quantity=http://loinc.org|8480-6$lt60</pre></td><td>Search for all the observations with a systolic blood pressure &lt; 60. Note that in this case, the unit is assumed (everyone uses mmHg)</td></tr>
 <tr><td><pre> GET [base]/Group?characteristic-value=gender$mixed</pre></td><td>Search for all groups that have a characteristic "gender" with a text value of "mixed"</td></tr>
 <tr><td><pre> GET [base]/Questionnaire?context-type-value=focus$http://snomed.info/sct|408934002</pre></td><td>Search for all questionnaires that have a clinical focus = "Substance abuse prevention assessment (procedure)"</td></tr>
</table>

<a name="missing"></a>
<h4>Handling Missing Data</h4>
<p>
Consider the case of searching for all AllergyIntolerance resources:
</p>
<pre>
GET [base]/AllergyIntolerance?clinical-status=http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical|active
</pre>
<p>
This search will only return resources that have a value for clinicalStatus:
</p>
<pre class="json" fragment="AllergyIntolerance">
{
  "resourceType" : "AllergyIntolerance",
   "clinicalStatus": {
    "coding": [
      {
        "system": "http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical",
        "code": "active"
      }
    ]
  }
}
</pre>
<p>
Resources missing a clinicalStatus will not be returned. This is probably unsafe - it would not usually
be appropriate to ignore AllergyIntolerance warnings with an unknown clinical status, and
only return resources with an explicit clinicalStatus. Instead, it might be desired to return
AllergyIntolerance resources with either an explicit value for clinicalStatus, or none:
</p>
<pre>
GET [base]/AllergyIntolerance?clinical-status=http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical|active
GET [base]/AllergyIntolerance?clinical-status:missing=true
</pre>
<p>
Note that this is 2 separate queries. They can be <a href="http.html#transaction">combined in a batch</a>,
but not in a single operation. This query will always return an empty list, as no resource can satisfy both criteria at once:
</p>
<pre>
GET [base]/AllergyIntolerance?clinical-status=http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical|active&amp;clinical-status:missing=true
</pre>
<p>
There is no way to use the :missing modifier and mix with a value using the
comma syntax documented above for composite search parameters.
</p>
<p>
An alternative approach is to use the <a href="#filter"><code>_filter</code></a> parameter,
for servers that support this parameter.
</p>

<a name="escaping"></a>
<h4>Escaping Search Parameters</h4>
<p>
In the rules described above, special rules are defined for the characters <code>$</code>, <code>,</code>, and <code>|</code>.
As a consequence, if these characters appear in an actual parameter value,
they must be differentiated from their use as separator characters. When
any of these characters appear in an actual parameter value, they must be
prepended by the character <code>\</code>, which also must be used to prepend itself.
Therefore, <code>param=xxx$xxx</code> indicates that it is a composite parameter, while <code>param=xx\$xx</code> indicates that
the parameter has the literal value <code>xx$xx</code>. The parameter value <code>xx\xx</code> is illegal,
and the parameter value <code>param=xx\\xx</code> indicates a literal value of <code>xx\xx</code>.
This means that:
</p>
<pre>
GET [base]/Observation?code=a,b
</pre>
<p>
is a request for any Observation that has a code of either <code>a</code> or <code>b</code>, whereas:
</p>
<pre>
GET [base]/Observation?code=a\,b
</pre>
<p>
is a request for any Observation that has a code of <code>a,b</code>.
</p>
<p>
This escaping is at a different level to the % encoding that applies to all
URL parameters. Standard % escaping still applies, such that these URLs
have the same meaning:
</p>
<pre>
GET [base]/ValueSet?url=http://acme.org/fhir/ValueSet/123,http://acme.org/fhir/ValueSet/124,125
GET [base]/ValueSet?url=http://acme.org/fhir/ValueSet/123,http://acme.org/fhir/ValueSet/124%2CValueSet/125
</pre>
<p>
As do these URLs:
</p>
<pre>
GET [base]/ValueSet?url=http://acme.org/fhir/ValueSet/123,http://acme.org/fhir/ValueSet/124\,125
GET [base]/ValueSet?url=http%58%47%47acme%46org%47fhir%47ValueSet%47123%44http%58%47%47acme%46org%47fhir%47ValueSet%47124%92%46125
</pre>
<p>
This specification defines this additional form of escape because the escape syntax using \ applies
to all parameter values after they have been 'unescaped' on the server while being read from the
HTTP headers.
</p>

<a name="text"></a>
<a name="content"></a>
<h4>Text Search Parameters</h4>
<p>
The special text search parameters, <code>_text</code> and <code>_content</code>, search
on the narrative of the resource, and the entire content of the resource respectively.
Just like string parameters using the <a href="search.html#modifiers"><code>:text</code></a> modifier, these parameters SHOULD support a sophisticated search functionality of the type
offered by typical text indexing services.
The value of the parameter is a text-based search, which may involve searching
multiple words with thesaurus and proximity considerations, and logical operations
such as AND, OR etc. For example:
</p>
<pre>
 GET [base]/Condition?_text=(bone OR liver) and metastases
</pre>
<p>
This request returns all Condition resources with the word "metastases" and either
"bone" or "liver" in the narrative. The server MAY choose to search
for related words as well.
</p>
<p>
Implementers could consider using the rules specified by the <a href="http://docs.oasis-open.org/odata/odata/v4.0/cs01/part1-protocol/odata-v4.0-cs01-part1-protocol.html#_The_$search_System">
OData specification for the $<code>search</code> parameter</a>. Typical implementations would use Lucene, Solr, an SQL-based full text search, or some similar indexing service.
</p>

<a name="special"></a>
<h4>Special Parameters</h4>
<p>
A few parameters have the type 'special'. That indicates that the way this parameter works is
unique to the parameter and described with the parameter. The general
modifiers and comparators do not apply, except as stated in the description.
</p>
<p>
Implementers will generally need to do special implementations for these
parameters. These parameters are special:
</p>
<ul>
 <li><a href="search_filter.html">_filter</a> (all resources)</li>
[%special-search-parameters%]
</ul>

<a name="list"></a>
<h4>Searching by list</h4>

<p>
The <code>_list</code> parameter allows for the retrieval of resources that are referenced by a <a href="list.html">List</a>
resource.
</p>
<pre>
 GET [base]?_list=42
 GET [base]/Patient?_list=42
</pre>
<p>
The first request returns all resources that are referenced from the list found at <code>[base]/List/42</code>) in List.entry.item.
The second request returns all Patient resources that are referenced from the list found at <code>[base]/List/42</code>) in List.entry.item.
While it is possible to retrieve the list, and then iterate the entries in the list fetching each
patient, using a list as a search criterion allows for additional search criteria to be specified. For
instance:
</p>
<pre>
 GET [base]/Patient?_list=42&amp;gender=female
</pre>
<p>
This request will return all female patients in the list. The server can return the list referred
to in the search parameter as an included resource, but is not required to do so.
In addition, a system can support searching by lists by their logical function. For example:
</p>
<pre>
 GET [base]/AllergyIntolerance?patient=42&amp;_list=$current-allergies
</pre>
<p>
This request will return all allergies in patient 42's "Current Allergy List".
The server returns all relevant AllergyIntolerance resources, and can also choose
to return the list. For further information, refer to the <a href="lifecycle.html#current">definition of "$current-allergies"</a>,
and the <a href="list-operations.html#find">List Operation "Find"</a>.
Note: Servers are not required to make these lists available to the clients as list resources,
but may choose to do so.
</p>

<a name="filter"></a>
<a name="_filter"></a>
<h4>Advanced filtering</h4>

<p>
The search mechanism described above is flexible, and easy to implement
for simple cases, but is limited in its ability to express combination
queries. To complement this mechanism, the "_filter" search expression
parameter can be used.
</p>
<p>
For example, "Find all the
observations for patient with a name including <code>peter</code> that have a LOINC code <code>1234-5</code>":
</p>
<pre>
GET [base]/Observation?code=http://loinc.org|1234-5&amp;subject.name=peter
</pre>
<p>
Using the <code>_filter</code> parameter, the search would be expressed like this:
</p>
<pre>
GET [base]/Observation?_filter=code eq http://loinc.org|1234-5 and subject.name co "peter"
</pre>
<p>
The <code>_filter</code> parameter is described in detail on the <a href="search_filter.html">"_Filter Parameter" page</a>.
</p>

<a name="type"></a>
<a name="_type"></a>
<h4>Specifying the type of Resource</h4>

<p>
Normally, a search is initiated against a known type of resource, e.g.
</p>
<pre>
GET [base]/Observation?params...
</pre>
<p>
However, in some circumstances, a search is executed where there is no fixed
type of resource:
</p>
<ul>
 <li>Using search across all resource types (GET [base]?params...)</li>
 <li>Using search with <a href="messaging.html">messaging</a></li>
 <li>Some search specifications inside other services e.g. decision support usage</li>
</ul>
<p>
In these circumstances, the search criteria may need to specify one or more
resource types that the search applies to. This can be done by using the
<code>_type</code> parameter:
</p>
<pre>
GET [base]/?_type=Observation,Condition&amp;other params...
</pre>
<p>
If no type is specified, the only search parameters that can be used in global search like
this are the base parameters that apply to all resources.
If multiple types are specified, any search parameters shared across the entire set of
specified resources may be used (see <a href="searchparameter-registry.html#common">search parameter registry</a>).
</p>
<p>
Technically, the <code>_type</code> parameter is a token parameter on the
<a href="valueset-resource-types.html">Resource Types</a> Value Set.
</p>

<a name="return"></a>
<h3>Managing Returned Resources</h3>

<a name="sort"></a>
<a name="_sort"></a>

<h4>Sorting</h4>
<p>
The client can indicate which order to return the results by
using the parameter <code>_sort</code>, which can contain a
comma-separated list of sort rules in priority order:
</p>
<pre>
GET [base]/Observation?_sort=status,-date,category
</pre>
<p>
Each item in the comma separated list is a search parameter,
optionally with a '-' prefix. The prefix indicates decreasing
order; in its absence, the parameter is applied in increasing order.
</p>
<p>
Notes:
</p>
<ul>
 <li>When sorting, the actual sort value used is not returned explicitly by
     the server for each resource, just the resource contents.</li>
 <li>To sort by relevance, use <code>_score</code>.</li>
 <li>The server returns the sort it performs as part of the returned
     search parameters (see <a href="#conformance">below</a>).</li>
 <li>A search parameter can refer to an element that repeats, and therefore
     there can be multiple values for a given search parameter for a single
     resource. In this case, the sort is based on the item in the set of
     multiple parameters that comes earliest in the specified sort order
     when ordering the returned resources.</li>
  <li>When sorting on string search parameters, sorting SHOULD be performed
     on a case-insensitive basis. Accents may either be ignored or sorted as
     per realm convention.</li>
  <li>This specification does not specify exact rules for consistency of sorting
     across servers. In general, this is deemed to be not as essential as
     consistency of filtering (though even that is a little variable). The
     purpose of sorting is to provide data in a "reasonable" order for end-users.
    "Reasonable" may vary by use case and realm, particularly for accented characters.</li>
</ul>

<div class="trial-content">
<p>
The _total parameter has the status <a href="versions.html#std-process" title="Trial Content" class="draft-flag">trial-use</a>
pending real world experience of its use.
</p>

<a name="total"></a>
<h4>Total number of matching resources</h4>
<p>
The return <a href="bundle.html">Bundle</a> has an element <code>total</code>
which is the number of resources that match the search parameters.
</p>
<p>
Note that <code>Bundle.total</code> represents the total
number of matches, not how many resources are returned in
a particular response (see <a href="#count">paging</a>, immediately below).
</p>
<p>
Providing a precise number of matching resources may be onerous for the
server, depending on how the server is designed. To help reduce the server
load, a client can provide the parameter <code>_total</code> to indicate
its preference with regard to the total, which can have one of the
following values:
</p>
<table class="codes">
 <tr><td>none</td><td>There is no need to populate the total count; the client will not use it</td></tr>
 <tr><td>estimate</td><td>A rough estimate of the number of matching resources is sufficient</td></tr>
 <tr><td>accurate</td><td>The client requests that the server provide an exact total of the number of matching resources</td></tr>
</table>
<p>
The <code>Bundle.total</code> element is still optional, and the servers can ignore the <code>_total</code>
parameter: it is just an optimization hint, that might possibly save the server some work.
</p>
</div>

<a name="count"></a>
<h4>Page Count</h4>

<p>
In order to keep the load on clients, servers and the network
minimized, the server may choose to return the results in
a series of pages. The search result set contains the URLs
that the client uses to request additional pages from the
search set. For a simple RESTful search, the page links are
<a href="http.html#paging">contained in the returned bundle as links</a>.
</p>
<p>
Typically, a server will provide its own parameters in the links
that it uses to manage the state of the search as pages are
retrieved. These parameters do not need to be understood
or processed by the client.
</p>

<p>
The parameter <code>_count</code> is defined as an instruction to the server
regarding how many resources should be returned in a
single page. Servers SHALL NOT return more resources in a single page than requested,
even if they don't support paging, but may return less than the client requested.
NOTE: This means that all servers that support search or history SHALL support
checking the _count parameter. The server should repeat
the original <code>_count</code> parameter in its returned page links so that
subsequent paging requests honor the original <code>_count</code>.  Note:
It is at the discretion of the search engine as to how to
handle ongoing updates to the resources while the search
is proceeding.
</p>

<p>
Note: The combination of <code>_sort</code> and <code>_count</code> can be used to return
only the latest resource that meets a particular criteria - set the
criteria, and then sort by date in descending order, with <code>_count=1</code>.
This way, the last matching resource will be returned.
</p>

<p>
if <code>_count</code> has the value 0, this shall be treated the same as <code>_summary=count</code>: the
server returns a bundle that reports the total number of resources that match in Bundle.total,
but with no entries, and no prev/next/last links. Note that the <code>Bundle.total</code> only
include the total number of matching resources. It does not count extra resources such as
<a href="operationoutcome.html">OperationOutcome</a> or <a href="#include">included</a> resources that may also be returned.
In the same way, the _count parameter only applies to resources with <code>entry.search.mode = match</code>, and does not include
included resources or operation outcomes.
</p>
<p>
The _count parameter has no impact on the value of <code>Bundle.total</code> as the latter represents the total
number of matches, not how many are returned in a single Bundle response.
</p>

<a name="include"></a>
<a name="revinclude"></a>
<h4>Including other resources in result (<code>_include</code> and <code>_revinclude</code>)</h4>
<p>
Clients may request that the engine return resources related to the search results, in order to reduce
the overall network delay of repeated retrievals of related resources. This is useful when the client
is searching on a clinical resource, but for every such resource returned, the client will also need
the subject (patient) resource that the clinical resource refers to. The client can use the
<code>_include</code> parameter to indicate that the subject resources be included in the results.
An alternative scenario is where the client wishes to fetch a particular resource, and any resources
that refer to it. For example, the client may wish to fetch a MedicationRequest, and any provenance
resources that refer to the prescription. This is known as a reverse include, and is specified by
providing a <code>_revinclude</code> parameter.
</p>
<p>
Both <code>_include</code> and <code>_revinclude</code> are based on search parameters, rather than
paths in the resource, since joins, such as <a href="#chaining">chaining</a>, are already done by
search parameter.
</p>
<p>
Each <code>_include</code> parameter specifies a search parameter to join on:
</p>
<pre>
 GET [base]/MedicationRequest?_include=MedicationRequest:patient
 GET [base]/MedicationRequest?_revinclude=Provenance:target
</pre>
<p>
The first search requests all matching MedicationRequests, to include
any patient that the medication prescriptions in the result set refer to.
The second search requests all matching prescriptions, return all
the provenance resources that refer to them.
</p>
<p>
Parameter values for both <code>_include</code> and <code>_revinclude</code> have three parts, separated by a <code>:</code> character:
</p>
<ol>
 <li>The name of the source resource from which the join comes</li>
 <li>The name of the search parameter which must be of type <i>reference</i></li>
 <li>(Optional) A specific of type of target resource (for when the search parameter refers to multiple possible target types)</li>
</ol>
<p>
<code>_include</code> and <code>_revinclude</code> parameters do not include multiple values. Instead, the
parameters are repeated for each different include criteria.
</p>
<p>
For each returned resource, the server identifies the resources that meet
the criteria expressed in the join, and adds to the results,
with the <a href="bundle-definitions.html#Bundle.entry.search.mode">entry.search.mode</a>
set to "include" (in some searches, it is not obvious which resources are
matches, and which are includes). If there is no reference, or no matching resource, the resource
cannot be retrieved (e.g. on a different server), then the resource is omitted, and no
error is returned.
</p>
<p>
Servers SHOULD resolve _include requests for version-specific references by resolving the version named in the reference.
</p>
<p>
The inclusion process can be iterative, if (and only if) the modifier <code>:iterate</code> is included.
For example, this search returns all <a href="medicationrequest.html">Medication
Request</a> resources and their <a href="practitioner.html">prescribing Practitioner</a> Resources
for the matching <a href="medicationdispense.html">Medication Dispense</a> resources:
</p>
<pre>
GET [base]/MedicationDispense?_include=MedicationDispense:prescription
    &amp;_include:iterate=MedicationRequest:performer&amp;criteria...
</pre>
<p>
This technique applies to circular relationships as well. For example,
the first of these two searches includes any related observations to the
target relationships, but only those directly related. The second search
asks for the <code>_include</code> based on <code>related</code> parameter to be executed
iteratively, so it will retrieve observations that are directly related, and
also any related observations to any other included observation.
</p>
<pre>
GET [base]/Observation?_include=Observation:has-member&amp;criteria...
GET [base]/Observation?_include:iterate=Observation:has-member&amp;criteria...
</pre>
<p>
Both <code>_include</code> and <code>_revinclude</code> use the wild card "*" for the search parameter
name, indicating that any search parameter of type=reference be included.  Though
both clients and servers need to take care not to request or return too many resources
when doing this. Most notably, using iterative wildcards inclusions might lead to the retrieval of the
full patient's record, or even more than that: resources are organized into an interlinked network
and broad <code>_include</code> paths may eventually traverse all possible paths on the server. For
servers, these iterative and wildcard <code>_include</code>s are demanding and may slow the search
response time significantly.
</p>
<p>
It is at the server's discretion how deep to iteratively evaluate the inclusions.
Servers are expected to limit the number of iterations done to an appropriate level
and are not obliged to honor requests to include additional resources in the search results.
Because iterative search is generally resource intensive, it is not the default behavior.
</p>
<p>
When search results are paged, each page of search results should include
the matching includes for the resources in each page, so that each page stands
alone as a coherent package.
</p>
<p>
Note: when considering using _include and _revinclude, implementers
should also consider whether using <a href="graphql.html">GraphQL</a> and/or
<a href="graphdefinition.html">GraphDefinition</a> are more appropriate
approaches in their context.
</p>

<a name="contained"></a>
<a name="containedType"></a>


<h4>Contained Resources</h4>

<p>
By default, search results only include resources that are not contained in other resources.
A chained condition will be evaluated inside contained resources. To illustrate this, consider
a MedicationRequest resource that has a contained Medication resource specifying
a custom formulation that has ingredient with a <code>itemCodeableConcept</code> "abc" in "http://acme.com./medications".
In this case, a search:
</p>
<pre>
GET MedicationRequest?medication.ingredient-code=abc
</pre>
<p>
  will include the MedicationRequest resource in the results. However, this search:
</p>
<pre>
GET Medication?ingredient-code=abc
</pre>
<p>
will not include the contained Medication resource in the results, since either the
wrong type of resource would be returned, or the contained resource would be returned
without its container resource, which provides context to the contained resource.
</p>
<p>
Clients can modify this behavior using the <code>_contained</code> parameter, which
can have one of the following values:
</p>
<ul>
 <li>false (default): Do not return contained resources</li>
 <li>true: return only contained resources</li>
 <li>both: return both contained and non-contained (normal) resources</li>
</ul>
<p>
When contained resources are being returned, the server
should return either the container resource, or the contained resource alone. The
client can specify which by using the <code>_containedType</code> parameter, which can have one of the
following values:
</p>
<ul>
 <li>container (default): Return the container resources</li>
 <li>contained: return only the contained resource</li>
</ul>
<p>
When returning a container resource, the server simply puts this in the
search results:
</p>
<pre class="xml">
&lt;Bundle&gt;
  ...
  &lt;entry&gt;
    &lt;resource&gt;
      &lt;MedicationRequest&gt;
        &lt;id value=&quot;23&quot;&gt;
        ....
        &lt;contained&gt;
          &lt;Medication&gt;
            &lt;id value=&quot;m1&quot;&gt;
            ...
          &lt;/Medication&gt;
        &lt;contained&gt;

      &lt;/MedicationRequest&gt;
    &lt;/resource&gt;
    &lt;search&gt;
      &lt;mode value=&quot;match&quot;/&gt;
    &lt;/search&gt;
  &lt;/entry&gt;
&lt;/Bundle&gt;
</pre>
<p>
In the case of returning container resources, the server SHALL populate the entry.search.mode
element, as shown, so that the client can pick apart matches and includes (since the usual approach of doing it
by type might not work).
</p>
<p>
If the return type is the contained resource, this must be done slightly
differently:
</p>
<pre class="xml">
&lt;Bundle&gt;
  ...
  &lt;entry&gt;
    &lt;fullUrl value=&quot;http://example.com/fhir/MedicationRequest/23#m1&quot;/&gt;
    &lt;resource&gt;
      &lt;Medication&gt;
        &lt;id value=&quot;m1&quot;&gt;
        ...
      &lt;/Medication&gt;
    &lt;/resource&gt;
    &lt;search&gt;
      &lt;mode value=&quot;match&quot;/&gt;
    &lt;/search&gt;
  &lt;/entry&gt;
&lt;/Bundle&gt;
</pre>
<p>
In this case, the fullUrl informs the client that this is a contained resource,
along with indicating the identity of the containing resource.
</p>

<a name="external"></a>

<h4>External References</h4>
<p>
If the <code>_include</code> path selects a reference that refers to a resource on another server,
the server can elect to include that resource in the search results for the convenience
of the client.
</p>
<p>
If the <code>_include</code> path selects a reference that refers to an entity that is not a Resource, such as
an image attachment, the server may also elect to include this in the returned
results as a <a href="binary.html">Binary</a> resource. For example, the include
path may point to an attachment which is by reference, like this:
</p>
<pre>
 &lt;content&gt;
   &lt;contentType&gt;image/jpeg&lt;/contentType&gt;
   &lt;url&gt;http://example.org/images/2343434/234234.jpg&lt;/url&gt;
 &lt;/content&gt;
</pre>
<p>
The server can retrieve the target of this reference, and add it to the
results for the convenience of the client.
</p>

<a name="Paging"></a>
<h4>Paging</h4>
<p>
When returning paged results for a search with <code>_include</code> resources, all <code>_include</code> resources that are
related to the primary resources returned for the page SHOULD also be returned as part of that
same page, even if some of those resource instances have previously been returned on previous
pages.  This approach allows both sender and receiver to avoid caching results of other pages.
</p>

<a name="summary"></a>
<h4>Summary</h4>
<p>
The client can request the server to return only a portion of the resources
by using the parameter <code>_summary</code>:
</p>
<pre>
   GET [base]/ValueSet?_summary=true
</pre>
<p>
The <code>_summary</code> parameter requests the server to return a subset of the
resource. It can contain one of the following values:
</p>
<table class="codes">
 <tr><td><a href="#summary-true">true</a></td><td>Return a limited subset of elements from the resource.  This subset SHOULD consist solely of all supported elements that are marked as "summary" in the base definition of the resource(s) (see <a href="elementdefinition-definitions.html#ElementDefinition.isSummary">ElementDefinition.isSummary</a>)</td></tr>
 <tr><td><a href="#summary-text">text</a></td><td>Return only the "text" element, the 'id' element, the 'meta' element, and only top-level mandatory elements</td></tr>
 <tr><td><a href="#summary-data">data</a></td><td>Remove the text element</td></tr>
 <tr><td><a href="#summary-count">count</a></td><td>Search only: just return a count of the matching resources, without returning the actual matches</td></tr>
 <tr><td><a href="#summary-false">false</a></td><td>Return all parts of the resource(s)</td></tr>
</table>
<p>
The intent of the <code>_summary</code> parameter is to reduce the total processing load on
server, client, and resources between them such as the network. It is most useful for
resources that are large, particularly ones that include images or elements that
may repeat many times. The purpose of the summary form is to allow a client to quickly
retrieve a large set of resources, and let a user pick the appropriate one. The
summary for an element is defined to allow a user to quickly sort and filter the
resources, and typically omit important content on the basis that the entire
resource will be retrieved when the user selects a resource.
</p>
<p>
Servers are not obliged to return just a summary as requested. There are only
a limited number of summary forms defined for resources in order to allow servers
to store the summarized form(s) in advance. Servers SHOULD mark the resources with the
tag <a href="v3/ObservationValue/cs.html#v3-ObservationValue-SUBSETTED"><code>SUBSETTED</code></a>
code to ensure that the incomplete resource is not accidentally used to overwrite
a complete resource.
</p>
<p>
The self link in the search result Bundle is important for the interpretation of the result
and should always be returned, regardless of the type of _summary.
</p>
<p>
Note that the <code>_include</code> and <code>_revinclude</code> parameters cannot be mixed with <code>_summary=text</code>.
</p>

[%impl-note%]
<a name="dstu-tc"></a>
There is some question about the inclusion of extensions in the summary. Additional rules may be made
around this in the future.
[%end-note%]

<a name="elements"></a>
<h4>Elements</h4>
<p>
If one of the summary views defined above is not appropriate, a client can
request a specific set of elements be returned as part of a resource in the search results using
the <code>_elements</code> parameter:
</p>
<pre>
   GET [base]/Patient?_elements=identifier,active,link
</pre>
<p>
The <code>_elements</code> parameter consists of a comma-separated list of base element
names such as, elements defined at the root level in the resource. Only
elements that are listed are to be returned. Clients SHOULD list all mandatory and modifier
elements in a resource as part of the list of elements. The list of elements
does not apply to <a href="#include">included resources</a>.
</p>
<p>
Servers are not obliged to return just the requested elements.
Servers SHOULD always return mandatory elements whether they are
requested or not. Servers SHOULD mark the resources with the
tag <a href="v3/ObservationValue/cs.html#v3-ObservationValue-SUBSETTED"><code>SUBSETTED</code></a>
code to ensure that the incomplete resource is not actually used to overwrite
a complete resource.
</p>

<a name="score"></a>
<h4>Relevance</h4>
<p>
Where a search specifies a non-deterministic sort, the search algorithm
may generate a ranking score to indicate which resources meet
the specified criteria better than others. The server can return this
score in <a href="bundle-definitions.html#Bundle.entry.score">entry.score</a>:
</p>
<pre class="xml">
  &lt;entry&gt;
    &lt;score value=&quot;.45&quot;/&gt;
    &lt;Patient&gt;
      ... patient data ...
    &lt;/Patient&gt;
  &lt;/entry&gt;
</pre>
<p>
The score is a decimal number with a value between (and including) 0 and 1, where 1 is best match, and 0 is least match.
</p>

<a name="conformance"></a>
<h3>Server Conformance</h3>
<p>
In order to allow the client to be confident about what search parameters
were used as criteria by the server, the server SHALL return the parameters
that were actually used to process the search. Applications processing search
results SHALL check these returned values where necessary. For example, if
the server did not support some of the filters specified in the search, a
client might manually apply those filters to the retrieved result set,
display a warning message to the user or take some other action.
</p>
<p>
In the case of a RESTful search, these parameters are encoded in the
self link in the bundle that is returned:
</p>
<pre class="xml">
  &lt;link&gt;
    &lt;relation value="self"/&gt;
    &lt;url value="http://example.org/Patient?name=peter"/&gt;
  &lt;/link&gt;
</pre>
<p>
In other respects, servers have considerable discretion with regards
to supporting search:
</p>
<ul>
 <li>Servers can choose which parameters to support (other than <code>_id</code> above).</li>
 <li>Servers can choose when and where to implement parameter chaining, and when and where they support the <code>_include</code> parameter.</li>
 <li>Servers can declare additional parameters in the profiles referenced from their Capability statements. Servers should define search parameters
    starting with a "-" character to ensure that the names they choose do not clash with future parameters defined by this specification.</li>
 <li>Servers are not required to enforce case sensitivity on parameter names, though the names are case sensitive (and URLs are generally case-sensitive).</li>
 <li>Servers may choose how many results to return, though the client can use <code>_count</code> as above</li>
 <li>Servers can choose how to sort the return results, though they SHOULD honor the <code>_sort</code> parameter.</li>
</ul>

<hr/>
<a name="advanced"></a>
<a name="query"></a>
<h3>Advanced Search</h3>
<p>
The search framework described above is a useful framework
for providing a simple search based on indexed criteria,
but more sophisticated query capability is needed to handle precise
queries, complex decision support-based requests, and
direct queries that have human resolution.
</p>
<p>
More advanced search operations are specified by the
<code>_query</code> parameter:
</p>
<pre>
   GET [base]/Patient?_query=name&amp;parameters...
</pre>
<p>
The <code>_query</code> parameter names a custom search profile that
describes a specific query operation. The named query
may define additional named parameters that are used with that
particular named query. Servers can define their own additional
named queries to meet their own uses using an <a href="operationdefinition.html">OperationDefinition</a>.
</p>
<p>
There can only ever be one <code>_query</code> parameter in a set of search
parameters. Servers processing search requests SHALL
refuse to process a search request if they do not recognize
the <code>_query</code> parameter value.
</p>

<a name="currency"></a>
<h3>Search Result Currency</h3>

<p>
The results of a search operation are only guaranteed to be current
at the instant the operation is executed. After the operation is executed,
ongoing actions performed on the resources against which the search was
executed will render the results increasingly stale. The significance
of this depends on the nature of the search, and the kind of use that
is being made of the results.
</p>
<p>
This is particularly relevant when the server is returning the results
in a series of pages. It is at the discretion of the search engine of
how to handle ongoing updates to the resources while the search
is proceeding.
</p>
<p>
Performing a search operation does not change the set of
resources on the server, with the exception of the creation
of <a href="auditevent.html">Audit Event</a> resources
auditing the search itself.
</p>

<a name="table"></a>
<h3>Summary Tables</h3>

<table class="list">
<tr><td colspan="4">Common Parameters defined for all resources:</td></tr>
<tr><td><b>Name</b></td><td><b>Type</b></td><td><b>Description</b></td><td><b>Paths</b></td></tr>
<tr><td><a href="#id"><code>_id</code></a></td><td><a href="#token">token</a></td><td>Resource id (not a full URL)</td><td>Resource.id</td></tr>
<tr><td><a href="#lastUpdated"><code>_lastUpdated</code></a></td><td><a href="#date">date</a></td><td>Date last updated. Server has discretion on the boundary precision</td><td>Resource.meta.lastUpdated</td></tr>
<tr><td><a href="#tag">_tag</a></td><td><a href="#token">token</a></td><td>Search by a resource tag</td><td>Resource.meta.tag</td></tr>
<tr><td><a href="#profile"><code>_profile</code></a></td><td><a href="#reference">reference</a></td><td>Search for all resources tagged with a profile</td><td>Resource.meta.profile</td></tr>
<tr><td><a href="#security"><code>_security</code></a></td><td><a href="#token">token</a></td><td>Search by a security label</td><td>Resource.meta.security</td></tr>
<tr><td><a href="#text"><code>_text</code></a></td><td><a href="#string">string</a></td><td>Text search against the narrative</td><td></td></tr>
<tr><td><a href="#content"><code>_content</code></a></td><td><a href="#string">string</a></td><td>Text search against the entire resource</td><td></td></tr>
<tr><td><a href="#list"><code>_list</code></a></td><td><a href="#string">string</a></td><td>All resources in nominated list (by id, not a full URL)</td><td></td></tr>
<tr><td><a href="#query">_query</a></td><td><a href="#string">string</a></td><td>Custom named query</td><td></td></tr>
<tr><td colspan="4">Search Control Parameters:</td></tr>
<tr><td><b>Name</b></td><td><b>Type</b></td><td><b>Description</b></td><td><b>Allowable Content</b></td></tr>
<tr><td><a href="#sort"><code>_sort</code></a></td><td><a href="#string">string</a></td><td>Order to sort results in (can repeat for inner sort orders)</td><td>Name of a valid search parameter</td></tr>
<tr><td><a href="#count"><code>_count</code></a></td><td><a href="#number ">number </a></td><td>Number of results per page</td><td>Whole number</td></tr>
<tr><td><a href="#include"><code>_include</code></a></td><td><a href="#string">string</a></td><td>Other resources to include in the search results that search matches point to</td><td>SourceType:searchParam(:targetType)</td></tr>
<tr><td><a href="#revinclude"><code>_revinclude</code></a></td><td><a href="#string">string</a></td><td>Other resources to include in the search results when they refer to search matches</td><td>SourceType:searchParam(:targetType)</td></tr>
<tr><td><a href="#summary"><code>_summary</code></a></td><td><a href="#string">string</a></td><td>Just return the summary elements (for resources where this is defined)</td><td><code>true</code> | <code>false</code> (<code>false</code> is default)</td></tr>
<tr><td><a href="#contained"><code>_contained</code></a></td><td><a href="#string">string</a></td><td>Whether to return resources contained in other resources in the search matches</td><td><code>true</code> | <code>false</code> | <code>both</code> (<code>false</code> is default)</td></tr>
<tr><td><a href="#containedType"><code>_containedType</code></a></td><td><a href="#string">string</a></td><td>If returning contained resources, whether to return the contained or container resources</td><td><code>container</code> | <code>contained</code></td></tr>
</table>

<p>
Cross-map between search parameter types and Data types:
</p>
<table class="list">
 <tr>
  <td><b>Data Type</b></td>
  <td><b><a href="#number">number</a></b></td>
  <td><b><a href="#date">date</a></b></td>
  <td><b><a href="#reference">reference</a></b></td>
  <td><b><a href="#quantity">quantity</a></b></td>
  <td><b><a href="#uri">uri</a></b></td>
  <td><b><a href="#string">string</a></b></td>
  <td><b><a href="#token">token</a></b></td>
 </tr>
 <tr>
   <td colspan="8" style="background-color: #efefef"><b>Primitive Types</b></td>
 </tr>
 <tr>
  <td><a href="datatypes.html#base64Binary">base64Binary</a></td>
  <td colspan="7" style="background-color: #f9f9f9"><%xcmchk base64Binary%>Not used in search</td> <!-- uri -->
 </tr>
 <tr>
  <td><a href="datatypes.html#boolean">boolean</a></td>
  <td><%xcm boolean:number%></td> <!-- number -->
  <td><%xcm boolean:date%></td> <!-- date -->
  <td><%xcm boolean:reference%></td> <!-- reference -->
  <td><%xcm boolean:quantity%></td> <!-- quantity -->
  <td><%xcm boolean:uri%></td> <!-- uri -->
  <td><%xcm boolean:string%></td> <!-- string -->
  <td><%xcm boolean:token%>. true|false (System = http://hl7.org/fhir/special-values but not usually needed)</td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#canonical">canonical</a></td>
  <td><%xcm canonical:number%></td> <!-- number -->
  <td><%xcm canonical:date%></td> <!-- date -->
  <td><%xcm canonical:reference%></td> <!-- reference -->
  <td><%xcm canonical:quantity%></td> <!-- quantity -->
  <td><%xcm canonical:uri%></td> <!-- uri -->
  <td><%xcm canonical:string%></td> <!-- string -->
  <td><%xcm canonical:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#code">code</a></td>
  <td><%xcm code:number%></td> <!-- number -->
  <td><%xcm code:date%></td> <!-- date -->
  <td><%xcm code:reference%></td> <!-- reference -->
  <td><%xcm code:quantity%></td> <!-- quantity -->
  <td><%xcm code:uri%></td> <!-- uri -->
  <td><%xcm code:string%></td> <!-- string -->
  <td><%xcm code:token%>. (System, if desired, is defined in the underlying value set for each code)</td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#date">date</a></td>
  <td><%xcm date:number%></td> <!-- number -->
  <td><%xcm date:date%></td> <!-- date -->
  <td><%xcm date:reference%></td> <!-- reference -->
  <td><%xcm date:quantity%></td> <!-- quantity -->
  <td><%xcm date:uri%></td> <!-- uri -->
  <td><%xcm date:string%></td> <!-- string -->
  <td><%xcm date:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#dateTime">dateTime</a></td>
  <td><%xcm dateTime:number%></td> <!-- number -->
  <td><%xcm dateTime:date%></td> <!-- date -->
  <td><%xcm dateTime:reference%></td> <!-- reference -->
  <td><%xcm dateTime:quantity%></td> <!-- quantity -->
  <td><%xcm dateTime:number%></td> <!-- uri -->
  <td><%xcm dateTime:string%></td> <!-- string -->
  <td><%xcm dateTime:token%></td> <!-- token -->
 </tr>
  <tr>
  <td><a href="datatypes.html#decimal">decimal</a></td>
  <td><%xcm decimal:number%></td> <!-- number -->
  <td><%xcm decimal:date%></td> <!-- date -->
  <td><%xcm decimal:reference%></td> <!-- reference -->
  <td><%xcm decimal:quantity%></td> <!-- quantity -->
  <td><%xcm decimal:uri%></td> <!-- uri -->
  <td><%xcm decimal:string%></td> <!-- string -->
  <td><%xcm decimal:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#id">id</a></td>
  <td><%xcm id:number%></td> <!-- number -->
  <td><%xcm id:date%></td> <!-- date -->
  <td><%xcm id:reference%></td> <!-- reference -->
  <td><%xcm id:quantity%></td> <!-- quantity -->
  <td><%xcm id:uri%></td> <!-- uri -->
  <td><%xcm id:string%></td> <!-- string -->
  <td><%xcm id:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#instant">instant</a></td>
  <td><%xcm instant:number%></td> <!-- number -->
  <td><%xcm instant:date%></td> <!-- date -->
  <td><%xcm instant:reference%></td> <!-- reference -->
  <td><%xcm instant:quantity%></td> <!-- quantity -->
  <td><%xcm instant:uri%></td> <!-- uri -->
  <td><%xcm instant:string%></td> <!-- string -->
  <td><%xcm instant:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#integer">integer</a></td>
  <td><%xcm integer:number%></td> <!-- number -->
  <td><%xcm integer:date%></td> <!-- date -->
  <td><%xcm integer:reference%></td> <!-- reference -->
  <td><%xcm integer:quantity%></td> <!-- quantity -->
  <td><%xcm integer:uri%></td> <!-- uri -->
  <td><%xcm integer:string%></td> <!-- string -->
  <td><%xcm integer:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#markdown">markdown</a></td>
  <td colspan="7" style="background-color: #f9f9f9"><%xcmchk markdown%>Not used in search</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#oid">oid</a></td>
  <td colspan="7" style="background-color: #f9f9f9"><%xcmchk oid%>Not used in search (but see uri)</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#positiveInt">positiveInt</a></td>
  <td colspan="7" style="background-color: #f9f9f9"><%xcmchk positiveInt%>Not used in search (but see integer)</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#string">string</a></td>
  <td><%xcm string:number%></td> <!-- number -->
  <td><%xcm string:date%></td> <!-- date -->
  <td><%xcm string:reference%></td> <!-- reference -->
  <td><%xcm string:quantity%></td> <!-- quantity -->
  <td><%xcm string:uri%></td> <!-- uri -->
  <td><%xcm string:string%></td> <!-- string -->
  <td><%xcm string:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#time">time</a></td>
  <td colspan="7" style="background-color: #f9f9f9"><%xcmchk time%>Not used in search</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#unsignedInt">unsignedInt</a></td>
  <td colspan="7" style="background-color: #f9f9f9"><%xcmchk unsignedInt%>Not used in search (but see integer)</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#uri">uri</a></td>
  <td><%xcm uri:number%></td> <!-- number -->
  <td><%xcm uri:date%></td> <!-- date -->
  <td><%xcm uri:reference%></td> <!-- reference -->
  <td><%xcm uri:quantity%></td> <!-- quantity -->
  <td><%xcm uri:uri%></td> <!-- uri -->
  <td><%xcm uri:string%> </td> <!-- string -->
  <td><%xcm uri:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#url">url</a></td>
  <td colspan="7" style="background-color: #f9f9f9"><%xcmchk url%>Not used in search (but see uri)</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#uuid">uuid</a></td>
  <td colspan="7" style="background-color: #f9f9f9"><%xcmchk uuid%>Not used in search (but see uri)</td>
 </tr>
 <tr>
   <td colspan="8" style="background-color: #efefef"><b>Data Types</b></td>
 </tr>
 <tr>
  <td><a href="datatypes.html#Address">Address</a></td>
  <td><%xcm Address:number%></td> <!-- number -->
  <td><%xcm Address:date%></td> <!-- date -->
  <td><%xcm Address:reference%></td> <!-- reference -->
  <td><%xcm Address:quantity%></td> <!-- quantity -->
  <td><%xcm Address:uri%></td> <!-- uri -->
  <td><%xcm Address:string%> search on any string element in the address</td> <!-- string -->
  <td><%xcm Address:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#Age">Age</a></td>
  <td><%xcm Age:number%></td> <!-- number -->
  <td><%xcm Age:date%></td> <!-- date -->
  <td><%xcm Age:reference%></td> <!-- reference -->
  <td><%xcm Age:quantity%></td> <!-- quantity -->
  <td><%xcm Age:uri%></td> <!-- uri -->
  <td><%xcm Age:string%></td> <!-- string -->
  <td><%xcm Age:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#Annotation">Annotation</a></td>
  <td colspan="7" style="background-color: #f9f9f9"><%xcmchk Annotation%>Not used in search</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#Annotation">Attachment</a></td>
  <td colspan="7" style="background-color: #f9f9f9"><%xcmchk Attachment%>Not used in search</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#CodeableConcept">CodeableConcept</a></td>
  <td><%xcm CodeableConcept:number%></td> <!-- number -->
  <td><%xcm CodeableConcept:date%></td> <!-- date -->
  <td><%xcm CodeableConcept:reference%></td> <!-- reference -->
  <td><%xcm CodeableConcept:quantity%></td> <!-- quantity -->
  <td><%xcm CodeableConcept:uri%></td> <!-- uri -->
  <td><%xcm CodeableConcept:string%></td> <!-- string -->
  <td><%xcm CodeableConcept:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#CodeableReference">CodeableReference</a></td>
  <td colspan="7" style="background-color: #f9f9f9"><%xcmchk CodeableReference%>Not used in search (searches either refer to .concept or .reference)</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#Coding">Coding</a></td>
  <td><%xcm Coding:number%></td> <!-- number -->
  <td><%xcm Coding:date%></td> <!-- date -->
  <td><%xcm Coding:reference%></td> <!-- reference -->
  <td><%xcm Coding:quantity%></td> <!-- quantity -->
  <td><%xcm Coding:uri%></td> <!-- uri -->
  <td><%xcm Coding:string%></td> <!-- string -->
  <td><%xcm Coding:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#Count">Count</a></td>
  <td colspan="7" style="background-color: #f9f9f9"><%xcmchk Count%>Not used in search</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#ContactPoint">ContactPoint</a></td>
  <td><%xcm ContactPoint:number%></td> <!-- number -->
  <td><%xcm ContactPoint:date%></td> <!-- date -->
  <td><%xcm ContactPoint:reference%></td> <!-- reference -->
  <td><%xcm ContactPoint:quantity%></td> <!-- quantity -->
  <td><%xcm ContactPoint:uri%></td> <!-- uri -->
  <td><%xcm ContactPoint:string%></td> <!-- string -->
  <td><%xcm ContactPoint:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#Distance">Distance</a></td>
  <td colspan="7" style="background-color: #f9f9f9"><%xcmchk Distance%>Not used in search</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#Duration">Duration</a></td>
  <td><%xcm Duration:number%></td> <!-- number -->
  <td><%xcm Duration:date%></td> <!-- date -->
  <td><%xcm Duration:reference%></td> <!-- reference -->
  <td><%xcm Duration:quantity%></td> <!-- quantity -->
  <td><%xcm Duration:uri%></td> <!-- uri -->
  <td><%xcm Duration:string%></td> <!-- string -->
  <td><%xcm Duration:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#HumanName">HumanName</a></td>
  <td><%xcm HumanName:number%></td> <!-- number -->
  <td><%xcm HumanName:date%></td> <!-- date -->
  <td><%xcm HumanName:reference%></td> <!-- reference -->
  <td><%xcm HumanName:quantity%></td> <!-- quantity -->
  <td><%xcm HumanName:uri%></td> <!-- uri -->
  <td><%xcm HumanName:string%> Search on any string element in the name</td> <!-- string -->
  <td><%xcm HumanName:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#Identifier">Identifier</a></td>
  <td><%xcm Identifier:number%></td> <!-- number -->
  <td><%xcm Identifier:date%></td> <!-- date -->
  <td><%xcm Identifier:reference%></td> <!-- reference -->
  <td><%xcm Identifier:quantity%></td> <!-- quantity -->
  <td><%xcm Identifier:uri%></td> <!-- uri -->
  <td><%xcm Identifier:string%></td> <!-- string -->
  <td><%xcm Identifier:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#Money">Money</a></td>
  <td><%xcm Money:number%></td> <!-- number -->
  <td><%xcm Money:date%></td> <!-- date -->
  <td><%xcm Money:reference%></td> <!-- reference -->
  <td><%xcm Money:quantity%></td> <!-- quantity -->
  <td><%xcm Money:uri%></td> <!-- uri -->
  <td><%xcm Money:string%></td> <!-- string -->
  <td><%xcm Money:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#Period">Period</a></td>
  <td><%xcm Period:number%></td> <!-- number -->
  <td><%xcm Period:date%></td> <!-- date -->
  <td><%xcm Period:reference%></td> <!-- reference -->
  <td><%xcm Period:quantity%></td> <!-- quantity -->
  <td><%xcm Period:uri%></td> <!-- uri -->
  <td><%xcm Period:string%></td> <!-- string -->
  <td><%xcm Period:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#Quantity">Quantity</a></td>
  <td><%xcm Quantity:number%></td> <!-- number -->
  <td><%xcm Quantity:date%></td> <!-- date -->
  <td><%xcm Quantity:reference%></td> <!-- reference -->
  <td><%xcm Quantity:quantity%></td> <!-- quantity -->
  <td><%xcm Quantity:uri%></td> <!-- uri -->
  <td><%xcm Quantity:string%></td> <!-- string -->
  <td><%xcm Quantity:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#Range">Range</a></td>
  <td><%xcm Range:number%></td> <!-- number -->
  <td><%xcm Range:date%></td> <!-- date -->
  <td><%xcm Range:reference%></td> <!-- reference -->
  <td><%xcm Range:quantity%></td> <!-- quantity -->
  <td><%xcm Range:uri%></td> <!-- uri -->
  <td><%xcm Range:string%></td> <!-- string -->
  <td><%xcm Range:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#Ratio">Ratio</a></td>
  <td colspan="7" style="background-color: #f9f9f9"><%xcmchk base64Binary%>Not used in search</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#Reference">Reference</a></td>
  <td><%xcm Reference:number%></td> <!-- number -->
  <td><%xcm Reference:date%></td> <!-- date -->
  <td><%xcm Reference:reference%></td> <!-- reference -->
  <td><%xcm Reference:quantity%></td> <!-- quantity -->
  <td><%xcm Reference:uri%></td> <!-- uri -->
  <td><%xcm Reference:string%></td> <!-- string -->
  <td><%xcm Reference:token%></td> <!-- token -->
 </tr>
 <tr>
  <td><a href="datatypes.html#base64Binary">SampledData</a></td>
  <td colspan="7" style="background-color: #f9f9f9"><%xcmchk SampledData%>Not used in search</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#Signature">Signature</a></td>
  <td colspan="7" style="background-color: #f9f9f9"><%xcmchk Signature%>Not used in search</td>
 </tr>
 <tr>
  <td><a href="datatypes.html#Timing">Timing</a></td>
  <td><%xcm Timing:number%></td> <!-- number -->
  <td><%xcm Timing:date%></td> <!-- date -->
  <td><%xcm Timing:reference%></td> <!-- reference -->
  <td><%xcm Timing:quantity%></td> <!-- quantity -->
  <td><%xcm Timing:uri%></td> <!-- uri -->
  <td><%xcm Timing:string%></td> <!-- string -->
  <td><%xcm Timing:token%></td> <!-- token -->
 </tr>
</table>

[%file newfooter%]
</body>
</html>

