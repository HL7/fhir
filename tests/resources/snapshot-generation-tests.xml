<TestScript xmlns="http://hl7.org/fhir" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://hl7.org/fhir ../../schema/fhir-single.xsd">
  <!--
 in this test script, are a set of test cases for snapshot generation
 
 1. No change made by differential
 2. No change in differential, but use a resource with recursion in the definitions
 3. change a cardinality
 4. test appending documentation
 5. test constraining the type (with renaming)
 6. test constraining the type (without renaming)
 7. test adding a mapping 
 8. test walking into a new type
 9. test walking into a new type sparsely
 10. Test slicing - simple case
 11. Test slicing - extension
 12. Test slicing - extension, but without setting the slicing up
 12a. Test slicing - extension, but without setting the slicing up (one slice only)
 13. Test slicing - a complex case
 14. Test slicing see task 8742
 15. Test slicing - complex extensions with children
 16. Test slicing - extending a complex extension's children in derived profile
 17. Modifier Extension
 18. Modifier Extension, but without setting the slicing up
 19. Modifier Extension, but without setting the slicing up (one slice only)
 20. Slicing a backbone element 
 21. Slicing a backbone element on it's nested use
 22. Test slicing - Constrain base element before slicing
 23. Test slicing - Unsorted differential
 24. Test slicing - Constrain base element before slicing when slices were already defined - backbone
 25. Test slicing - Constrain base element before slicing when slices were already defined - datatypes
 26. Test differential sorting for polymorphic references
 27. Walking into a type for Contract
 28. Test children of a polymorphic type
 29. Test recursion on elements that are deeper than children of the root and have a different name (Parameters.parameter.part)
 30. Profile and derived profile both slice a backbone element
 31. Propagate extensions from differential to snapshot
 32. Disappearing slicing
 33. Type re-use
 34. Referencing a custom extension
 35. Referencing a profiled custom extension
 36. Deep recursion
-->
  <contained>
    <StructureDefinition>
      <id value="t1"/>
      <url value="urn:uuid:c7e52962-c322-4417-bd95-fb0dfc40fd62"/>
      <name value="t1"/>
      <status value="draft"/>
      <description value="fixture for #1: no change in the differential"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t2"/>
      <url value="urn:uuid:4b8c9c27-9d93-4f66-84f1-c7ca98687792"/>
      <name value="t2"/>
      <status value="draft"/>
      <description value="fixture for #2: no change in the differential, but a value set"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="ValueSet"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/ValueSet"/>
      <derivation value="constraint"/>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t3"/>
      <url value="urn:uuid:b3f56cfa-98a3-422c-9584-738e09881ac9"/>
      <name value="t3"/>
      <status value="draft"/>
      <description value="fixture for #3: change a cardinality"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient.identifier"/>
          <min value="1"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t4"/>
      <url value="urn:uuid:71e0a5a6-95bf-4e04-aa6a-4af0ebef3f29"/>
      <name value="t4"/>
      <status value="draft"/>
      <description value="fixture for #4: test appending documentation"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient.identifier"/>
          <definition value="... some more doco"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t5"/>
      <url value="urn:uuid:5dfe34b3-58ed-43bd-a677-1612246a8f1b"/>
      <name value="t5"/>
      <status value="draft"/>
      <description value="fixture for #5: type narrowing #1"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient.deceased[x]"/>
          <type>
            <code value="dateTime"/>
          </type>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t6"/>
      <url value="urn:uuid:977f7fee-448e-4090-8c3a-441b3b3cca7a"/>
      <name value="t6"/>
      <status value="draft"/>
      <description value="fixture for #6: type narrowing #2 - this renames  the type element"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient.deceasedDateTime"/>
          <type>
            <code value="dateTime"/>
          </type>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t7"/>
      <url value="urn:uuid:7a1d096b-bb61-40f7-880a-8cc4ba0329b9"/>
      <name value="t7"/>
      <status value="draft"/>
      <description value="fixture for #7: type mapping resolution"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient.identifier"/>
          <mapping>
            <identity value="rim"/>
            <map value="test"/>
          </mapping>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t8"/>
      <url value="urn:uuid:d2cb3b87-8f73-46fd-821c-cf39f0512757"/>
      <name value="t8"/>
      <status value="draft"/>
      <description value="fixture for #8: walking into a type"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient.identifier"/>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Patient.identifier.system"/>
          <mustSupport value="true"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t9"/>
      <url value="urn:uuid:d03a45b9-fc35-43c8-9f93-890487cf7076"/>
      <name value="t9"/>
      <status value="draft"/>
      <description value="fixture for #9: walking into a type (sparsely)"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient.identifier.system"/>
          <mustSupport value="true"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t10"/>
      <url value="urn:uuid:772b9182-39d3-45fd-b01c-e09df0a5cf6c"/>
      <name value="t10"/>
      <status value="draft"/>
      <description value="fixture for #10: Simple slicing"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient.identifier"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="use"/>
            </discriminator>
            <ordered value="false"/>
            <rules value="open"/>
          </slicing>
        </element>
        <element>
          <path value="Patient.identifier"/>
          <sliceName value="name1"/>
        </element>
        <element>
          <path value="Patient.identifier.use"/>
          <fixedCode value="usual"/>
        </element>
        <element>
          <path value="Patient.identifier"/>
          <sliceName value="name2"/>
        </element>
        <element>
          <path value="Patient.identifier.use"/>
          <fixedCode value="official"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t11"/>
      <url value="urn:uuid:f119d7d3-81e3-4432-8c68-11baafa5f986"/>
      <name value="t11"/>
      <status value="draft"/>
      <description value="fixture for #11: slicing on extensions"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient.extension"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="url"/>
            </discriminator>
            <ordered value="false"/>
            <rules value="open"/>
          </slicing>
          <max value="3"/>
        </element>
        <element>
          <path value="Patient.extension"/>
          <sliceName value="name1"/>
          <min value="1"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/patient-birthTime"/>
          </type>
        </element>
        <element>
          <path value="Patient.extension"/>
          <sliceName value="name2"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/patient-mothersMaidenName"/>
          </type>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t12"/>
      <url value="urn:uuid:01e790b6-b67b-4173-9b2b-31a0fb8c3180"/>
      <name value="t12"/>
      <status value="draft"/>
      <description value="fixture for #12: slicing on extensions, no set up of slicing"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient.extension"/>
          <sliceName value="name1"/>
          <min value="1"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/patient-birthTime"/>
          </type>
        </element>
        <element>
          <path value="Patient.extension"/>
          <sliceName value="name2"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/patient-mothersMaidenName"/>
          </type>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t12a"/>
      <url value="urn:uuid:37c463da-eac0-4b17-b15d-a3e524d9ebdf"/>
      <name value="t12a"/>
      <status value="draft"/>
      <description value="fixture for #12a: slicing on extensions, no set up of slicing, single slice"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient.extension"/>
          <sliceName value="name1"/>
          <min value="1"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/patient-birthTime"/>
          </type>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t13"/>
      <url value="urn:uuid:4f21d695-b60f-4c4f-8412-15d12d18fa5e"/>
      <name value="t13"/>
      <status value="draft"/>
      <description value="fixture for #13: complex slicing"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient.extension"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="url"/>
            </discriminator>
            <ordered value="false"/>
            <rules value="open"/>
          </slicing>
        </element>
        <element>
          <path value="Patient.extension"/>
          <sliceName value="t"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/patient-birthTime"/>
          </type>
        </element>
        <element>
          <path value="Patient.extension"/>
          <sliceName value="complex"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/patient-nationality"/>
          </type>
        </element>
        <element>
          <path value="Patient.extension.extension"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="url"/>
            </discriminator>
            <ordered value="false"/>
            <rules value="open"/>
          </slicing>
        </element>
        <element>
          <path value="Patient.extension.extension"/>
          <sliceName value="code"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/patient-nationality#code"/>
          </type>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Patient.extension.extension"/>
          <sliceName value="period"/>
          <max value="0"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/patient-nationality#period"/>
          </type>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t14"/>
      <url value="urn:uuid:17a816a1-0196-4eb4-86c3-2f6e05944598"/>
      <name value="t14"/>
      <status value="draft"/>
      <description value="fixture for #14: see task 8742"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Organization"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Organization.address"/>
          <min value="1"/>
          <max value="1"/>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Organization.address.extension"/>
          <sliceName value="USLabCountycodes"/>
          <short value="County/Parish FIPS codes"/>
          <definition value="County/Parish FIPS codes"/>
          <requirements value="County/Parish Code SHALL use FIPS 6-4  ( INCITS 31:2009)."/>
          <min value="1"/>
          <max value="1"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/us-core-county"/>
          </type>
          <mustSupport value="true"/>
          <binding>
            <strength value="required"/>
            <description value="FIPS codes for US counties and county equivalent entities."/>
            <valueSet value="http://hl7.org/fhir/ValueSet/fips-county"/>
          </binding>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t15"/>
      <url value="urn:uuid:78efa570-6e30-410d-ac5a-16ea423d13d4"/>
      <name value="t15"/>
      <status value="draft"/>
      <description value="fixture for #15: complex extensions with children"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient.address"/>
        </element>
        <element>
          <path value="Patient.address.extension"/>
          <sliceName value="Geolocation"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/geolocation"/>
          </type>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Patient.address.extension.extension"/>
          <sliceName value="latitude"/>
          <type>
            <code value="Extension"/>
            <profile value="latitude"/>
          </type>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Patient.address.extension.extension.valueDecimal"/>
          <mustSupport value="true"/>
        </element>
        <!-- Commented this out as removing it triggers errors that including it did not (specifically, the URL of the geolocation extension wasn't showing up in snapshot)
				<element>
					<path value="Patient.address.extension.extension"/>
					<sliceName value="longitude"/>
					<type>
            <code value="Extension"/>
            <profile value="longitude"/>
          </type>
          <mustSupport value="true"/>
				</element>
				<element>
					<path value="Patient.address.extension.extension.valueDecimal"/>
          <mustSupport value="true"/>
				</element>-->
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t16"/>
      <url value="urn:uuid:b94f9d67-5ad1-44df-850d-33a933800f40"/>
      <name value="t16"/>
      <status value="draft"/>
      <description value="fixture for #16: extending a complex extension's children in derived profile"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <!-- Building on #15 -->
      <baseDefinition value="urn:uuid:78efa570-6e30-410d-ac5a-16ea423d13d4"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient.address.extension"/>
          <sliceName value="Geolocation"/>
        </element>
        <element>
          <path value="Patient.address.extension.extension"/>
          <sliceName value="latitude"/>
        </element>
        <element>
          <path value="Patient.address.extension.extension.valueDecimal.extension"/>
          <sliceName value="Geolocation.latitude.rendered"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/rendered-value"/>
          </type>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Patient.address.extension.extension.valueDecimal.extension.valueString"/>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Patient.address.extension.extension"/>
          <sliceName value="longitude"/>
        </element>
        <element>
          <path value="Patient.address.extension.extension.valueDecimal.extension"/>
          <sliceName value="Geolocation.longitude.rendered"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/rendered-value"/>
          </type>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Patient.address.extension.extension.valueDecimal.extension.valueString"/>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Patient.address.extension"/>
          <sliceName value="ISO-AddressUse"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/iso21090-AD-use"/>
          </type>
          <mustSupport value="true"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t17"/>
      <url value="urn:uuid:1313b735-ddb1-4bd4-aa8e-a3156d2919a8"/>
      <name value="t17"/>
      <status value="draft"/>
      <description value="fixture for #17: use a modifier extension instead"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient.modifierExtension"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="url"/>
            </discriminator>
            <ordered value="false"/>
            <rules value="open"/>
          </slicing>
          <max value="3"/>
        </element>
        <!-- actually these aren't valid as modifer extensions, but the snapshot generator doesn't check that -->
        <element>
          <path value="Patient.modifierExtension"/>
          <sliceName value="name1"/>
          <min value="1"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/patient-birthTime"/>
          </type>
        </element>
        <element>
          <path value="Patient.modifierExtension"/>
          <sliceName value="name2"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/patient-mothersMaidenName"/>
          </type>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t18"/>
      <url value="urn:uuid:14b4442c-ef9f-4630-bb44-681b65f758ac"/>
      <name value="t18"/>
      <status value="draft"/>
      <description value="fixture for #18: use a modifier extension, with no set up"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <!-- these aren't valid as modifer extensions, but the snapshot generator doesn't check that -->
        <element>
          <path value="Patient.modifierExtension"/>
          <sliceName value="name1"/>
          <min value="1"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/patient-birthTime"/>
          </type>
        </element>
        <element>
          <path value="Patient.modifierExtension"/>
          <sliceName value="name2"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/patient-mothersMaidenName"/>
          </type>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t19"/>
      <url value="urn:uuid:6d245aa4-fa65-44e7-8177-cb15b09854f4"/>
      <name value="t19"/>
      <status value="draft"/>
      <description value="fixture for #19: use a modifier extension, with no set up, and only one slice"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient.modifierExtension"/>
          <sliceName value="name1"/>
          <min value="1"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/patient-birthTime"/>
          </type>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t20"/>
      <url value="urn:uuid:29645106-1e27-4820-996c-d48c1e932329"/>
      <name value="t20"/>
      <status value="draft"/>
      <description value="fixture for #20: Slicing a backbone element"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="PlanDefinition"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/PlanDefinition"/>
      <derivation value="constraint"/>
      <differential>
        <element id="PlanDefinition:ordertemplate">
          <path value="PlanDefinition"/>
        </element>
        <element id="PlanDefinition:ordertemplate.action">
          <path value="PlanDefinition.action"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="prefix"/>
            </discriminator>
            <rules value="open"/>
          </slicing>
          <min value="1"/>
          <max value="*"/>
        </element>
        <element id="PlanDefinition:ordertemplate.action:subtask1">
          <path value="PlanDefinition.action"/>
          <sliceName value="subtask1"/>
          <min value="0"/>
          <max value="1"/>
        </element>
        <element id="PlanDefinition:ordertemplate.action:subtask1.prefix">
          <path value="PlanDefinition.action.prefix"/>
          <min value="1"/>
          <max value="1"/>
          <type>
            <code value="string"/>
          </type>
          <fixedString value="slice1"/>
        </element>
        <element id="PlanDefinition:ordertemplate.action:subtask2">
          <path value="PlanDefinition.action"/>
          <sliceName value="subtask2"/>
          <min value="0"/>
          <max value="1"/>
        </element>
        <element id="PlanDefinition:ordertemplate.action:subtask2.prefix">
          <path value="PlanDefinition.action.prefix"/>
          <min value="1"/>
          <max value="1"/>
          <type>
            <code value="string"/>
          </type>
          <fixedString value="slice2"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t21"/>
      <url value="urn:uuid:ea08f7c0-97f2-44bb-8ef5-f36d9e53148c"/>
      <name value="t21"/>
      <status value="draft"/>
      <description value="fixture for #21: Slicing a backbone element on it's nested use"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="PlanDefinition"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/PlanDefinition"/>
      <derivation value="constraint"/>
      <differential>
        <element id="PlanDefinition:ordertemplate">
          <path value="PlanDefinition"/>
        </element>
        <element id="PlanDefinition:ordertemplate.action.action">
          <path value="PlanDefinition.action.action"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="prefix"/>
            </discriminator>
            <rules value="open"/>
          </slicing>
          <min value="1"/>
          <max value="*"/>
        </element>
        <element id="PlanDefinition:ordertemplate.action.action:subtask1">
          <path value="PlanDefinition.action.action"/>
          <sliceName value="subtask1"/>
          <min value="0"/>
          <max value="1"/>
        </element>
        <element id="PlanDefinition:ordertemplate.action.action:subtask1.prefix">
          <path value="PlanDefinition.action.action.prefix"/>
          <min value="1"/>
          <max value="1"/>
          <type>
            <code value="string"/>
          </type>
          <fixedString value="slice1"/>
        </element>
        <element id="PlanDefinition:ordertemplate.action.action:subtask2">
          <path value="PlanDefinition.action.action"/>
          <sliceName value="subtask2"/>
          <min value="0"/>
          <max value="1"/>
        </element>
        <element id="PlanDefinition:ordertemplate.action.action:subtask2.prefix">
          <path value="PlanDefinition.action.action.prefix"/>
          <min value="1"/>
          <max value="1"/>
          <type>
            <code value="string"/>
          </type>
          <fixedString value="slice2"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t22"/>
      <url value="urn:uuid:a690d8bf-7b93-4785-b5d7-74bc3452a24b"/>
      <name value="t22"/>
      <status value="draft"/>
      <description value="fixture for #22: Constrain base element before slicing"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient.identifier"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="type.coding.code"/>
            </discriminator>
            <rules value="open"/>
          </slicing>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Patient.identifier.extension"/>
          <sliceName value="validDate"/>
          <max value="1"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/identifier-validDate"/>
          </type>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Patient.identifier.type"/>
          <min value="1"/>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Patient.identifier.type.coding"/>
          <min value="1"/>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Patient.identifier.type.coding.system"/>
          <min value="1"/>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Patient.identifier.type.coding.code"/>
          <min value="1"/>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Patient.identifier.system"/>
          <min value="1"/>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Patient.identifier.value"/>
          <min value="1"/>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Patient.identifier"/>
          <sliceName value="MRN"/>
          <min value="1"/>
          <max value="1"/>
        </element>
        <element>
          <path value="Patient.identifier.extension"/>
          <sliceName value="validDate"/>
          <min value="1"/>
        </element>
        <element>
          <path value="Patient.identifier.type"/>
        </element>
        <element>
          <path value="Patient.identifier.type.coding"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="system"/>
            </discriminator>
            <rules value="open"/>
          </slicing>
        </element>
        <element>
          <path value="Patient.identifier.type.coding"/>
          <sliceName value="preferredCoding"/>
        </element>
        <element>
          <path value="Patient.identifier.type.coding.system"/>
          <fixedUri value="http://hl7.org/fhir/v2/0203"/>
        </element>
        <element>
          <path value="Patient.identifier.type.coding.code"/>
          <fixedCode value="MR"/>
        </element>
        <element>
          <path value="Patient.identifier"/>
          <sliceName value="JHN"/>
          <min value="1"/>
          <max value="1"/>
        </element>
        <element>
          <path value="Patient.identifier.extension"/>
          <sliceName value="validDate"/>
          <max value="0"/>
        </element>
        <element>
          <path value="Patient.identifier.type"/>
        </element>
        <element>
          <path value="Patient.identifier.type.coding"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="system"/>
            </discriminator>
            <rules value="open"/>
          </slicing>
        </element>
        <element>
          <path value="Patient.identifier.type.coding"/>
          <sliceName value="preferredCoding"/>
        </element>
        <element>
          <path value="Patient.identifier.type.coding.system"/>
          <fixedUri value="http://hl7.org/fhir/v2/0203"/>
        </element>
        <element>
          <path value="Patient.identifier.type.coding.code"/>
          <fixedCode value="JHN"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t23"/>
      <url value="urn:uuid:2e28117d-bb6f-4d8e-9ccd-5472535cc2d6"/>
      <name value="t23"/>
      <status value="draft"/>
      <description value="fixture for #23: Test Slicing - unsorted differential"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient"/>
        </element>
        <element>
          <path value="Patient.contact"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="gender"/>
            </discriminator>
            <rules value="open"/>
          </slicing>
        </element>
        <element>
          <path value="Patient.contact"/>
          <sliceName value="males"/>
        </element>
        <element>
          <path value="Patient.contact.gender"/>
          <fixedCode value="male"/>
        </element>
        <element>
          <path value="Patient.contact.telecom"/>
          <min value="1"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t24a"/>
      <url value="urn:uuid:5eac3230-a289-4662-a296-2b673d6d3293"/>
      <name value="t24a"/>
      <status value="draft"/>
      <description value="fixture for #24a: Constrain base element before slicing when slices were already defined - backbone"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient"/>
        </element>
        <element>
          <path value="Patient.contact"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="gender"/>
            </discriminator>
            <rules value="open"/>
          </slicing>
        </element>
        <element>
          <path value="Patient.contact"/>
          <sliceName value="males"/>
        </element>
        <element>
          <path value="Patient.contact.telecom"/>
          <min value="1"/>
        </element>
        <element>
          <path value="Patient.contact.gender"/>
          <fixedCode value="male"/>
        </element>
        <element>
          <path value="Patient.contact"/>
          <sliceName value="females"/>
        </element>
        <element>
          <path value="Patient.contact.telecom"/>
          <max value="0"/>
        </element>
        <element>
          <path value="Patient.contact.gender"/>
          <fixedCode value="female"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t24b"/>
      <url value="urn:uuid:6a446a41-a552-4391-babc-db4caee2d987"/>
      <name value="t24b"/>
      <status value="draft"/>
      <description value="fixture for #24b: Constrain base element before slicing when slices were already defined - backbone"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <!-- baseDefinition = t24a -->
      <baseDefinition value="urn:uuid:5eac3230-a289-4662-a296-2b673d6d3293"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient"/>
        </element>
        <element>
          <path value="Patient.contact"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="gender"/>
            </discriminator>
            <rules value="open"/>
          </slicing>
        </element>
        <element>
          <path value="Patient.contact.name"/>
          <min value="1"/>
        </element>
        <element>
          <path value="Patient.contact"/>
          <sliceName value="males"/>
        </element>
        <element>
          <path value="Patient.contact.name"/>
          <min value="1"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t25a"/>
      <url value="urn:uuid:ec0e207d-39e1-46ad-a10f-262029008feb"/>
      <name value="t25a"/>
      <status value="draft"/>
      <description value="fixture for #25a: Constrain base element before slicing when slices were already defined - data type"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient"/>
        </element>
        <element>
          <path value="Patient.name"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="use"/>
            </discriminator>
            <rules value="open"/>
          </slicing>
        </element>
        <element>
          <path value="Patient.name"/>
          <sliceName value="official"/>
        </element>
        <element>
          <path value="Patient.name.use"/>
          <fixedCode value="official"/>
        </element>
        <element>
          <path value="Patient.name.given"/>
          <min value="1"/>
        </element>
        <element>
          <path value="Patient.name"/>
          <sliceName value="usual"/>
        </element>
        <element>
          <path value="Patient.name.use"/>
          <fixedCode value="usual"/>
        </element>
        <element>
          <path value="Patient.name.given"/>
          <max value="0"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t25b"/>
      <url value="urn:uuid:729ce066-281e-48da-b2b7-866c0cf50241"/>
      <name value="t25b"/>
      <status value="draft"/>
      <description value="fixture for #25b: Constrain base element before slicing when slices were already defined - data type"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <!-- baseDefinition = t25b -->
      <baseDefinition value="urn:uuid:ec0e207d-39e1-46ad-a10f-262029008feb"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient"/>
        </element>
        <element>
          <path value="Patient.name"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="use"/>
            </discriminator>
            <rules value="open"/>
          </slicing>
        </element>
        <element>
          <path value="Patient.name.family"/>
          <min value="1"/>
        </element>
        <element>
          <path value="Patient.name"/>
          <sliceName value="official"/>
        </element>
        <element>
          <path value="Patient.name.prefix"/>
          <min value="1"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t26"/>
      <url value="urn:uuid:ab833682-88b9-4e7a-8e08-eb82f39f7beb"/>
      <name value="t26"/>
      <status value="draft"/>
      <description value="fixture for #26: Test differential sorting for polymorphic references"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Patient"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Patient"/>
        </element>
        <element>
          <path value="Patient.generalPractitioner"/>
          <slicing>
            <discriminator>
              <type value="exists"/>
              <path value="display"/>
            </discriminator>
            <rules value="open"/>
          </slicing>
          <!-- These could be references to other profiles rather than just to the base resources, but no need for that to test the tooling -->
          <type>
            <code value="Reference"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/Practitioner"/>
          </type>
          <type>
            <code value="Reference"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/Organization"/>
          </type>
        </element>
        <element>
          <path value="Patient.generalPractitioner"/>
          <sliceName value="sliceA"/>
        </element>
        <element>
          <path value="Patient.generalPractitioner.display"/>
          <min value="1"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t27"/>
      <url value="urn:uuid:d2cb3b87-8f73-46fd-821c-cf39f0432757"/>
      <name value="t27"/>
      <status value="draft"/>
      <description value="fixture for #27: walking into a type for Contract"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Contract"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Contract"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Contract"/>
        </element>
        <element>
          <path value="Contract.type"/>
          <label value="Consent"/>
          <short value="Consent"/>
          <definition value="SHALL contain exactly one [1..1] type=&quot;CONS&quot; (CodeSystem: HL7ActClass urn:oid:2.16.840.1.113883.5.6) (CONF:2219-2008)."/>
          <min value="1"/>
          <max value="1"/>
        </element>
        <element>
          <path value="Contract.type.coding.system"/>
          <patternCode value="urn:oid:2.16.840.1.113883.5.6"/>
        </element>
        <element>
          <path value="Contract.type.coding.code"/>
          <patternCode value="CONS"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t28"/>
      <url value="urn:uuid:7c3e3bd7-7919-4348-bed7-a65af1690842"/>
      <name value="t28"/>
      <status value="draft"/>
      <description value="fixture for #28: Test children of a polymorphic type"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="OperationOutcome"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/OperationOutcome"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="OperationOutcome"/>
        </element>
        <element>
          <path value="OperationOutcome.issue"/>
        </element>
        <element>
          <path value="OperationOutcome.issue.details"/>
        </element>
        <element>
          <path value="OperationOutcome.issue.details.text"/>
        </element>
        <element>
          <path value="OperationOutcome.issue.details.text.extension"/>
          <sliceName value="translation"/>
          <type>
            <code value="Extension"/>
            <targetProfile value="http://hl7.org/fhir/StructureDefinition/iso21090-ST-translation"/>
          </type>
        </element>
        <element>
          <path value="OperationOutcome.issue.details.text.extension.valueString"/>
          <!--          <type>
            <code value="string"/>
          </type>-->
        </element>
        <element>
          <path value="OperationOutcome.issue.details.text.extension.valueString.extension"/>
          <sliceName value="language"/>
          <type>
            <code value="Extension"/>
            <targetProfile value="http://hl7.org/fhir/StructureDefinition/iso21090-ST-language"/>
          </type>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t29"/>
      <url value="urn:uuid:8371f159-76b3-41f7-a66f-bde129e7e603"/>
      <name value="t29"/>
      <status value="draft"/>
      <description value="fixture for #29: Test recursion on elements that are deeper than children of the root and have a different name (Parameters.parameter.part)"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="OperationOutcome"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Parameters"/>
      <derivation value="constraint"/>
      <differential>
        <element>
          <path value="Parameters"/>
        </element>
        <element>
          <path value="Parameters.parameter"/>
        </element>
        <element>
          <path value="Parameters.parameter.part"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="name"/>
            </discriminator>
            <rules value="closed"/>
          </slicing>
        </element>
        <element>
          <path value="Parameters.parameter.part"/>
          <sliceName value="foo"/>
          <min value="1"/>
          <max value="1"/>
        </element>
        <element>
          <path value="Parameters.parameter.part.name"/>
          <fixedString value="foo"/>
          <mustSupport value="true"/>
        </element>
        <element>
          <path value="Parameters.parameter.part.valueCoding"/>
          <min value="1"/>
          <type>
            <code value="Coding"/>
          </type>
        </element>
        <element>
          <path value="Parameters.parameter.part.valueCoding.code"/>
          <min value="1"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t30a"/>
      <url value="urn:uuid:149505c1-a51b-4378-9d31-d14dd62f18e6"/>
      <name value="t30a"/>
      <status value="draft"/>
      <description value="fixture for #30: Profile and derived profile both slice a backbone element; base profile"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Observation"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Observation"/>
      <derivation value="constraint"/>
      <differential>
        <element id="Observation">
          <path value="Observation"/>
        </element>
        <element id="Observation.component">
          <path value="Observation.component"/>
          <slicing>
            <discriminator>
              <type value="pattern"/>
              <path value="code"/>
            </discriminator>
            <rules value="open"/>
          </slicing>
        </element>
        <element id="Observation.component:gene-studied">
          <path value="Observation.component"/>
          <sliceName value="gene-studied"/>
          <max value="1"/>
        </element>
        <element id="Observation.component:gene-studied.code">
          <path value="Observation.component.code"/>
          <min value="1"/>
          <type>
            <code value="CodeableConcept"/>
          </type>
          <patternCodeableConcept>
            <coding>
              <system value="http://loinc.org"/>
              <code value="48018-6"/>
            </coding>
          </patternCodeableConcept>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t30b"/>
      <url value="urn:uuid:d144e878-9445-42cd-9e5c-28e4d8072a20"/>
      <name value="t30b"/>
      <status value="draft"/>
      <description value="Profile and derived profile both slice a backbone element; derived profile"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Observation"/>
      <baseDefinition value="urn:uuid:149505c1-a51b-4378-9d31-d14dd62f18e6"/>
      <derivation value="constraint"/>
      <differential>
        <element id="Observation">
          <path value="Observation"/>
        </element>
        <element id="Observation.component:allelic-frequency">
          <path value="Observation.component"/>
          <sliceName value="allelic-frequency"/>
          <max value="1"/>
        </element>
        <element id="Observation.component:allelic-frequency.code">
          <path value="Observation.component.code"/>
          <min value="1"/>
          <type>
            <code value="CodeableConcept"/>
          </type>
          <patternCodeableConcept>
            <coding>
              <system value="http://loinc.org"/>
              <code value="81258-6"/>
            </coding>
          </patternCodeableConcept>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t31"/>
      <url value="urn:uuid:e9d11ae4-b7be-40c2-9c19-c9a1c4861428"/>
      <name value="t31"/>
      <status value="draft"/>
      <description value="fixture for #31: Propagate extensions from differential to snapshot"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Parameters"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Parameters"/>
      <derivation value="constraint"/>
      <differential>
        <element id="Parameters">
          <path value="Parameters"/>
        </element>
        <element id="Parameters.parameter">
          <path value="Parameters.parameter"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="name"/>
            </discriminator>
            <rules value="open"/>
          </slicing>
        </element>
        <element id="Parameters.parameter:string">
          <path value="Parameters.parameter"/>
          <sliceName value="string"/>
        </element>
        <element id="Parameters.parameter:string.name">
          <path value="Parameters.parameter.name"/>
          <fixedString value="string"/>
        </element>
        <element id="Parameters.parameter:string.valueString">
          <extension url="http://hl7.org/fhir/StructureDefinition/regex">
            <valueString value="(a)*"/>
          </extension>
          <path value="Parameters.parameter.valueString"/>
          <type>
            <code value="string"/>
          </type>
          <maxLength value="2"/>
        </element>
        <element id="Parameters.parameter:string.valueString.extension:translation">
          <path value="Parameters.parameter.valueString.extension"/>
          <sliceName value="translation"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/translation"/>
          </type>
        </element>
        <element id="Parameters.parameter:string.valueString.extension:translation.extension:content">
          <path value="Parameters.parameter.valueString.extension.extension"/>
          <sliceName value="content"/>
        </element>
        <element id="Parameters.parameter:string.valueString.extension:translation.extension:content.valueString">
          <extension url="http://hl7.org/fhir/StructureDefinition/regex">
            <valueString value="(b)*"/>
          </extension>
          <path value="Parameters.parameter.valueString.extension.extension.valueString"/>
          <sliceName value="content"/>
          <maxLength value="2"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t32"/>
      <url value="urn:uuid:d4cbb68a-8c76-43a8-b0f1-854d24f881dc"/>
      <name value="t32"/>
      <status value="draft"/>
      <description value="fixture for #32: Test disappearing slice definition"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Questionnaire"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Questionnaire"/>
      <derivation value="constraint"/>
      <differential>
        <element id="Questionnaire">
          <path value="Questionnaire"/>
        </element>
        <element id="Questionnaire.item">
          <path value="Questionnaire.item"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="linkId"/>
            </discriminator>
            <rules value="open"/>
          </slicing>
        </element>
        <element id="Questionnaire.item.linkId">
          <path value="Questionnaire.item.linkId"/>
          <mustSupport value="true"/>
        </element>
        <element id="Questionnaire.item">
          <path value="Questionnaire.item"/>
          <sliceName value="record-type"/>
        </element>
        <element id="Questionnaire.item:record-type.linkId">
          <path value="Questionnaire.item.linkId"/>
          <fixedString value="record-type"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t33"/>
      <url value="urn:uuid:75055c57-8e5d-4c0a-ab22-43371571f724"/>
      <name value="t33"/>
      <status value="draft"/>
      <description value="fixture for #33: Test disappearing slice definition"/>
      <fhirVersion value="3.0.1"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="ExplanationOfBenefit"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/ExplanationOfBenefit"/>
      <derivation value="constraint"/>
      <differential>
        <element id="ExplanationOfBenefit.addItem">
          <path value="ExplanationOfBenefit.addItem"/>
          <mustSupport value="true"/>
        </element>
        <element id="ExplanationOfBenefit.addItem.adjudication">
          <path value="ExplanationOfBenefit.addItem.adjudication"/>
        </element>
        <element id="ExplanationOfBenefit.addItem.adjudication.extension">
          <path value="ExplanationOfBenefit.addItem.adjudication.extension"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="url"/>
            </discriminator>
            <rules value="open"/>
          </slicing>
        </element>
        <element id="ExplanationOfBenefit.addItem.adjudication.extension:someExt">
          <path value="ExplanationOfBenefit.addItem.adjudication.extension"/>
          <sliceName value="someExt"/>
          <type>
            <code value="Extension"/>
            <profile value="http://hl7.org/fhir/StructureDefinition/data-absent-reason"/>
          </type>
          <mustSupport value="true"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <!-- extension definition for test 34 -->
    <StructureDefinition xmlns="http://hl7.org/fhir">
      <id value="extension-identifier-status"/>
      <url value="http://www.fhir.org/guides/test3/StructureDefinition/extension-identifier-status"/>
      <name value="IdentifierStatus"/>
      <title value="VhDir Identifier Status"/>
      <status value="draft"/>
      <kind value="complex-type"/>
      <abstract value="false"/>
      <context>
        <type value="element"/>
        <expression value="Identifier"/>
      </context>
      <type value="Extension"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Extension"/>
      <derivation value="constraint"/>
      <differential>
        <element id="Extension">
          <path value="Extension"/>
          <short value="Status"/>
          <max value="1"/>
          <isModifier value="false"/>
        </element>
        <element id="Extension.url">
          <path value="Extension.url"/>
          <fixedUri value="http://www.fhir.org/guides/test3/StructureDefinition/extension-identifier-status"/>
        </element>
        <element id="Extension.valueCode">
          <path value="Extension.valueCode"/>
          <label value="status"/>
          <short value="active|inactive|issued in error|revoked|pending"/>
          <definition value="Describes the status of an identifier"/>
          <min value="1"/>
          <type>
            <code value="code"/>
          </type>
          <binding>
            <strength value="preferred"/>
            <valueSet value="http://www.fhir.org/guides/test3/ValueSet/blah-codes"/>
          </binding>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t34"/>
      <url value="urn:uuid:0fefeab4-abd9-4ea6-b9c7-8a07a04f600c"/>
      <name value="t34"/>
      <status value="draft"/>
      <description value="fixture for #34: Referencing a custom extension"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Basic"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Basic"/>
      <derivation value="constraint"/>
      <differential>
        <element id="Basic">
          <path value="Basic"/>
        </element>
        <element id="Basic.identifier">
          <path value="Basic.identifier"/>
          <min value="1"/>
          <max value="1"/>
          <type>
            <code value="Identifier"/>
          </type>
          <mustSupport value="true"/>
          <isModifier value="false"/>
        </element>
        <element id="Basic.identifier.extension:foo">
          <path value="Basic.identifier.extension"/>
          <sliceName value="foo"/>
          <min value="1"/>
          <max value="1"/>
          <type>
            <code value="Extension"/>
            <profile value="http://www.fhir.org/guides/test3/StructureDefinition/extension-identifier-status"/>
          </type>
          <mustSupport value="true"/>
          <isModifier value="false"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <!-- extension definition for test 35 - a profile on an existing extension -->
    <StructureDefinition xmlns="http://hl7.org/fhir">
      <id value="extension-identifier-status2"/>
      <url value="http://www.fhir.org/guides/test3/StructureDefinition/extension-identifier-statu2"/>
      <name value="IdentifierStatus"/>
      <title value="VhDir Identifier Status"/>
      <status value="draft"/>
      <kind value="complex-type"/>
      <abstract value="false"/>
      <context>
        <type value="element"/>
        <expression value="Identifier"/>
      </context>
      <type value="Extension"/>
      <baseDefinition value="http://www.fhir.org/guides/test3/StructureDefinition/extension-identifier-status"/>
      <derivation value="constraint"/>
      <differential>
        <element id="Extension">
          <path value="Extension"/>
          <short value="Status"/>
          <max value="1"/>
          <isModifier value="false"/>
        </element>
        <element id="Extension.valueCode">
          <path value="Extension.valueCode"/>
          <binding>
            <strength value="required"/>
            <valueSet value="http://www.fhir.org/guides/test3/ValueSet/blah-codes"/>
          </binding>
        </element>
      </differential>
    </StructureDefinition>
  </contained>  
  <contained>
    <StructureDefinition>
      <id value="t35"/>
      <url value="urn:uuid:b22b108f-20f0-4a9e-8bb6-3a8041c8b7b3"/>
      <name value="t35"/>
      <status value="draft"/>
      <description value="fixture for #35: Referencing a profiled custom extension"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="Basic"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Basic"/>
      <derivation value="constraint"/>
      <differential>
        <element id="Basic">
          <path value="Basic"/>
        </element>
        <element id="Basic.identifier">
          <path value="Basic.identifier"/>
          <min value="1"/>
          <max value="1"/>
          <type>
            <code value="Identifier"/>
          </type>
          <mustSupport value="true"/>
          <isModifier value="false"/>
        </element>
        <element id="Basic.identifier.extension:foo">
          <path value="Basic.identifier.extension"/>
          <sliceName value="foo"/>
          <min value="1"/>
          <max value="1"/>
          <type>
            <code value="Extension"/>
            <profile value="http://www.fhir.org/guides/test3/StructureDefinition/extension-identifier-statu2"/>
          </type>
          <mustSupport value="true"/>
          <isModifier value="false"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <contained>
    <StructureDefinition>
      <id value="t36"/>
      <url value="urn:uuid:428d7c25-e55f-42b4-a93e-83cef54421d7"/>
      <name value="t36"/>
      <status value="draft"/>
      <description value="fixture for #36: Deep Recursion"/>
      <kind value="resource"/>
      <abstract value="false"/>
      <type value="PlanDefinition"/>
      <baseDefinition value="http://hl7.org/fhir/StructureDefinition/PlanDefinition"/>
      <derivation value="constraint"/>
      <differential>
        <element id="PlanDefinition">
          <path value="PlanDefinition"/>
        </element>
        <element id="PlanDefinition.action">
          <path value="PlanDefinition.action"/>
        </element>
        <element id="PlanDefinition.action.action">
          <path value="PlanDefinition.action.action"/>
        </element>
        <element id="PlanDefinition.action.action.action">
          <path value="PlanDefinition.action.action.action"/>
        </element>
        <element id="PlanDefinition.action.action.action.action">
          <path value="PlanDefinition.action.action.action.action"/>
        </element>
        <element id="PlanDefinition.action.action.action.action.condition">
          <path value="PlanDefinition.action.action.action.action.condition"/>
          <slicing>
            <discriminator>
              <type value="value"/>
              <path value="kind"/>
            </discriminator>
            <rules value="open"/>
          </slicing>
        </element>
        <element id="PlanDefinition.action.action.action.action.condition:stopConditions">
          <path value="PlanDefinition.action.action.action.action.condition"/>
          <sliceName value="stopConditions"/>
        </element>
        <element id="PlanDefinition.action.action.action.action.condition:stopConditions:kind">
          <path value="PlanDefinition.action.action.action.action.condition.kind"/>
          <type>
            <code value="code"/>
          </type>
          <fixedCode value="stop"/>
        </element>
      </differential>
    </StructureDefinition>
  </contained>
  <url value="http://hl7.org/fhir/tests/snapshotgeneration"/>
  <name value="SnapshotGenerationTests"/>
  <title value="Snapshot generation test script"/>
  <status value="draft"/>
  <experimental value="false"/>
  <date value="2017-03-22"/>
  <publisher value="FHIR Project"/>
  <description value="These tests constitute the unit tests for snapshot generation"/>
  <fixture id="patient">
    <autocreate value="false"/>
    <autodelete value="false"/>
    <resource>
      <reference value="http://hl7.org/fhir/StructureDefinition/Patient"/>
    </resource>
  </fixture>
  <fixture id="valueset">
    <autocreate value="false"/>
    <autodelete value="false"/>
    <resource>
      <reference value="http://hl7.org/fhir/StructureDefinition/ValueSet"/>
    </resource>
  </fixture>
  <fixture id="organization">
    <autocreate value="false"/>
    <autodelete value="false"/>
    <resource>
      <reference value="http://hl7.org/fhir/StructureDefinition/Organization"/>
    </resource>
  </fixture>
  <fixture id="operationoutcome">
    <autocreate value="false"/>
    <autodelete value="false"/>
    <resource>
      <reference value="http://hl7.org/fhir/StructureDefinition/OperationOutcome"/>
    </resource>
  </fixture>
  <fixture id="parameters">
    <autocreate value="false"/>
    <autodelete value="false"/>
    <resource>
      <reference value="http://hl7.org/fhir/StructureDefinition/Parameters"/>
    </resource>
  </fixture>
  <test>
    <name value="Test1"/>
    <description value="an empty differential, generate the snapshot, and then insist it must match the base"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="true"/>
        <responseId value="t1o"/>
        <sourceId value="t1"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test1-1"/>
        <description value="The snapshot must have the same number of elements, in the same order, with matching paths"/>
        <direction value="response"/>
        <expression value="fixture('t1o').snapshot.element.select(path) = fixture('patient').snapshot.element.select(path)"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test1-2"/>
        <description value="The snapshot elements must be the same - check short description"/>
        <direction value="response"/>
        <expression value="fixture('t1o').snapshot.element.all(aliasAs('A').short = fixture('patient').snapshot.element.where(path = alias('A').path).short)"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test1-3"/>
        <description value="The snapshot elements must be the same - check min cardinality"/>
        <direction value="response"/>
        <expression value="fixture('t1o').snapshot.element.all(aliasAs('A').min = fixture('patient').snapshot.element.where(path = alias('A').path).min)"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test1-4"/>
        <description value="The snapshot elements must be the same - check max cardinality"/>
        <direction value="response"/>
        <expression value="fixture('t1o').snapshot.element.all(aliasAs('A').max = fixture('patient').snapshot.element.where(path = alias('A').path).max)"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test1-5"/>
        <description value="The snapshot elements must be the same - check binding"/>
        <direction value="response"/>
        <expression value="fixture('t1o').snapshot.element.all(aliasAs('A').binding.valueSet = fixture('patient').snapshot.element.where(path = alias('A').path).binding.valueSet)"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test2"/>
    <description value="an empty differential, generate the snapshot, and then insist it must match the base - use a resource with recusion"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t2o"/>
        <sourceId value="t2"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test2-1"/>
        <description value="The snapshot must have the same number of elements, in the same order, with matching paths"/>
        <direction value="response"/>
        <expression value="fixture('t2o').snapshot.element.select(path) = fixture('valueset').snapshot.element.select(path)"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test2-2"/>
        <description value="The snapshot elements must be the same"/>
        <direction value="response"/>
        <expression value="fixture('t2o').snapshot.element.all(aliasAs('A').short = fixture('valueset').snapshot.element.where(path = alias('A').path).short)"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test3"/>
    <description value="fix a cardinality"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t3o"/>
        <sourceId value="t3"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test3-1"/>
        <description value="The snapshot must have the same number of elements, in the same order, with matching paths"/>
        <direction value="response"/>
        <expression value="fixture('t3o').snapshot.element.select(path) = fixture('patient').snapshot.element.select(path)"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test3-2"/>
        <description value="The snapshot elements must be the same"/>
        <direction value="response"/>
        <expression value="fixture('t3o').snapshot.element.all(aliasAs('A').short = fixture('patient').snapshot.element.where(path = alias('A').path).short)"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test3-3"/>
        <description value="The patient.identifier cardinality must be right"/>
        <direction value="response"/>
        <expression value="fixture('t3o').snapshot.element.where(path = 'Patient.identifier').min = 1"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test4"/>
    <description value="fix a cardinality"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t4o"/>
        <sourceId value="t4"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test4-1"/>
        <description value="The patient.identifier documentation must be right"/>
        <direction value="response"/>
        <expression value="fixture('t4o').snapshot.element.where(path = 'Patient.identifier').doco != '... some more doco'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test5"/>
    <description value="fix a type"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t5o"/>
        <sourceId value="t5"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test5-1"/>
        <description value="The patient.deceased type must be right"/>
        <direction value="response"/>
        <expression value="fixture('t5o').snapshot.element.where(base.path = 'Patient.deceased[x]').type.code = 'dateTime'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test5-2"/>
        <description value="The patient.deceased type must be right"/>
        <direction value="response"/>
        <expression value="fixture('t5o').snapshot.element.where(base.path = 'Patient.deceased[x]').path = 'Patient.deceasedDateTime'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test6"/>
    <description value="fix a type (with renaming)"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t6o"/>
        <sourceId value="t6"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test6-1"/>
        <description value="The patient.deceased type must be right"/>
        <direction value="response"/>
        <expression value="fixture('t6o').snapshot.element.where(base.path = 'Patient.deceased[x]').type.code = 'dateTime'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test6-1"/>
        <description value="The patient.deceased type must be right"/>
        <direction value="response"/>
        <expression value="fixture('t6o').snapshot.element.where(base.path = 'Patient.deceased[x]').path = 'Patient.deceasedDateTime'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test7"/>
    <description value="test mapping resolution"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t7o"/>
        <sourceId value="t7"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test7-1"/>
        <description value="The mapping must be made"/>
        <direction value="response"/>
        <expression value="fixture('t7o').snapshot.element.where(base.path = 'Patient.identifier').mapping.count() = fixture('t1o').snapshot.element.where(base.path = 'Patient.identifier').mapping.count() + 1"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test8"/>
    <description value="test walking into a type"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t8o"/>
        <sourceId value="t8"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test8-1"/>
        <description value="Mustsupport must be true on Patient.identifier"/>
        <direction value="response"/>
        <expression value="fixture('t8o').snapshot.element.where(path = 'Patient.identifier').mustSupport"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test8-2"/>
        <description value="Mustsupport must be true on Patient.identifier.system"/>
        <direction value="response"/>
        <expression value="fixture('t8o').snapshot.element.where(path = 'Patient.identifier.system').mustSupport"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test9"/>
    <description value="test walking into a type (sparsely)"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t9o"/>
        <sourceId value="t9"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test9-1"/>
        <description value="Mustsupport must be true on Patient.identifier"/>
        <direction value="response"/>
        <expression value="fixture('t9o').snapshot.element.where(path = 'Patient.identifier').mustSupport.not()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test9-2"/>
        <description value="Mustsupport must be true on Patient.identifier.system"/>
        <direction value="response"/>
        <expression value="fixture('t9o').snapshot.element.where(path = 'Patient.identifier.system').mustSupport"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test10"/>
    <description value="test slicing - simple"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t10o"/>
        <sourceId value="t10"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test10-1"/>
        <description value="Patient.identifier must be sliced"/>
        <direction value="response"/>
        <expression value="fixture('t10o').snapshot.element.where(path = 'Patient.identifier').first().slicing.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test10-2"/>
        <description value="Patient.identifier must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t10o').snapshot.element.where(path = 'Patient.identifier').first().sliceName.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test10-3"/>
        <description value="Patient.identifier must be sliced into two slices"/>
        <direction value="response"/>
        <expression value="fixture('t10o').snapshot.element.where(path = 'Patient.identifier').count() = 3"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test10-4"/>
        <description value="Patient.identifier slice must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t10o').snapshot.element.where(path = 'Patient.identifier').tail().slicing.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test10-5"/>
        <description value="Patient.identifier tail must have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t10o').snapshot.element.where(path = 'Patient.identifier').tail().all(sliceName.empty().not())"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test10-6"/>
        <description value="Patient.identifier.use must be fixed"/>
        <direction value="response"/>
        <expression value="fixture('t10o').snapshot.element.where(path = 'Patient.identifier.use').all(fixed.empty().not())"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test11"/>
    <description value="test slicing on extension"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t11o"/>
        <sourceId value="t11"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test11-1"/>
        <description value="Patient.extension must be sliced"/>
        <direction value="response"/>
        <expression value="fixture('t11o').snapshot.element.where(path = 'Patient.extension').first().slicing.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test11-2"/>
        <description value="Patient.extension first must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t11o').snapshot.element.where(path = 'Patient.extension').first().sliceName.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test11-3"/>
        <description value="Patient.extension must be sliced into two slices"/>
        <direction value="response"/>
        <expression value="fixture('t11o').snapshot.element.where(path = 'Patient.extension').count() = 3"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test11-4"/>
        <description value="Patient.extension must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t11o').snapshot.element.where(path = 'Patient.extension').tail().slicing.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test11-5"/>
        <description value="Patient.extension tail must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t11o').snapshot.element.where(path = 'Patient.extension').tail().all(sliceName.empty().not())"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test11-6"/>
        <description value="Patient.extension cardinality must be correct"/>
        <direction value="response"/>
        <expression value="fixture('t11o').snapshot.element.where(path = 'Patient.extension').first().max.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test11-7"/>
        <description value="Patient.extension cardinality must be correct"/>
        <direction value="response"/>
        <expression value="fixture('t11o').snapshot.element.where(path = 'Patient.extension')[1].min.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test12"/>
    <description value="Test slicing - extension, but without setting the slicing up"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t12o"/>
        <sourceId value="t12"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test12-1"/>
        <description value="Patient.extension must be sliced"/>
        <direction value="response"/>
        <expression value="fixture('t12o').snapshot.element.where(path = 'Patient.extension').first().slicing.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test12-2"/>
        <description value="Patient.extension first must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t12o').snapshot.element.where(path = 'Patient.extension').first().sliceName.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test12-3"/>
        <description value="Patient.extension must be sliced into two slices"/>
        <direction value="response"/>
        <expression value="fixture('t12o').snapshot.element.where(path = 'Patient.extension').count() = 3"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test12-4"/>
        <description value="Patient.extension must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t12o').snapshot.element.where(path = 'Patient.extension').tail().slicing.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test12-5"/>
        <description value="Patient.extension tail must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t12o').snapshot.element.where(path = 'Patient.extension').tail().all(sliceName.empty().not())"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test12-7"/>
        <description value="Patient.extension cardinality must be correct"/>
        <direction value="response"/>
        <expression value="fixture('t12o').snapshot.element.where(path = 'Patient.extension')[1].min.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test12a"/>
    <description value="Test slicing - extension, but without setting the slicing up (one slice only)"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t12ao"/>
        <sourceId value="t12a"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test12a-1"/>
        <description value="Patient.extension must be sliced"/>
        <direction value="response"/>
        <expression value="fixture('t12ao').snapshot.element.where(path = 'Patient.extension').first().slicing.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test12a-2"/>
        <description value="Patient.extension first must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t12ao').snapshot.element.where(path = 'Patient.extension').first().sliceName.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test12a-3"/>
        <description value="Patient.extension must be sliced into two slices"/>
        <direction value="response"/>
        <expression value="fixture('t12ao').snapshot.element.where(path = 'Patient.extension').count() = 2"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test12a-4"/>
        <description value="Patient.extension must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t12ao').snapshot.element.where(path = 'Patient.extension').tail().slicing.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test12a-5"/>
        <description value="Patient.extension tail must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t12ao').snapshot.element.where(path = 'Patient.extension').tail().all(sliceName.empty().not())"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test13"/>
    <description value="test slicing - complex"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t13o"/>
        <sourceId value="t13"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test13-1"/>
        <description value="element 7 (base) path"/>
        <expression value="fixture('t13o').snapshot.element[7].path = 'Patient.extension'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-2"/>
        <description value="element 7 slicing"/>
        <expression value="fixture('t13o').snapshot.element[7].slicing.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-3"/>
        <description value="element 8 (1st slice) path"/>
        <expression value="fixture('t13o').snapshot.element[8].path = 'Patient.extension'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-4"/>
        <description value="element 8 (1st slice) name"/>
        <expression value="fixture('t13o').snapshot.element[8].sliceName = 't'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-5"/>
        <description value="element 9 (2nd slice) profile name"/>
        <expression value="fixture('t13o').snapshot.element[8].type[0].profile = 'http://hl7.org/fhir/StructureDefinition/patient-birthTime'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-6"/>
        <description value="element 9 (2nd slice) path"/>
        <expression value="fixture('t13o').snapshot.element[9].path = 'Patient.extension'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-7"/>
        <description value="element 8 (1st slice) name"/>
        <expression value="fixture('t13o').snapshot.element[9].sliceName = 'complex'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-8"/>
        <description value="element 9 (2nd slice) profile name"/>
        <expression value="fixture('t13o').snapshot.element[9].type[0].profile = 'http://hl7.org/fhir/StructureDefinition/patient-nationality'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-9"/>
        <description value="element 10 (2nd slice).id path"/>
        <expression value="fixture('t13o').snapshot.element[10].path = 'Patient.extension.id'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-10"/>
        <description value="element 11 (2nd slice).extension path"/>
        <expression value="fixture('t13o').snapshot.element[11].path = 'Patient.extension.extension'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-11"/>
        <description value="element 12 (2nd slice).extension path"/>
        <expression value="fixture('t13o').snapshot.element[12].path = 'Patient.extension.extension'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-12"/>
        <description value="element 12 (2nd slice).extension must support"/>
        <expression value="fixture('t13o').snapshot.element[12].mustSupport"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-13"/>
        <description value="element 13 (2nd slice).extension.id path"/>
        <expression value="fixture('t13o').snapshot.element[13].path = 'Patient.extension.extension.id'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-14"/>
        <description value="element 14 (2nd slice).extension.extension path"/>
        <expression value="fixture('t13o').snapshot.element[14].path = 'Patient.extension.extension.extension'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-15"/>
        <description value="element 15 (2nd slice).extension.url path"/>
        <expression value="fixture('t13o').snapshot.element[15].path = 'Patient.extension.extension.url'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-16"/>
        <description value="element 16 (2nd slice).extension.valueCodeableConcept path"/>
        <expression value="fixture('t13o').snapshot.element[16].path = 'Patient.extension.extension.valueCodeableConcept'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-17"/>
        <description value="element 17 (2nd slice).extension path"/>
        <expression value="fixture('t13o').snapshot.element[17].path = 'Patient.extension.extension'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-18"/>
        <description value="element 17 (2nd slice).extension cardinality"/>
        <expression value="fixture('t13o').snapshot.element[17].max = '0'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-19"/>
        <description value="element 18 (2nd slice).extension.id path"/>
        <expression value="fixture('t13o').snapshot.element[18].path = 'Patient.extension.extension.id'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-20"/>
        <description value="element 19 (2nd slice).extension.extension path"/>
        <expression value="fixture('t13o').snapshot.element[19].path = 'Patient.extension.extension.extension'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-21"/>
        <description value="element 20 (2nd slice).extension.url path"/>
        <expression value="fixture('t13o').snapshot.element[20].path = 'Patient.extension.extension.url'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-22"/>
        <description value="element 21 (2nd slice).extension.valuePeriod path"/>
        <expression value="fixture('t13o').snapshot.element[21].path = 'Patient.extension.extension.valuePeriod'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-23"/>
        <description value="element 22.url path"/>
        <expression value="fixture('t13o').snapshot.element[22].path = 'Patient.extension.url'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test13-24"/>
        <description value="element 22.value path"/>
        <expression value="fixture('t13o').snapshot.element[23].path = 'Patient.extension.value[x]'"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test14"/>
    <description value="Test slicing see task 8742"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t14o"/>
        <sourceId value="t14"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test14-1"/>
        <description value="element count increased by 13"/>
        <expression value="fixture('t14o').snapshot.element.count() = fixture('organization').snapshot.element.count() + 13"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test15"/>
    <description value="test slicing - complex extensions with children"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t15o"/>
        <sourceId value="t15"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test15-1"/>
        <description value="element count increased by 27"/>
        <expression value="fixture('t15o').snapshot.element.count() = fixture('patient').snapshot.element.count() + 27"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test16"/>
    <description value="test slicing - extending a complex extension's children in derived profile"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t16o"/>
        <sourceId value="t16"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test16-1"/>
        <description value="element count increased by 17"/>
        <expression value="fixture('t16o').snapshot.element.count() = fixture('t15o').snapshot.element.count() + 17"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test17"/>
    <description value="slicing on modifierExtension"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t17o"/>
        <sourceId value="t17"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test17-1"/>
        <description value="Patient.modifierExtension must be sliced"/>
        <direction value="response"/>
        <expression value="fixture('t17o').snapshot.element.where(path = 'Patient.modifierExtension').first().slicing.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test17-2"/>
        <description value="Patient.modifierExtension first must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t17o').snapshot.element.where(path = 'Patient.modifierExtension').first().sliceName.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test17-3"/>
        <description value="Patient.modifierExtension must be sliced into two slices"/>
        <direction value="response"/>
        <expression value="fixture('t17o').snapshot.element.where(path = 'Patient.modifierExtension').count() = 3"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test17-4"/>
        <description value="Patient.modifierExtension must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t17o').snapshot.element.where(path = 'Patient.modifierExtension').tail().slicing.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test17-5"/>
        <description value="Patient.modifierExtension tail must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t17o').snapshot.element.where(path = 'Patient.modifierExtension').tail().all(sliceName.empty().not())"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test17-6"/>
        <description value="Patient.modifierExtension cardinality must be correct"/>
        <direction value="response"/>
        <expression value="fixture('t17o').snapshot.element.where(path = 'Patient.modifierExtension').first().max.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test17-7"/>
        <description value="Patient.modifierExtension cardinality must be correct"/>
        <direction value="response"/>
        <expression value="fixture('t17o').snapshot.element.where(path = 'Patient.modifierExtension')[1].min.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test18"/>
    <description value="slicing on modifierExtension, no set up"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t18o"/>
        <sourceId value="t18"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test18-1"/>
        <description value="Patient.modifierExtension must be sliced"/>
        <direction value="response"/>
        <expression value="fixture('t18o').snapshot.element.where(path = 'Patient.modifierExtension').first().slicing.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test18-2"/>
        <description value="Patient.modifierExtension first must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t18o').snapshot.element.where(path = 'Patient.modifierExtension').first().sliceName.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test18-3"/>
        <description value="Patient.modifierExtension must be sliced into two slices"/>
        <direction value="response"/>
        <expression value="fixture('t18o').snapshot.element.where(path = 'Patient.modifierExtension').count() = 3"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test18-4"/>
        <description value="Patient.modifierExtension must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t18o').snapshot.element.where(path = 'Patient.modifierExtension').tail().slicing.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test18-5"/>
        <description value="Patient.modifierExtension tail must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t18o').snapshot.element.where(path = 'Patient.modifierExtension').tail().all(sliceName.empty().not())"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test18-6"/>
        <description value="Patient.modifierExtension cardinality must be correct"/>
        <direction value="response"/>
        <expression value="fixture('t18o').snapshot.element.where(path = 'Patient.modifierExtension').first().max.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test18-7"/>
        <description value="Patient.modifierExtension cardinality must be correct"/>
        <direction value="response"/>
        <expression value="fixture('t18o').snapshot.element.where(path = 'Patient.modifierExtension')[1].min.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test19"/>
    <description value="slicing on modifierExtension, no extension, one slice"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t19o"/>
        <sourceId value="t19"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test19-1"/>
        <description value="Patient.modifierExtension must be sliced"/>
        <direction value="response"/>
        <expression value="fixture('t19o').snapshot.element.where(path = 'Patient.modifierExtension').first().slicing.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test19-2"/>
        <description value="Patient.modifierExtension first must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t19o').snapshot.element.where(path = 'Patient.modifierExtension').first().sliceName.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test19-3"/>
        <description value="Patient.modifierExtension must be sliced into one slices"/>
        <direction value="response"/>
        <expression value="fixture('t19o').snapshot.element.where(path = 'Patient.modifierExtension').count() = 2"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test19-4"/>
        <description value="Patient.modifierExtension must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t19o').snapshot.element.where(path = 'Patient.modifierExtension').tail().slicing.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test19-5"/>
        <description value="Patient.modifierExtension tail must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t19o').snapshot.element.where(path = 'Patient.modifierExtension').tail().all(sliceName.empty().not())"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <!--  <test>
    <name value="Test20"/>
    <description value="Slicing a backbone element"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t20o"/>
        <sourceId value="t20"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test20-1"/>
        <description value="PlanDefinition.action must be sliced"/>
        <direction value="response"/>
        <expression value="fixture('t20o').snapshot.element.where(path = 'PlanDefinition.action').first().slicing.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test20-2"/>
        <description value="PlanDefinition.action first must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t20o').snapshot.element.where(path = 'PlanDefinition.action').first().sliceName.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test20-3"/>
        <description value="PlanDefinition.action must be sliced into two slices"/>
        <direction value="response"/>
        <expression value="fixture('t20o').snapshot.element.where(path = 'PlanDefinition.action').count() = 3"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test20-4"/>
        <description value="PlanDefinition.action tail must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t20o').snapshot.element.where(path = 'PlanDefinition.action').tail().slicing.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test20-5"/>
        <description value="PlanDefinition.action tail must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t20o').snapshot.element.where(path = 'PlanDefinition.action').tail().all(sliceName.empty().not())"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test20-6"/>
        <description value="PlanDefinition.action slice base must have children"/>
        <direction value="response"/>
        <expression value="fixture('t20o').snapshot.element[51].where(path.startsWith('PlanDefinition.action.')).empty().not()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>-->
  <test>
    <name value="Test21"/>
    <description value="Slicing a backbone element on its nested use"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t21o"/>
        <sourceId value="t21"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test21-1"/>
        <description value="PlanDefinition.action.action must be sliced"/>
        <direction value="response"/>
        <expression value="fixture('t21o').snapshot.element.where(path = 'PlanDefinition.action.action').first().slicing.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test21-2"/>
        <description value="PlanDefinition.action.action first must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t21o').snapshot.element.where(path = 'PlanDefinition.action.action').first().sliceName.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test21-3"/>
        <description value="PlanDefinition.action.action must be sliced into two slices"/>
        <direction value="response"/>
        <expression value="fixture('t21o').snapshot.element.where(path = 'PlanDefinition.action.action').count() = 3"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test21-4"/>
        <description value="PlanDefinition.action.action tail must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t21o').snapshot.element.where(path = 'PlanDefinition.action.action').tail().slicing.empty()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test21-5"/>
        <description value="PlanDefinition.action.action tail must not have a slice name"/>
        <direction value="response"/>
        <expression value="fixture('t21o').snapshot.element.where(path = 'PlanDefinition.action.action').tail().all(sliceName.empty().not())"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test22"/>
    <description value="test slicing - Constrain base element before slicing"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t22o"/>
        <sourceId value="t22"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test22-1"/>
        <description value="element count increased by 76"/>
        <expression value="fixture('t22o').snapshot.element.count().trace('t22o') = fixture('patient').snapshot.element.count().trace('t22patient') + 76"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test23"/>
    <description value="test slicing - unsorted differential"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <params value="sort=true"/>
        <responseId value="t23o"/>
        <sourceId value="t23"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test23-1"/>
        <description value="element count increased by ??"/>
        <expression value="fixture('t23o').snapshot.element.count().trace('t23o') = fixture('patient').snapshot.element.count().trace('t23patient') + 11"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test24"/>
    <description value="test slicing - Constrain base element before slicing when slices were already defined - backbone"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t24ao"/>
        <sourceId value="t24a"/>
      </operation>
    </action>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t24bo"/>
        <sourceId value="t24b"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test24-1"/>
        <description value="Element count of profile a is increased by 24 from base Patient"/>
        <expression value="fixture('t24bo').snapshot.element.count().trace('t24ao') = fixture('patient').snapshot.element.count().trace('t24Patient') + 22"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test24-2"/>
        <description value="Element count of profile b is identical to profile a"/>
        <expression value="fixture('t24bo').snapshot.element.count().trace('t24bo') = fixture('t24ao').snapshot.element.count().trace('t24ao')"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <!-- disabled until it passes
  <test>
    <name value="Test25"/>
    <description value="test slicing - Constrain base element before slicing when slices were already defined - datatype"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/><responseId value="t25o"/>
        <sourceId value="t25b"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test25-1"/>
        <description value="element count increased by ??"/>
        <!-!- Update once we know what the new snapshot size should be -!->
        <expression value="fixture('t25o').snapshot.element.count().trace('t25o') = fixture('patient').snapshot.element.count().trace('t25patient') + 1"/>
              <warningOnly value="false"/></assert>
    </action>
  </test>
  -->
  <test>
    <name value="Test26"/>
    <description value="Test differential sorting for polymorphic references"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="sortDifferential"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t26o"/>
        <sourceId value="t26"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test26-1"/>
        <description value="differential element count the same"/>
        <expression value="fixture('t26o').differential.element.count() = fixture('t26').differential.element.count()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test27"/>
    <description value="test Contract.type"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <responseId value="t27o"/>
        <sourceId value="t27"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test27-1"/>
        <description value="Contract.type.coding.code must have a pattern"/>
        <direction value="response"/>
        <expression value="fixture('t27o').snapshot.element.where(path = 'Contract.type.coding.code').pattern.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test27-2"/>
        <description value="Contract.type.coding.system must have a pattern"/>
        <direction value="response"/>
        <expression value="fixture('t27o').snapshot.element.where(path = 'Contract.type.coding.system').pattern.exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test28"/>
    <description value="Test children of a polymorphic type"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <params value="sort=true"/>
        <responseId value="t28o"/>
        <sourceId value="t28"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test28-1"/>
        <description value="Element count must be increased by 16"/>
        <direction value="response"/>
        <expression value="fixture('t28o').snapshot.element.count().trace('t28o') = fixture('operationoutcome').snapshot.element.count().trace('t28') + 16"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test29"/>
    <description value="Test recursion on elements that are deeper than children of the root and have a different name (Parameters.parameter.part)"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <params value="sort=true"/>
        <responseId value="t29o"/>
        <sourceId value="t29"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test29-1"/>
        <description value="Element count must be increased by 15"/>
        <direction value="response"/>
        <expression value="fixture('t29o').snapshot.element.count().trace('t29o') = fixture('parameters').snapshot.element.count().trace('t29') + 15"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test29-2"/>
        <description value="There is an element with id 'Parameters.parameter.part:foo.id'"/>
        <direction value="response"/>
        <expression value="fixture('t29o').snapshot.element.where(id = 'Parameters.parameter.part:foo.id').count()=1"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test30"/>
    <description value="Profile and derived profile both slice a backbone element"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <params value="sort=true"/>
        <responseId value="t30bo"/>
        <sourceId value="t30b"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test30"/>
        <description value="Snapshot doesn't result in an error'"/>
        <direction value="response"/>
        <expression value="fixture('t30bo').snapshot.element.count().trace('t30bo')>1"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test31"/>
    <description value="Propagate extensions from differential to snapshot"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <params value="sort=true"/>
        <responseId value="t31o"/>
        <sourceId value="t31"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test31"/>
        <description value="Snapshot contains regex extension'"/>
        <direction value="response"/>
        <expression value="fixture('t31o').snapshot.element.extension('http://hl7.org/fhir/StructureDefinition/regex').count().trace('t31o ext count')=2"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test32"/>
    <description value="Test disappearing slicing"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <params value="sort=true"/>
        <responseId value="t32o"/>
        <sourceId value="t32"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test32"/>
        <description value="Snapshot Questionnaire.item element has slicing'"/>
        <direction value="response"/>
        <expression value="fixture('t32o').snapshot.element.where(id = 'Questionnaire.item').slicing.count().trace('t32o item slicing count')=1"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test33"/>
    <description value="Test disappearing slicing"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <params value="sort=true"/>
        <responseId value="t33o"/>
        <sourceId value="t33"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test33"/>
        <description value="Snapshot contains referenced item children with correct path'"/>
        <direction value="response"/>
        <expression value="fixture('t33o').snapshot.element.where(id = 'ExplanationOfBenefit.addItem.adjudication.extension').exists()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test34"/>
    <description value="Test custom extension"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <params value="sort=true"/>
        <responseId value="t34o"/>
        <sourceId value="t34"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test34"/>
        <description value="There must be 2 elements on Basic.identifier.extension in the snapshot"/>
        <direction value="response"/>
        <expression value="fixture('t34o').snapshot.element.where(path = 'Basic.identifier.extension').count() = 2"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test34a"/>
        <description value="The narrative must mention the extension URL (http://www.fhir.org/guides/test3/StructureDefinition/extension-identifier-status)"/>
        <direction value="response"/>
        <expression value="fixture('t34o').text.div.contains('http://www.fhir.org/guides/test3/StructureDefinition/extension-identifier-status')"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  <test>
    <name value="Test35"/>
    <description value="Test profiled custom extension"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <params value="sort=true"/>
        <responseId value="t35o"/>
        <sourceId value="t35"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test35"/>
        <description value="There must be 2 elements on Basic.identifier.extension in the snapshot"/>
        <direction value="response"/>
        <expression value="fixture('t35o').snapshot.element.where(path = 'Basic.identifier.extension').count() = 2"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <label value="test35a"/>
        <description value="The narrative must mention the extension URL (http://www.fhir.org/guides/test3/StructureDefinition/extension-identifier-status)"/>
        <direction value="response"/>
        <expression value="fixture('t35o').text.div.contains('http://www.fhir.org/guides/test3/StructureDefinition/extension-identifier-status')"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
<!--
  this triggers a complex bug in the snapshot generation to do with tracking paths when repeatedly walking across recursion (contentReference != null)
  
  <test>
    <name value="Test36"/>
    <description value="Test deep nesting"/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="snapshot"/>
        </type>
        <resource value="StructureDefinition"/>
        <encodeRequestUrl value="false"/>
        <params value="sort=true"/>
        <responseId value="t36o"/>
        <sourceId value="t36"/>
      </operation>
    </action>
    <action>
      <assert>
        <label value="test36"/>
        <description value="Snapshot generation didn't blow up"/>
        <direction value="response"/>
        <expression value="fixture('t36o').snapshot.element.count() > 0"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
  -->
</TestScript>
